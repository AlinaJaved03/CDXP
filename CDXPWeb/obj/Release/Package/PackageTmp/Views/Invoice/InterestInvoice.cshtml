
@{
    ViewBag.Title = "Interest Invoice";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="pcontent">
    <script src="~/Content/dist/js/ecommerce-data.js"></script>
    <script src="~/Content/filereader.js"></script>
    <script src="~/Content/jquery.csv.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.0.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/amcharts/3.21.15/plugins/export/libs/FileSaver.js/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.1.0/jszip-utils.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
    <style type="text/css">

        #myModal {
            height: 500px !important;
        }

        .radio input[type="radio"] {
            opacity: 1 !important;
            padding-left: 5px !important;
            height: 20px;
            width: 20px;
            cursor: pointer !important;
        }

        .btn-blk-delete {
            font-size: 18px;
            cursor: pointer !important;
        }

        .selectize-input {
            background-color: rgb(251, 255, 193) !important;
            border-radius: 0px !important;
        }

            .selectize-input:after {
                border-width: 7px 3px 0 3px !important;
                right: 7px !important;
            }

            .selectize-input.dropdown-active:after {
                border-width: 0px 3px 7px 3px !important;
            }

        .table-striped > tbody > tr {
            background-color: rgba(33, 33, 33, 0.05) !important;
        }

        .tblFrm {
            width: 100%;
        }

            .tblFrm tr td:nth-child(odd) {
                padding-left: 4% !important;
                vertical-align: top;
                padding-top: 20px !important;
            }

            .tblFrm input[type=text] {
                font-size: 14px;
                font-weight: 400;
            }

            .tblFrm label {
                font-weight: 700;
                padding-top: 0px;
            }

        .table > thead > tr > th, .table > tbody > tr > td {
            padding: 0px !important;
            font-size: 12px !important;
            border-top: 0px solid white !important;
        }

        input[type=password][disabled], input[type=text][disabled], input[type=file][disabled], input:not([type])[disabled], textarea[disabled], select[disabled], .sp-peoplepicker-topLevelDisabled, .ms-inputBoxDisabled {
            color: black !important;
        }

        select {
            padding: 6px 0px !important;
        }

        body {
            color: black !important;
        }

        button {
            min-width: 0px;
        }

        div.remarks-wrap {
            width: 99%;
            margin: 0 auto 1em auto;
            position: relative;
        }

            div.remarks-wrap:first-child {
                margin-top: 1em;
            }

        div.remarks-comment {
            font-size: 1em;
            position: relative;
            margin-left: 60px;
            border-radius: 0.75em 0.75em 0.75em 0.75em;
            background: #f9f9f9;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ebebeb', endColorstr='#ffffff', GradientType=0);
            line-height: 1.4em;
            font-family: Helvetica;
            padding-bottom: 10px;
            padding-top: 1px
        }

            div.remarks-comment::before {
                content: attr(data-owner);
                border-radius: 0.75em 0.75em 0 0;
                background: rgba(235, 235, 235, 1);
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ebebeb', endColorstr='#ffffff', GradientType=0);
                display: block;
                text-indent: 2%;
                border-bottom: 1px solid skyblue;
                height: 25px;
                padding-top: 5px;
            }

            div.remarks-comment::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 0;
                border: 10px solid transparent;
                border-right: 10px solid rgb(247, 247, 247);
                margin: -10px 0 0 -20px;
            }

            div.remarks-comment p {
                width: 96%;
                margin: 5px auto 3px auto;
                font-size: 13px;
            }

        .remarks-img {
            position: absolute;
            top: 50%;
            width: 50px;
            float: left;
            border-radius: 10px;
            margin-top: -25px;
        }

        p + ol.postscript {
            width: 80%;
            font-size: 0.8em;
            margin: -0.5em auto 0 auto;
        }

        ol.postscript::after {
            content: '';
            height: 0.5em;
            display: block;
            clear: both;
        }

        ol.postscript li {
            float: left;
            margin-right: 0.5em;
        }

            ol.postscript li.date {
                float: right;
                margin-right: 0;
            }

        .remarks-wrap a:link,
        .remarks-wrap a:visited {
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #333;
        }

        .remarks-wrap a:hover,
        .remarks-wrap a:active,
        .remarks-wrap a:focus {
            color: #f00;
            border-bottom: 1px solid #f00;
        }

        .files {
            border: 1px solid gray;
            margin: 10px;
            padding: 5px;
            /*background: #f6f6f6;*/
        }

            .files > .filedelete {
                float: right;
            }

        .ui-dialog {
            z-index: 1050;
        }

        .ui-dialog-content .input-group .form-control, .ui-dialog-content .selectize-input input {
            z-index: 1060;
        }
    </style>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding: 0px;">
            <div class="panel panel-default card-view panel-refresh">
                <div class="refresh-container">
                    <div class="la-anim-1"></div>
                </div>
                <div class="panel-heading">
                    <div class="pull-left" style="display: inline-flex;">
                        <i class="fa fa-wpforms" style="padding-top: 4px; margin-right: 5px; color: #fff;"></i>
                        <h6 class="panel-title txt-light">@ViewBag.Title</h6>
                    </div>
                    <div class="pull-right">
                        <a class="pull-left inline-block mr-15" data-toggle="collapse" href="#collapse_1" aria-expanded="true">
                            <i class="zmdi zmdi-chevron-down"></i>
                            <i class="zmdi zmdi-chevron-up"></i>
                        </a>


                        <a href="#" class="pull-left inline-block full-screen mr-15">
                            <i class="zmdi zmdi-fullscreen"></i>
                        </a>
                        @*<a class="pull-left inline-block close-panel" href="#" data-effect="fadeOut">
                                <i class="zmdi zmdi-close"></i>
                            </a>*@
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div id="collapse_1" class="panel-wrapper collapse in">
                    <div class="panel-body" style="min-height: 300px;">
                        @*====Body Start===*@
                        <div class="tab0">
                            &nbsp;
                            <div class="tab1">&nbsp;Invoice Submission Late Payment Interest Invoice</div>
                            <strong id="interestMode" style="font-size: 16px; color: black; float: right;">Create</strong>
                            <div class="tab2">&nbsp;</div>
                        </div>
                        <div style="background-color: white;">
                            <div id="temp" style="display: none;"></div>
                            <table class="table" id="tblHeader" style="color: #4F4F4F;">
                                <tr style="background-color: white; display: none;">
                                    <td>
                                        <label for="TransactionNumber">
                                            Transaction
                                            No
                                        </label>
                                    </td>
                                    <td>
                                        <input type="hidden" class="form-control" id="diarynumber" name="diarynumber" readonly>
                                        <input type="text" class="form-control" style="width: 171px;" id="TransactionNumber" name="TransactionNumber" readonly>
                                        <input type="hidden" class="form-control" style="width: 171px;" id="tokenkey" name="tokenkey">
                                        <input type="hidden" class="form-control" id="diaryHeaderID" name="diaryHeaderID">
                                        <input type="hidden" class="form-control" id="invoiceTypeID" name="invoiceTypeID">
                                        <input type="hidden" class="form-control" id="headerID" name="headerID">
                                    </td>
                                    <td>
                                        <label for="creationdate" style="margin-left: 20px;">
                                            Creation Date
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" id="creationdate" name="creationdate" readonly>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="powerProducer">Power Producer</label>
                                    </td>
                                    <td>
                                        <input tabindex="-1" type="text" class="form-control frm" id="powerProducer" value="" readonly name="powerProducer">
                                    </td>
                                    <td>
                                        <label for="submitDate" style="margin-left: 20px;">
                                            Submit Date
                                        </label>
                                    </td>
                                    <td>
                                        <input tabindex="-1" type="text" class="form-control" id="submitDate" name="submitDate" readonly>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="producerSite">Producer Site</label>
                                    </td>
                                    <td>
                                        @*<input type="text" class="form-control" id="producerSite" value="" readonly name="producerSite">*@
                                        <select tabindex="-1" class="form-control frm" id="producerSite" name="producerSite" required="">
                                            <option value="0">Select</option>
                                        </select>
                                    </td>
                                    <td>
                                        <label for="status" style="margin-left: 20px;">
                                            Status
                                        </label>
                                    </td>
                                    <td>
                                        <input tabindex="-1" type="text" class="form-control frm" id="status" name="status" readonly required="">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoiceType">Invoice Type<span style="color: rgb(0, 149, 235);">*</span></label>
                                    </td>
                                    <td>
                                        <select tabindex="1" class="form-control frm getBloks" id="invoiceType" name="invoiceType" required="required">
                                            <option value="0">Select</option>
                                        </select>
                                    </td>
                                    <td>
                                        <label for="invoiceDueDate" style="margin-left: 20px;">
                                            Payment Due Date<span style="color: rgb(0, 149, 235);">*</span>
                                        </label>
                                    </td>
                                    <td>
                                        @*<input type="date" style="text-indent: -500px;" class="form-control" id="invoiceDueDate" onchange=" duedate1(this);" name="invoiceDueDate">
                                            <input type="text" class="form-control" id="ndt" onclick="duedate();" style="display: none;" />*@
                                        <input tabindex="8" style="background-color: rgb(251, 255, 193);" type="text" class="form-control frm" onchange="datefun(this);" id="invoiceDueDate" name="invoiceDueDate" style="background-color: white;" readonly="readonly">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoiceLetterNumber">
                                            Invoice No<span style="color: rgb(0, 149, 235);">*</span>
                                        </label>
                                    </td>
                                    <td>
                                        <input tabindex="2" style="background-color: rgb(251, 255, 193);" type="text" class="form-control frm" id="invoiceLetterNumber" name="invoiceLetterNumber" required="" maxlength="50">
                                    </td>
                                    <td>
                                        <label style="margin-left: 20px;" for="currency">Currency</label>

                                    </td>
                                    <td>

                                        <select tabindex="-1" class="form-control frm" id="currency" name="currency" required="" disabled="">
                                            <option value="">Select</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                            <option value="PKR" selected="">PKR</option>
                                            <option value="STAT">STAT</option>
                                            <option value="USD">USD</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoiceDate">
                                            Invoice Date<span style="color: rgb(0, 149, 235);">*</span>
                                        </label>
                                    </td>
                                    <td>

                                        <input tabindex="3" style="background-color: rgb(251, 255, 193);" type="text" class="form-control frm" id="invoiceDate" name="invoiceDate" readonly>

                                    </td>
                                    <td>
                                        <label style="margin-left: 20px;" for="totalClaim">Total Claim</label>
                                    </td>
                                    <td>
                                        <input tabindex="-1" type="text" class="form-control frm" id="totalClaim" name="totalClaim" readonly value="0.0000">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoicePeriodFrom">
                                            Invoice Period
                                            From<span style="color: rgb(0, 149, 235);">*</span>
                                        </label>
                                    </td>
                                    <td style="display: inline-flex; width: 100%;">
                                        <input tabindex="4" style="background-color: rgb(251, 255, 193);" type="text" class="form-control frm" id="invoicePeriodFrom" name="invoicePeriodFrom" onchange="datefun(this);" style="background-color: white;" readonly>
                                        <select tabindex="5" id="invoicePeriodFromTime" class="form-control frm" style="width: 100px;">
                                            <option selected="">00:00</option>
                                            <option>01:00</option>
                                            <option>02:00</option>
                                            <option>03:00</option>
                                            <option>04:00</option>
                                            <option>05:00</option>
                                            <option>06:00</option>
                                            <option>07:00</option>
                                            <option>08:00</option>
                                            <option>09:00</option>
                                            <option>10:00</option>
                                            <option>11:00</option>
                                            <option>12:00</option>
                                            <option>13:00</option>
                                            <option>14:00</option>
                                            <option>15:00</option>
                                            <option>16:00</option>
                                            <option>17:00</option>
                                            <option>18:00</option>
                                            <option>19:00</option>
                                            <option>20:00</option>
                                            <option>21:00</option>
                                            <option>22:00</option>
                                            <option>23:00</option>
                                        </select>
                                    </td>

                                    <td></td>
                                    <td></td>
                                    <td>
                                        <label for="gstPercent" style="margin-left: 20px; display: none;">
                                            GST Per %
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" class="form-control" onkeydown="return keyvalidation(event, this)" id="gstPercent" style="display: none;" name="gstPercent">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoicePeriodTo">
                                            Invoice Period
                                            To<span style="color: rgb(0, 149, 235);">*</span>
                                        </label>
                                    </td>
                                    <td style="display: inline-flex; width: 100%;">
                                        <input tabindex="6" style="background-color: rgb(251, 255, 193);" type="text" class="form-control frm" id="invoicePeriodTo" name="invoicePeriodTo" onchange="datefun(this);" style="background-color: white;" readonly>
                                        <select tabindex="7" id="invoicePeriodToTime" class="form-control frm" style="width: 100px;">
                                            <option selected="">00:00</option>
                                            <option>01:00</option>
                                            <option>02:00</option>
                                            <option>03:00</option>
                                            <option>04:00</option>
                                            <option>05:00</option>
                                            <option>06:00</option>
                                            <option>07:00</option>
                                            <option>08:00</option>
                                            <option>09:00</option>
                                            <option>10:00</option>
                                            <option>11:00</option>
                                            <option>12:00</option>
                                            <option>13:00</option>
                                            <option>14:00</option>
                                            <option>15:00</option>
                                            <option>16:00</option>
                                            <option>17:00</option>
                                            <option>18:00</option>
                                            <option>19:00</option>
                                            <option>20:00</option>
                                            <option>21:00</option>
                                            <option>22:00</option>
                                            <option>23:00</option>
                                        </select>
                                    </td>
                                    <td>
                                        <label for="isDifferential" style="margin-left: 20px; display: none;">
                                            Is Differential
                                        </label>
                                    </td>
                                    <td>
                                        <select class="form-control" id="isDifferential" name="isDifferential" style="display: none;">
                                            <option value="">Select</option>
                                            <option value="no">No</option>
                                            <option value="yes">Yes</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr></tr>
                                <tr></tr>
                                <tr>
                                    <td>
                                        <label for="remarks">
                                            Remarks
                                        </label>
                                    </td>
                                    <td>
                                        <textarea tabindex="9" rows="2" cols="10" style="resize: none" class="form-control frm" id="remarks" name="remarks"></textarea>
                                    </td>
                                </tr>
                            </table>
                            <table class="table" id="tblHeaderV" style="display: none;">
                                <tr style="background-color: white;">
                                    <td>
                                        <label for="diarynumber">Transaction No</label>
                                    </td>
                                    <td>
                                        <span style="width: 171px;" id="diarynumberV" name="diarynumber">
                                        </span>
                                        <input type="hidden" class="form-control" style="width: 171px;" id="tokenkeyV" name="tokenkey">
                                        <input type="hidden" class="form-control" id="diaryHeaderIDV" name="diaryHeaderID">
                                        <input type="hidden" class="form-control" id="invoiceTypeIDV" name="invoiceTypeID">
                                        <input type="hidden" class="form-control" id="headerIDV" name="headerID">
                                    </td>
                                    <td>
                                        <label for="creationdate">Creation Date</label>
                                    </td>
                                    <td>
                                        <span id="creationdateV" name="creationdate">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="powerProducer">Power Producer</label>
                                    </td>
                                    <td>
                                        <span id="powerProducerV" name="powerProducer">
                                        </span>
                                    </td>
                                    <td>
                                        <label for="submitDate">Submit Date</label>
                                    </td>
                                    <td>
                                        <span id="submitDateV" name="submitDate">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="producerSite">Producer Site</label>
                                    </td>
                                    <td>
                                        <span id="producerSiteV" name="producerSite">
                                        </span>
                                    </td>
                                    <td><label for="status">Status</label> </td>
                                    <td>
                                        <span id="statusV" name="status" readonly required="">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoiceType">Invoice Type</label>
                                    </td>
                                    <td>
                                        <span id="invoiceTypeV" name="invoiceType">
                                        </span>
                                    </td>
                                    <td>
                                        <label for="invoiceDueDate">Payment Due Date</label>
                                    </td>
                                    <td><span id="invoiceDueDateV"></span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoiceLetterNumber">
                                            Invoice No
                                        </label>
                                    </td>
                                    <td>
                                        <span id="invoiceLetterNumberV" name="invoiceLetterNumber" maxlength="19">
                                        </span>
                                    </td>
                                    <td>
                                        <label for="remarks">Remarks</label>
                                    </td>
                                    <td style="width: 400px;"><span id="remarksV"></span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoiceDate">
                                            Invoice Date
                                        </label>
                                    </td>
                                    <td><span id="invoiceDateV"></span></td>
                                    <td>
                                        <label for="parentInvoice"></label>
                                    </td>
                                    <td><span id="parentInvoiceV"></span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoicePeriodFrom">
                                            Invoice Period
                                            From
                                        </label>
                                    </td>
                                    <td>
                                        <span id="invoicePeriodFromV"></span>
                                    </td>
                                    <td>
                                        <label for="currency">Currency</label>
                                    </td>
                                    <td><span id="currencyV"></span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="invoicePeriodTo">
                                            Invoice Period
                                            To
                                        </label>
                                    </td>
                                    <td>
                                        <span id="invoicePeriodToV"></span>
                                    </td>
                                    <td>
                                        <label for="totalClaim">Total Claim</label>
                                    </td>
                                    <td>
                                        <span id="totalClaimV" name="totalClaimV">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td id="VreceiveDateTtitle"></td>
                                    <td id="VreceiveDateValue"></td>
                                </tr>
                                <tr id="hardCopyTR" style="display: none;">
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <label>Invoice Receiving date</label>
                                    </td>
                                    <td style="display: inline-flex; width: 100%;">
                                        <input style="background-color: rgb(251, 255, 193); width: 30%;" type="text" class="form-control" id="hardCopySub" readonly disabled="disabled">
                                        <select id="hardCopySubTime" class="form-control" style="width: 60px;" disabled="disabled">
                                            <option selected="">00:00</option>
                                            <option>01:00</option>
                                            <option>02:00</option>
                                            <option>03:00</option>
                                            <option>04:00</option>
                                            <option>05:00</option>
                                            <option>06:00</option>
                                            <option>07:00</option>
                                            <option>08:00</option>
                                            <option>09:00</option>
                                            <option>10:00</option>
                                            <option>11:00</option>
                                            <option>12:00</option>
                                            <option>13:00</option>
                                            <option>14:00</option>
                                            <option>15:00</option>
                                            <option>16:00</option>
                                            <option>17:00</option>
                                            <option>18:00</option>
                                            <option>19:00</option>
                                            <option>20:00</option>
                                            <option>21:00</option>
                                            <option>22:00</option>
                                            <option>23:00</option>
                                        </select>
                                        @*tanavush*@
                                    <select id="hardCopyType" class="form-control" style="width: 150px;">
                                        <option value="InPerson" selected="">In Person</option>
                                        <option value="ByCourier">By Courier</option>
                                        <option value="Facsimile">Facsimile</option>
                                        <option value="Fax">Fax</option>
                                        <option value="Email">Email</option>
                                        <option value="cdxp">CDXP</option>
                                    </select>
                                    </td>
                                </tr>
                                <tr></tr>
                            </table>
                        </div>

                        @*Modal*@
                        <div id="myModal" title="Attach File" style="display: none;">
                            <div class="form-group">
                                <label class="control-label mb-10" for="attachmentFile">
                                    Select File
                                </label>
                                <label style="padding-left: 270px; color: red;">
                                    File size for Excel and PDF = 5MB, Others = 2MB.
                                </label>
                                <div class="input-group" style="width: 100%;">
                                    <input style="padding-bottom: 50px;" class="form-control" id="attachmentFile" name="attachmentFile" accept="application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/pdf, image/*" type="file">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label mb-10" for="attachmentTitle">
                                    Attachment Title *
                                </label>
                                <div class="input-group" style="width: 100%;">
                                    <input name="attachmentTitle" style="padding-right: 300px;" class="form-control" id="attachmentTitle" placeholder="Attachment Title" maxlength="50" type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label mb-10" for="attachmentType">
                                    Attachment Type
                                </label>
                                <div class="input-group" style="width: 100%;">
                                    @*<input style="padding-right: 300px;" class="form-control" id="attachmentType" placeholder="Attachment Type" type="text">*@
                                    <select id="attachmentType" disabled="disabled" style="width: 100%;">
                                        <option>File</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label mb-10" for="attachmentDesc">
                                    Description
                                </label>
                                <div class="input-group" style="width: 100%;">
                                    <textarea style="resize: none;" maxlength="100" name="attachmentTitle" cols="50" class="form-control" id="attachmentDesc" placeholder="Description Title" rows="4"></textarea>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <button type="button" tg="0" typ="0" class="btn btn-info" id="btnUpload" name="btnUpload">
                                    Attach File
                                </button>
                                <button type="button" id="btnCloseDialog" class="btn btn-default">
                                    Close
                                </button>
                            </div>
                        </div>
                        <br />
                        <br />
                        <div id="viewonly" style="display: none;">
                            @*<p>
                                    <strong id="bf" style="font-size:18px; color:black;">Parent Invoice</strong>
                                </p>
                                <hr style="border-width:1px; margin-bottom:10px;">*@
                            <div class="tab0">
                                &nbsp;
                                <div class="tab1">&nbsp;Parent Invoice</div>
                                <div class="tab2">&nbsp;</div>
                            </div>
                            <div id="viewContainer" style="background-color: white;"></div>
                        </div>
                        <div id="edit">
                            @*<p>
                                    <strong style="font-size:18px; color:black;">Parent Invoice</strong>
                                </p>
                                <hr style="border-width:1px; margin-bottom:10px;">*@
                            <div class="tab0">
                                &nbsp;
                                <div class="tab1">&nbsp;Parent Invoice</div>
                                <div class="tab2">&nbsp;</div>
                            </div>
                            <div style="background-color: white;">
                                <div style="display: flex;">
                                    <button type="button" class="btn btn-success btn-anim" id="btnadd" style="display: none;">
                                        Add Row
                                    </button><select id="pp" style="display: none; width: 15%; height: 51px; margin-left: 10px;" class="form-control"><option value="PRE" selected="selected">PRE (Before 01-Nov-17)</option><option value="POST">POST (From 01-Nov-17)</option></select><input type="text" id="PreText" placeholder="Power Generator Invoice No" style="display: none; width: 30%; height: 51px; margin-left: 10px;" class="form-control" /><select id="ddlAddBlock" style="width: 30%; height: 51px; margin-left: 10px; display: none;" class="form-control"><option value="0">Select</option></select>
                                </div>

                                <div style="overflow-x: auto; padding-top: 20px;">
                                    <table class="table table-striped" id="tblPI" dellblock="">
                                        <thead>
                                            <tr>
                                                <th style="width: 20px;"></th>
                                                <th>Pre / Post</th>
                                                <th>Power Generator Inv No</th>
                                                <th>Invoice Type</th>
                                                <th id="pFromPI">Period From</th>
                                                <th id="pToPI">Period To</th>
                                                <th>Claimed Amount</th>
                                                <th>Verified Amount</th>
                                                <th>Interest Claim</th>
                                                <th>Remarks</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            @*Block Fuel Type Table END*@
                            @*COMPONENT Section Starts here*@
                            @*<p>

                                    <strong style="font-size:18px; color:black;">Payment Details</strong>
                                </p>
                                <hr style="border-width:1px; margin-bottom:10px;">*@
                            <div class="tab0">
                                &nbsp;
                                <div class="tab1">&nbsp;Payment Details</div>
                                <div class="tab2">&nbsp;</div>
                            </div>
                            <div style="background-color: white;">
                                <div style="display: inline-flex;">
                                    <button type="button" id="btnAddRow" class="btn btn-info">
                                        Add Row
                                    </button>
                                    <input id="File1" type="file" />
                                </div>
                                <div style="overflow-x: auto;">
                                    <table class="table table-striped" id="tblComp" delDetail="">
                                        @*<caption style="font-size:16px; color:black;">Components(Include in total)</caption>*@
                                        <thead>
                                            <tr>
                                                <th>Payment Date <span style="color: rgb(0, 149, 235);">*</span></th>
                                                <th>No of Days Delay <span style="color: rgb(0, 149, 235);">*</span></th>
                                                <th>Amount Paid <span style="color: rgb(0, 149, 235);">*</span></th>
                                                <th>Interest Rate % <span style="color: rgb(0, 149, 235);">*</span></th>
                                                <th>Interest Amount <span style="color: rgb(0, 149, 235);">*</span></th>
                                                <th>Interest Rate From <span style="color: rgb(0, 149, 235);"></span></th>
                                                <th>Interest Rate To <span style="color: rgb(0, 149, 235);"></span></th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            @*Component Section ENDS here*@
                        </div>

                        @*Start of Adjustment xx1*@
                        <div id="dvAdjustment" style="display: none;">
                            <br />
                            <br />
                            <p><strong style="font-size: 18px; color: black;">Adjustments</strong></p>
                            <hr style="margin-bottom: 5px; border-width: 1px;">
                            <div id="dvAdjustmentAdd" title="Add Adjustment" style="display: none;">
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="text-align: right; padding-right: 10px;"><label>REFERENCE INVOICE</label></td>
                                        <td colspan="3">
                                            <select class="form-control" id="ddlPrefInvoice">
                                                <option value="0" selected="selected">Select</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; padding-right: 10px;"><label>ADJUSTMENT TYPE</label></td>
                                        <td><input type="text" class="form-control adj"></td>
                                        <td style="text-align: right; padding-right: 10px;"><label>AMOUNT</label></td>
                                        <td><input type="text" id="txtAdjAmount" class="form-control adj"></td>
                                    </tr>
                                    <tr style="display: none;">
                                        <td style="text-align: right; padding-right: 10px;"><label>ATTRIBUTE 1</label></td>
                                        <td><input type="text" class="form-control adj"></td>
                                        <td style="text-align: right; padding-right: 10px;"><label>ATTRIBUTE 2</label></td>
                                        <td><input type="text" class="form-control adj"></td>
                                    </tr>
                                    <tr style="display: none;">
                                        <td style="text-align: right; padding-right: 10px;"><label>ATTRIBUTE 3</label></td>
                                        <td><input type="text" class="form-control adj"></td>
                                        <td style="text-align: right; padding-right: 10px;"><label>ATTRIBUTE 4</label></td>
                                        <td><input type="text" class="form-control adj"></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align: right; padding-right: 10px;"><label>REMARKS</label></td>
                                        <td colspan="3"><textarea class="form-control adj" rows="2" cols="20"></textarea></td>
                                    </tr>
                                    <tr>

                                        <td colspan="4" style="padding: 10px; text-align: right;">
                                            <button type="button" tg="0" typ="0" class="btn btn-info" id="btnSaveAdj" name="btnUpload">
                                                Save Adjustment
                                            </button>
                                            <button type="button" id="btnCloseDialogAdj" class="btn btn-default" style="margin-left: 10px;">
                                                Close
                                            </button>
                                        </td>
                                    </tr>

                                </table>
                            </div>
                            <div>
                                <button tabindex="12" type="button" id="btnAddAdjustment" class="btn btn-info">
                                    Add Adjustment
                                </button>
                                <table class="table table-bordered" id="tblADJ" adjdellist="">
                                    <thead>
                                        <tr>
                                            <th style="width: 300px;">REFERENCE INVOICE <span style="color: rgb(0, 149, 235);">*</span></th>
                                            <th style="width: 150px;">ADJUSTMENT TYPE <span style="color: rgb(0, 149, 235);">*</span></th>
                                            <th style="width: 150px;">AMOUNT <span style="color: rgb(0, 149, 235);">*</span></th>
                                            <th>REMARKS</th>
                                            <th class="clsAJDEdit" style="width: 36px;"></th>
                                            <th class="clsAJDDelete" style="width: 36px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        @*END OF dvAdjustment xx1*@


                        @*<strong style="font-size:18px; color:black;">Attachment</strong> <hr style="border-width:1px; margin-bottom:10px;">*@
                        <div class="tab0">
                            &nbsp;
                            <div class="tab1">&nbsp;Attachment</div>
                            <div class="tab2">&nbsp;</div>
                        </div>
                        <div style="background-color: white;">

                            <button tabindex="12" type="button" id="btnAddFiles" class="btn btn-info">
                                Add Attachments
                            </button>

                            <button type="button" id="DownAll" class="btn btn-info">
                                Download All
                            </button>
                            @*<ul id="ulFileList" dellist=""></ul>*@

                            <div>
                                <table class="table table-bordered" dellist="" data-tablesaw-mode="swipe" id="tbl_attach">
                                    <thead>
                                        <tr>
                                            <th scope="col" data-tablesaw-sortable-col="" data-tablesaw-priority="persist">
                                                Title
                                            </th>
                                            <th scope="col" data-tablesaw-sortable-col="" data-tablesaw-priority="persist">
                                                Description
                                            </th>
                                            <th scope="col" data-tablesaw-sortable-col="" data-tablesaw-priority="persist">
                                                Details
                                            </th>
                                            <th class="clstdEdit" style="width: 36px;" scope="col" data-tablesaw-sortable-col="" data-tablesaw-sortable-default-col="" data-tablesaw-priority="3"></th>
                                            @*id="btnFileDel"*@
                                            <th class="clstdDelete" style="width: 36px;" scope="col" data-tablesaw-sortable-col="" data-tablesaw-sortable-default-col="" data-tablesaw-priority="3"></th>
                                            <th class="clstdDownload" scope="col" style="width:36px;text-align:center;" data-tablesaw-sortable-col="" data-tablesaw-sortable-default-col="" data-tablesaw-priority="3">
                                                @*<span customtooltip="Download All" id="DownAll" class="glyphicon glyphicon-download-alt" aria-hidden="true" style="cursor: pointer;color:#0095eb;display:none;"></span>*@
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div>
                            @*<p><strong style="font-size:18px; color:black;">Notes</strong></p>
                                <hr style="margin-bottom: 5px; border-width:1px;">*@
                            <div class="tab0">
                                &nbsp;
                                <div class="tab1">&nbsp;Notes</div>
                                <div class="tab2">&nbsp;</div>
                            </div>
                            <div style="background-color: white;">

                                <div style="display: inline-flex; width: 100%; max-height: 170px; min-height: 170px;">
                                    @*START OF REMARKS DISPLAY*@
                                    <div id="rmxDisplay" style="min-width: 58%; width: inherit; overflow-y: scroll; overflow-x: hidden; display: none;"></div>
                                    @*END OF REMARKS DISPLAY*@
                                    <div class="clsRemarkss" style="min-width: 100%; text-align: right;">
                                        <textarea tabindex="13" maxlength="2000" cols="70" rows="6" id="prevTxtAreaRemarks" style="width: 99%; height: 99%;"></textarea>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <br>
                        <br>

                        @*Osama Start*@

                        <div class="clsDispDiv">
                            <div class="tab0">
                                &nbsp;<div class="tab1">&nbsp;Dispute Attachment</div>
                                <div class="tab2">&nbsp;</div>
                            </div>
                            <div>
                                <table class="table table-bordered" dellist="" data-tablesaw-mode="swipe" id="tbl_dispute_attach">
                                    <thead>
                                        <tr>
                                            <th scope="col" data-tablesaw-sortable-col="" data-tablesaw-priority="persist">
                                                Title
                                            </th>
                                            <th scope="col" data-tablesaw-sortable-col="" data-tablesaw-priority="persist">
                                                Details
                                            </th>

                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="clsDispDiv">
                            <div class="tab0">
                                &nbsp;<div class="tab1">&nbsp;Dispute Notes</div>
                                <div class="tab2">&nbsp;</div>
                            </div>
                            <div style="display: inline-flex; width: 100%; max-height: 170px; min-height: 170px;">
                                <div class="clsDisputeNotes" style="min-width: 100%;text-align: right;">
                                    <textarea cols="70" rows="6" maxlength="2000" id="disputeNotes" style="width: 99%; height: 99%;" readonly></textarea>
                                </div>
                            </div>
                        </div>

                        <div id="rmxDisplayNew" style="min-width: 58%;width: inherit;overflow-y: scroll; overflow-x: hidden;display:none;"></div>
                        <br />
                        @*Osama Ends*@
                        <div class="container" style="width: 100%; margin-bottom: 20px;">
                            <div class="row">
                                @*<div class="col-md-3">*@
                                <div style="display: inline-flex;">
                                    <button style="width: 100%;" class="btn btn-danger" id="btnClear">
                                        Clear All
                                    </button>
                                </div>
                                <div style="display: inline-flex; float: right;">
                                    <div>
                                        <button type="button" style="width: 100%;" class="btn btn-info btnAction" tg="0" id="btnSave" value="Draft">
                                            Save
                                        </button>
                                    </div>
                                    <div style="padding-left: 10px;">
                                        <button type="button" style="width: 100%;" class="btn btn-success btn-anim btnAction" tg="0" id="btnSubmit" value="Submitted">submit</button>
                                    </div>

                                    <div style="display: none; padding-left: 10px;">
                                        <button style="width: 100%;" type="button" class="btn btn-default" id="btnWithDraw">
                                            Withdraw
                                        </button>
                                    </div>
                                    <div style="padding-left: 10px;">
                                        <button style="width: 100%;" type="submit" class="btn btn-default" id="btnCancel">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @*====Body End=====*@
                    </div>

                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var tempDHI;
        var Vname, VsiteID;
        (function () {
            $('#tooltip').remove();
            var _swal = window.swal;

            window.swal = function() {

                var previousWindowKeyDown = window.onkeydown;

                _swal.apply(this, Array.prototype.slice.call(arguments, 0));

                window.onkeydown = previousWindowKeyDown;

            };
        })();

    var $InvList = "";
    var headerID = "";
    //var Token = "";
    var tab = 11;
    var currentUserType;
    var ParClaim = 0.0000, ComClaim = 0.0000;
    // var tempDHI;

    // var data = JSON.parse(sessionStorage.getItem('invHeader'));
    var data = @Html.Raw(@ViewBag.invHeader);
    data.header_id_pk = $.parseJSON(data.header_id_pk);
    data.Interestinvoice_id_pk = $.parseJSON(data.Interestinvoice_id_pk);
    data.UserDTL = $.parseJSON(data.UserDTL)[0];
    currentUserType = data.UserDTL.UserTypeID;

        function checkEmpty(value) {
            debugger;
            var confirm = true, thisControl, pConfirm = true, pText, PthisControl;
            if ($('#invoiceType').val() == 0) {
            swal({
                    title: "Error",
                    text: "Please select invoice type!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $('#invoiceType').focus(), 100)
                    //}
                },
                function() { setTimeout(() => $('#invoiceType').focus(), 100); });
            return false;
        }




        if ($('#invoiceLetterNumber').val() == '') {
            swal({
                    title: "Error",
                    text: "Please enter invoice number!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $('#invoiceLetterNumber').focus(), 100)
                    //}
                },
                function() { setTimeout(() => $('#invoiceLetterNumber').focus(), 100); });
            return false;
        }


        if ($('#invoiceDate').val() == '') {
            swal({
                    title: "Error",
                    text: "Please select invoice date!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "bt btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $('#invoiceDate').focus(), 100)
                    //}
                },
                function() { setTimeout(() => $('#invoiceDate').focus(), 100); });
            return false;
        }
        if ($('#invoicePeriodFrom').val() == '') {
            swal({
                    title: "Error",
                    text: "Please select invoice period from date!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $('#invoicePeriodFrom').focus(), 100)
                    //}
                },
                function() { setTimeout(() => $('#invoicePeriodFrom').focus(), 100); });
            return false;
        }
        if ($('#invoicePeriodTo').val() == '') {
            swal({
                    title: "Error",
                    text: "Please select invoice period to date!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $('#invoicePeriodTo').focus(), 100)
                    //}
                },
                function() { setTimeout(() => $('#invoicePeriodTo').focus(), 100); });
            return false;
        }
        if ($('#invoiceDueDate').val() == '') {
            swal({
                    title: "Error",
                    text: "Please select payment due date!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $('#invoiceDueDate').focus(), 100)
                    //}
                },
                function() { setTimeout(() => $('#invoiceDueDate').focus(), 100); });
            return false;
        }
        //if ($($('#tblPI .blk')[2]).val() == '') {
        //    swal({
        //            title: "Error",
        //            text: "Please select invoice type in 'Parent Invoice' section!",
        //            type: "warning",
        //            showCancelButton: false,
        //            confirmButtonClass: "btn btn-danger",
        //            confirmButtonText: "OK"
        //            //,
        //            //onAfterClose: () => {
        //            //    setTimeout(() => $($('#tblPI .blk')[2]).focus(), 100)
        //            //}
        //        },
        //        function() { setTimeout(() => $($('#tblPI .blk')[2]).focus(), 100); });
        //    return false;
        //}
        //if ($('#preFromDate').val() == '') {
        //    swal({
        //        title: "Error",
        //        text: "Please select period from date in 'Parent Invoice' section!",
        //        type: "warning",
        //        showCancelButton: false,
        //        confirmButtonClass: "btn btn-danger",
        //        confirmButtonText: "OK",
        //        onAfterClose: () => {
        //            setTimeout(() => $('#preFromDate').focus(), 100)
        //        }
        //    });
        //    return false;
        //}
        //if ($('.dtToDate').val() == '') {
        //    swal({
        //        title: "Error",
        //        text: "Please select period to date in 'Parent Invoice' section!",
        //        type: "warning",
        //        showCancelButton: false,
        //        confirmButtonClass: "btn btn-danger",
        //        confirmButtonText: "OK",
        //        onAfterClose: () => {
        //            setTimeout(() => $('.dtToDate').focus(), 100)
        //        }
        //    });
        //    return false;
        //}
        if ($('#tblPI > tbody > tr').length == 0) {
            swal({
                title: "Error",
                text: "Please add at least one parent invoice!",
                type: "warning"
            });
            return false;
        }

            if ($('#tblPI > tbody > tr').length == 0) {
                swal({
                    title: "Error",
                    text: "Please add at least one parent invoice!",
                    type: "warning"
                });
                return false;
            }



            $.each($('#tblPI > tbody > tr'),
                function (x, y) {
                    if ($($(this).find('.blk')[2]).val() == "") {
                        confirm = false;
                        PthisControl = $(this).find('.blk')[2];
                        return false;
                    }



                    if ($($(this).find('.blk')[3]).val() == "") {
                        confirm = false;
                        PthisControl = $(this).find('.blk')[3];
                        return false;
                    }



                    if ($($(this).find('.blk')[4]).val() == "") {
                        confirm = false;
                        PthisControl = $(this).find('.blk')[4];
                        return false;
                    }

                });



            if (!confirm) {
                swal({
                    title: "Error",
                    text: "Marked fields are mandatory in 'Parent Invoice' section",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $(thisControl).focus(), 100)
                    //}
                },
                    function () { setTimeout(() => $(PthisControl).focus(), 100); });
                return false;
            }
        $.each($('#tblComp > tbody > tr'),
            function(x, y) {
                /*			$.each($(this).find('.blk'), function(i,j){
                                if($(this).val() == '' || $(this).val() == '0' || $(this).val() == '0.0000'){
                                    confirm = false;
                                    thisControl = this;
                                    thisErrorText = "All fields are mandatory in 'Payment Details' section!";
                                    return false;
                                }
                                else{
                                    confirm = true;
                                }
                            });
                            if(!confirm){
                                return false;
                            }		*/
                if ($($(this).find('.blk')[0]).val() == "") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[0];
                    return false;
                }
                if ($($(this).find('.blk')[1]).val() == "0") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[1];
                    return false;
                }
                if ($($(this).find('.blk')[2]).val() == "") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[2];
                    return false;
                }
                if ($($(this).find('.blk')[3]).val() == "0.0000") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[3];
                    return false;
                }
                if ($($(this).find('.blk')[4]).val() == "0.0000") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[4];
                    return false;
                }
                //done by tanavush
                /*if ($($(this).find('.blk')[5]).val() == "") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[5];
                    return false;
                }
                if ($($(this).find('.blk')[6]).val() == "") {
                    confirm = false;
                    thisControl = $(this).find('.blk')[6];
                    return false;
                }*/
                confirm = true;
            });
        if (!confirm) {
            swal({
                    title: "Error",
                    text: "Marked fields are mandatory in 'Payment Details' section!",
                    type: "warning",
                    showCancelButton: false,
                    confirmButtonClass: "btn btn-danger",
                    confirmButtonText: "OK"
                    //,
                    //onAfterClose: () => {
                    //    setTimeout(() => $(thisControl).focus(), 100)
                    //}
                },
                function() { setTimeout(() => $(thisControl).focus(), 100); });
        }

        if (value == "Submitted" && $('#tbl_attach > tbody > tr').length == 0) {
            swal({
                title: "Error",
                text: "Please select atleast one attachment!",
                type: "warning"
            });
            return false;
        }
        return confirm;
    }


    function datefun(e) {


        console.log(e.id);


        var fromdate = document.getElementById("invoicePeriodFrom").value;


        var toDate = document.getElementById('invoicePeriodTo').value;

        if (e.id == "invoiceDueDate") {
            if (fromdate == "") {
                swal({
                        title: "Error",
                        text: "Please select 'Invoice Period From' date first!",
                        type: "warning"
                        //,
                        //onAfterClose: () => {
                        //    setTimeout(() => $('#invoicePeriodFrom').focus(), 100)
                        //}
                    },
                    function() { setTimeout(() => $('#invoicePeriodFrom').focus(), 100); });
                e.value = '';
                $(e).datepicker("option", { setDate: null, minDate: null, maxDate: null });
            }

        } else if (e.id == "invoicePeriodFrom") {
            //if ($('#invoiceType').val() != "0") {

            var d1 = Date.parse($(e).val());
            var d2 = Date.parse($('#invoicePeriodTo').val());
            var d3 = Date.parse($('#invoiceDueDate').val());
            if (d1 > d3) {
                $('#invoiceDueDate').datepicker("option", { setDate: null, minDate: null, maxDate: null });
                $('#invoiceDueDate').val('');
            }
            if (d1 > d2) {
                $('#invoicePeriodTo').datepicker("option", { setDate: null, minDate: null, maxDate: null });
                //$('#invoiceDueDate').datepicker("option", { setDate: null, minDate: null, maxDate: null });
                $('#invoicePeriodTo').val('');
                //$('#invoiceDueDate').val('');
            } else {
                $('#invoicePeriodTo').datepicker("option", { setDate: null, minDate: null, maxDate: null });
            }
            //}
        } else if (e.id == "invoicePeriodTo") {
            if (fromdate == "") {
                swal({
                        title: "Error",
                        text: "Please select 'Invoice Period From' Date first!",
                        type: "warning"
                        //,
                        //onAfterClose: () => {
                        //    setTimeout(() => $('#invoicePeriodFrom').focus(), 100)
                        //}
                    },
                    function() { setTimeout(() => $('#invoicePeriodFrom').focus(), 100); });
                e.value = "";
                $(e).datepicker("option", { setDate: null, minDate: null, maxDate: null });
            }
            /*else {
                var d1 = Date.parse($('#invoicePeriodTo').val());
                var d2 = Date.parse($('#invoiceDueDate').val());
                if (d1 > d2) {
                    $('#invoiceDueDate').datepicker("option", { setDate: null, minDate: null, maxDate: null });
                    $('#invoiceDueDate').val('');
                }
                else {
                    $('#invoiceDueDate').datepicker("option", { setDate: null, minDate: null, maxDate: null });
                }
                $('#invoiceDueDate').val($('#invoicePeriodTo').val());
            }*/
        }
        $('#invoicePeriodTo').datepicker('option', 'minDate', $('#invoicePeriodFrom').val());
        $('#invoiceDueDate').datepicker('option', 'minDate', $('#invoicePeriodFrom').val());
    }

    function getParameterByName(name, url) {
        /*if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));*/
        // return sessionStorage.getItem(name);
        var ret = sessionStorage.getItem(name);
        sessionStorage.removeItem(name);
        return ret;
    }

        //------ECM flow call------
        function EcmFileTransfer(diary_id, Vname, VsiteID, abc) {
            debugger;
            var bodyContent = "{\r\n \"diary_header_id\":\"{0}\",\r\n \"Vname\": \"{1}\",\r\n \"VsiteID\": \"{2}\",\r\n \"abc\": \"{3}\"\r\n}";
            bodyContent = bodyContent.FormatRow(diary_id, Vname, VsiteID, abc);

            $.ajax({
                url: "https://prod-68.westeurope.logic.azure.com:443/workflows/53fda254917743979c382f734295c4b3/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=wrWv2TlmEY4sgwkTLAOyBl1pMwBoKkeMF6BIxRd3duY",
                crossDomain: true,
                method: "POST",
                data: bodyContent,
                processData: false,
                headers: {
                    "content-type": "application/json",
                    "cache-control": "no-cache"
                },
                success: function (data) {
                    console.log(data);
                },
                error: function (err) {
                    debugger;
                    var fromdata = new FormData();
                    VsiteID = VsiteID.toString();
                    fromdata.append("diary_id", diary_id);
                    fromdata.append("Vname", Vname);
                    fromdata.append("VsiteID", VsiteID);
                    $.ajax({
                        url: "/Invoice/CreateECMMail" + $(location).attr("search"),
                        method: "POST",
                        data: fromdata,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                            console.log(data);
                        },
                        error: function (err) {
                            console.log(err);
                        }
                    });

                    console.log(err);
                }
            });
        }

    $(document).ready(function() {

        $('body').off('click', '#btnCancel, .btnCloseD');
        $('body').on('click',
            '#btnCancel, .btnCloseD',
            function(e) {
                e.preventDefault();
                goToHome();
            }); //End of edit click

        function goToHome() {
            var options = {};
            var $id = "0½0";
            var fromdata = new FormData();
            fromdata.append('vls', $id);
            $("#pageContainer").hide('slide', options, 300);
            $.ajax({
                type: "POST",
                data: fromdata,
                contentType: false,
                processData: false,
                url: "/Invoice/IppDashboard" + $(location).attr('search'),

                success: function(result) {
                    var options = {};
                    $('#pageContainer').html($(result).find('#pcontent').html());
                    $("#pageContainer").show('slide', options, 500);
                }
            });
        }

        $("#status").val('Draft');
        $('body').on('click',
            '#powerProducer',
            function() {
                LoadInterestInvoice();
            });
        $('body').off('click', '.btnEdit');
        $('body').on('click',
            '.btnEdit',
            function(e) {
                e.preventDefault();
                $('#btnAddAdjustment, .clsAJDEdit, .clsAJDDelete').show();
                $('#viewonly').hide();
                $('#edit').show();
                $('#tblHeaderV').hide();
                $('#tblHeader').show();
                $('#rmxDisplay').show();
                $('#rmxDisplayNew').show();
                $('.clsDispDiv').hide();
                $('.clstdEdit, .clstdDelete').show();
                $('#btnClear').parent().parent().show();
                $('#btnClear').parent().hide();
                $('#interestMode').html('Edit');
                $('#btnAddFiles, .btn-blk-delete, .filedelete, #btnAddRow').show();
                $('#btnadd').parent().show();
                $('#prevTxtAreaRemarks').parent().show();
                $('.dynDiv').remove();
            });


        function LoadInterestInvoice() {

            var DHI = '', LoadFor = '';
            try {
                DHI = getParameterByName('diarynumber');
                LoadFor = getParameterByName('typ');
                vendorSiteId = getParameterByName('vendorSiteId');
                if (LoadFor == "V") {
                    $('#tblHeaderV').show();
                    $('#tblHeader').hide();
                    $('#interestMode').html('View');
                    $('#viewonly').show();
                    $('#edit').hide();
                    $('.clsDispDiv').hide();
                } else if (LoadFor == "E") {
                    $('#interestMode').html('Edit');
                    $('.clsDispDiv').hide();
                }
                else {
                    $('#interestMode').html('Create');
                    $('.clsDispDiv').hide();
                }

            } catch (e) {
                return false;
            }
            if (DHI == '' || DHI == null) {
                return false;
            }
            var fromdata = new FormData();
            fromdata.append("vls", '10½' + DHI + '½' + vendorSiteId);
            $.ajax
            ({
                //type: "GET",
                //url: "https://cppa2.azurewebsites.net/v1/invoice/GetInterestInvoice/" + DHI,
                //dataType: 'json',
                //headers: {
                //    "Token": Token
                //},
                beforeSend: function() {
                    $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                },
                complete: function() {
                    $.unblockUI();
                },
                type: "POST",
                url: "/Invoice/AjaxCall" + $(location).attr("search"),
                data: fromdata,
                contentType: false,
                processData: false,
                success: function(data) {

                    data = $.parseJSON(data);
                    tempDHI = data.DHIHDR.DIARY_HEADER_ID;
                    Vname = data.DHIHDR.VENDOR_NAME;
                    VsiteID = data.DHIHDR.ORGANIZATION_ID;
                    $('#invoicePeriodTo').datepicker("destroy");
                    $('#invoicePeriodTo').datepicker({
                        changeMonth: true,
                        changeYear: true,
                        dateFormat: 'dd-M-yy'
                    });
                    $('#invoicePeriodTo').datepicker('option', 'minDate', data.DHIHDR.INVOICE_PERIOD_FROM);

                    $('#invoiceDueDate').datepicker("destroy");
                    $('#invoiceDueDate').datepicker({
                        changeMonth: true,
                        changeYear: true,
                        dateFormat: 'dd-M-yy'
                    });
                    $('#invoiceDueDate').datepicker('option', 'minDate', data.DHIHDR.INVOICE_PERIOD_FROM);

                    if (data.DHIHDR.TransactionNumber <= 0)
                        $("#diarynumberV").html('');
                    else
                        $("#diarynumberV").html(data.DHIHDR.TransactionNumber);
                    $("#hardCopySub").val(data.DHIHDR.HARD_COPY_SUBMISSION_DATE);
                    $("#hardCopySubTime").val(data.DHIHDR.HARD_COPY_SUBMISSION_TIME);
                    $("#hardCopyType").val(data.DHIHDR.HARD_COPY_SUBMISSION_TYPE);

                    $("#powerProducer").val(data.DHIHDR.VENDOR_NEW_NAME);
                    $("#powerProducerV").html(data.DHIHDR.VENDOR_NAME);
                    $("#producerSite").html('<option selected hid="' +
                        data.DHIHDR.PPA_HEADER_ID +
                        '" value="' +
                        data.DHIHDR.ORGANIZATION_ID +
                        '">' +
                        data.DHIHDR.ADDRESS_LINE1 +
                        '</option>');
                    // $("#producerSite").html('<option selected value="' + data.DHIHDR.ORGANIZATION_ID + '">' + data.DHIHDR.ADDRESS_LINE1 + '</option>');
                    $("#producerSiteV").html(data.DHIHDR.ADDRESS_LINE1);
                    if (data.DHIHDR.APPROVED_STATUS != 'Draft') {
                        $("#submitDate").val(data.DHIHDR.SUBMIT_DATE);
                        $("#submitDateV").html(data.DHIHDR.SUBMIT_DATE);

                    }
                    $("#creationdateV").html(data.DHIHDR.CREATION_DATE);
                    $("#status").val(data.DHIHDR.APPROVED_STATUS);
                    $("#statusV").html(data.DHIHDR.APPROVED_STATUS);
                    $("#invoiceType").html('<option selected  adjustments="' +
                        data.DHIHDR.ADJUSTMENTS +
                        '" tg="' +
                        data.DHIHDR.IS_HOURLY +
                        '" value="' +
                        data.DHIHDR.INVOICE_TYPE_ID +
                        '">' +
                        data.DHIHDR.INVOICE_TYPES +
                        '</option>');
                    $("#invoiceTypeV").html(data.DHIHDR.INVOICE_TYPES);
                    $("#invoiceType").prop('disabled', true);
                    $("#invoiceType").change();

                    if (data.DHIHDR.IS_HOURLY == "N") {
                        $('#invoicePeriodFromTime').val('00:00').attr('disabled', 'disabled');
                        $('#invoicePeriodToTime').val('00:00').attr('disabled', 'disabled');
                        $('#invoicePeriodFromTime').attr('tabindex', '-1');
                        $('#invoicePeriodFromTime').attr('tabindex', '-1');
                    }
                    if (data.DHIHDR.ADJUSTMENTS == "Y") {
                        $('#dvAdjustment').show();
                    }
                    $("#invoiceDueDate").val(data.DHIHDR.INV_DUE_DATE);
                    $("#invoiceDueDateV").html(data.DHIHDR.INV_DUE_DATE);
                    $("#invoiceLetterNumber").val(data.DHIHDR.VEN_INV_LETTER_NO);
                    //$("#invoiceLetterNumber").prop("disabled", true);
                    $("#invoiceLetterNumberV").html(data.DHIHDR.VEN_INV_LETTER_NO);
                    $("#remarks").val(data.DHIHDR.REMARKS);
                    $("#remarksV").html(data.DHIHDR.REMARKS);
                    $("#invoiceDate").val(data.DHIHDR.VEN_INV_LETTER_DATE);
                    $("#invoiceDateV").html(data.DHIHDR.VEN_INV_LETTER_DATE);

                    $("#invoicePeriodTo").val(data.DHIHDR.INVOICE_PERIOD_TO);
                    $("#invoicePeriodToV").html(data.DHIHDR.INVOICE_PERIOD_TO);
                    $("#invoicePeriodFrom").val(data.DHIHDR.INVOICE_PERIOD_FROM);
                    $("#invoicePeriodFromV").html(data.DHIHDR.INVOICE_PERIOD_FROM);
                    $("#invoicePeriodFromTime").val(data.DHIHDR.INVOICE_PERIOD_FROMTIME);
                    $("#invoicePeriodToTime").val(data.DHIHDR.INVOICE_PERIOD_TOTIME);
                    $("#currency").val(data.DHIHDR.CURRENCY);
                    $("#currencyV").html(data.DHIHDR.CURRENCY);
                    $("#totalClaim").val(data.DHIHDR.TOTAL_CLAIM);
                    $("#totalClaimV").html(data.DHIHDR.TOTAL_CLAIM);
                    if (data.DHIHDR.FINANCE_UPDATE_DATE == '') {
                        $('#VreceiveDateTtitle, #VreceiveDateValue').html('');
                    } else {
                        $('#VreceiveDateTtitle').html('<label for="totalClaim">Received Date</label>');
                        $('#VreceiveDateValue').html('<span>' + data.DHIHDR.FINANCE_UPDATE_DATE + '</span>');
                    }
                    $('#btnSave').attr('tg', data.DHIHDR.DIARY_HEADER_ID);

                    $('#tblPI > tbody').html('');
                    $('#tblComp > tbody').html('');

                    var vBhead = '<thead>\
                            <tr>\
                            <th>Pre / Post</th>\
                            <th>Power Generator Inv No</th>\
                            <th>Invoice Type</th>\
                            <th>Period From</th>\
                            <th>Period To</th>\
                            <th>Claimed Amount</th>\
                            <th>Verified Amount</th>\
                            <th>Interest Claim</th>\
                            <th>Remarks</th>\
                                        </tr>\
                                    </thead>';
                    var vChead = '<thead>\
                            <tr>\
                            <th>Payment Date <span style="color:rgb(0, 149, 235);">*</span></th>\
                            <th>No of Days Delay <span style="color:rgb(0, 149, 235);">*</span></th>\
                            <th>Amount Paid <span style="color:rgb(0, 149, 235);">*</span></th>\
                            <th>Interest Rate % <span style="color:rgb(0, 149, 235);">*</span></th>\
                            <th>Interest Amount <span style="color:rgb(0, 149, 235);">*</span></th>\
                            <th>From Date <span style="color:rgb(0, 149, 235);">*</span></th>\
                            <th>End Date <span style="color:rgb(0, 149, 235);">*</span></th>\
                                        </tr>\
                                    </thead >';


                    $.each(data.DTL,
                        function(i, j) {
                            if (currentUserType == 2 || currentUserType == 3) {

                                ParClaim = +(ParClaim + j.CURRENT_CLAIM).toFixed(4);
                            }
                            $('#tblPI > tbody').append('<tr isnew="' +
                                j.DIFF_PAR_ID_PK +
                                '" r="' +
                                j.DIFF_PAR_ID_PK +
                                '" headeridpk="' +
                                j.PARENT_INV_ID_FK +
                                '">  \
                                                <td><span class="radio radio-info"><input type="radio" name="blkRd" class="rd-blk" r="' +
                                j.DIFF_PAR_ID_PK +
                                '" headeridpk="' +
                                j.PARENT_INV_ID_FK +
                                '"></span></td>\
                                                <td><input type="text" class="blk form-control" value="' +
                                j.PRE_POST +
                                '" style="width:110px;" disabled=""></td>\
                                                <td><input type="text" class="blk form-control" value="' +
                                j.IPP_INV_NO +
                                '" style="width:110px;" disabled=""></td> \
                                                <td><select tg="' +
                                j.INVOICE_TYPE +
                                '" tabindex="' +
                                tab +
                                '" class="blk form-control ddl" style="background-color: #FBFFC1;">' +
                                $('#temp').html() +
                                '</select></td> \
                                                <td><input tabindex="' +
                                tab +
                                '" maxlength="11" type="text" class="blk form-control dtpfromDate" readonly value="' +
                                j.PAR_INV_PER_FRM +
                                '" style="width:110px;background-color: #FBFFC1;"></td>  \
                                                <td><input tabindex="' +
                                tab +
                                '" maxlength="11" type="text" class="blk form-control dtToDate" readonly value="' +
                                j.PAR_INV_PER_TO +
                                '" style="width:110px;background-color: #FBFFC1;"></td>  \
                                                                            <td><input tabindex="' +
                                tab +
                                '" maxlength="15" type="text" class="blk form-control clsAddComa" value="' +
                                j.CLAIM_AMOUNT +
                                '" style="width:110px;"></td>   \
                                <td> <input tabindex="' +
                                tab +
                                '" maxlength="15" type="text" class="blk form-control clsAddComa" value="' +
                                j.PAR_INV_AMOUNT +
                                '" style="width:110px;"></td>   \
                                                <td><input type="text" class="blk form-control defClaim" r="' +
                                j.DIFF_PAR_ID_PK +
                                '" value="' +
                                j.CURRENT_CLAIM +
                                '" style="width:110px;" disabled=""></td>\
                                                <td><input tabindex="' +
                                tab +
                                '" maxlength="100" type="text" class="blk form-control" value="' +
                                j.REMARKS +
                                '" style="width:110px;"></td> \
                                                <td style="padding-right:8px;"><i class="ti-trash btn-delete btn-block btn-blk-delete" title="Delete" style="text-align: center;line-height: 2;color: black;background: #c6c6c6; color:red;" r="' +
                                j.DIFF_PAR_ID_PK +
                                '"> </i></td>\
                                                </tr>');
                            tab = tab + 1;
                            var vBdata = '<tr>\
                                            <td>' +
                                j.PRE_POST +
                                '</td>\
<td>' +
                                j.IPP_INV_NO +
                                '</td>\
<td>' +
                                j.INVOICE_TYPE +
                                '</td>\
<td>' +
                                j.PAR_INV_PER_FRM +
                                '</td>\
<td>' +
                                j.PAR_INV_PER_TO +
                                '</td>\
<td>' +
                                numberWithCommas(j.CLAIM_AMOUNT) +
                                '</td>\
<td>' +
                                numberWithCommas(j.PAR_INV_AMOUNT) +
                                '</td>\
<td>' +
                                numberWithCommas(j.CURRENT_CLAIM) +
                                '</td>\
<td>' +
                                j.REMARKS +
                                '</td>\
<tr>';
                            var VcompData = '';
                            if (j.COMPONENTS != null) {
                                var compData = $.parseJSON(j.COMPONENTS);
                                $.each(compData,
                                    function(x, y) {

                                        if (currentUserType == 2 || currentUserType == 3) {

                                            ComClaim = +(ComClaim + y.INTEREST_AMOUNT).toFixed(4);
                                        }
                                        $('#tblComp > tbody').append('<tr isnew="' +
                                            y.INT_DET_ID_PK +
                                            '"  r="' +
                                            j.DIFF_PAR_ID_PK +
                                            '" bid="' +
                                            y.INT_DET_ID_PK +
                                            '" style="display:none;"> \
                                <td><input type="text" class="blk form-control dtDate" style="background-color:rgb(251, 255, 193);" value="' +
                                            y.PAYMENT_DATE +
                                            '" readonly ></td>\
                                <td><input type="text" class="blk form-control clsNoOfDays" predays="' +
                                            y.NO_OF_DAYS +
                                            '" value="' +
                                            y.NO_OF_DAYS +
                                            '"></td>\
                                <td><input type="text" class="blk form-control clsAddComa" value="' +
                                            y.AMOUNT_PAID +
                                            '"></td>\
                                <td><input type="text" class="blk form-control clsAddComa clsInterestRate" prevalue="' +
                                            y.INTEREST_RATE +
                                            '" value="' +
                                            y.INTEREST_RATE +
                                            '"></td>\
                                <td><input type="text" class="blk form-control clsClaim" value="' +
                                            y.INTEREST_AMOUNT +
                                            '" r="' +
                                            j.DIFF_PAR_ID_PK +
                                            '"></td>\
                                <td><input type="text" class="blk form-control dtcfromDate" style="background-color:rgb(251, 255, 193);" value="' +
                                            y.FROM_DATE +
                                            '" readonly ></td>\
                                <td><input type="text" class="blk form-control dtEndDate" style="background-color:rgb(251, 255, 193);" value="' +
                                            y.End_DATE +
                                            '" readonly ></td>\
                                <td style="padding-right:8px;"><i class="ti-trash btn-detail-delete btn-block" title="Delete" style="text-align: center;line-height: 2;color: black;background: #c6c6c6; color:red;" r="' +
                                            j.DIFF_PAR_ID_PK +
                                            '"> </i></td>\
                                </tr>');

                                        VcompData += '<tr>\
                                    <td>' +
                                            y.PAYMENT_DATE +
                                            '</td>\
                                        <td>' +
                                            y.NO_OF_DAYS +
                                            '</td>\
                                        <td>' +
                                            numberWithCommas(y.AMOUNT_PAID) +
                                            '</td>\
                                        <td>' +
                                            y.INTEREST_RATE +
                                            '</td>\
                                        <td>' +
                                            numberWithCommas(y.INTEREST_AMOUNT) +
                                            '</td>\
                                        <td>' +
                                            y.FROM_DATE +
                                            '</td>\
                                    <td>' +
                                            y.End_DATE +
                                            '</td>\
                                    </tr> ';

                                    }); //end inner loop

                            }

                            $('#viewContainer').append('<div>\
                            <table class="table table-bordered">' +
                                vBhead +
                                '<tbody>' +
                                vBdata +
                                '</tbody></table>\
                            <table class="table table-bordered" style="margin-left: 10%;width:90%;"><caption style="font-size: 13px;font-weight: bold;color:black;">Payment Details</caption>' +
                                vChead +
                                '<tbody>' +
                                VcompData +
                                '</tbody></table>\
                            </div>');
                        }); //end of first each

                    $('.ddl').each(function(x, y) {
                        $(this).val($(this).attr('tg'));
                    });

                    $('#tblADJ tbody').html('');
                    $.each(data.AdjList,
                        function(a, b) {
                            $('#tblADJ tbody').append('<tr aid="' +
                                b.ADJ_HEADER_ID +
                                '">\
<td>' +
                                b.REFERENCE_INVOICE_NUMBER +
                                '</td>\
<td>' +
                                b.ADJ_TYPES +
                                '</td>\
<td>' +
                                numberWithCommas(b.ADJ_AMOUNT) +
                                '</td>\
<td>' +
                                b.REMARKS +
                                '</td>\
<td class="clsAJDEdit"><center><span class="adjedit zmdi zmdi-edit" style="cursor:pointer;color:#0095eb;font-size: 1.5em;"></span></center></td>\
<td class="clsAJDDelete"><center><span class="adjdelete zmdi zmdi-delete" style="cursor: pointer; color: red; font-size: 1.5em; display: inline-block;"></span></center></td>\
');
                        });
                    $('#btnAddAdjustment, .clsAJDEdit, .clsAJDDelete').hide();
                    addComma();
                    if (data.DHIHDR.SubmittionRemarks != null) {
                        try {
                            var rlist = data.DHIHDR.SubmittionRemarks.toString().split("¼");
                            $('#rmxDisplay').html('');
                            $.each(rlist,
                                function(i, j) {
                                    var rmx = j.split("½");
                                    $('#rmxDisplay').append('<div class="remarks-wrap">\
                                <img class= "remarks-img" src = "/Content/img/user1.png" />\
                                <div class="remarks-comment" data-owner="' +
                                        rmx[1] +
                                        ' ' +
                                        rmx[2] +
                                        '">\
                                    <p>' +
                                        rmx[3] +
                                        '</p>\
                                </div>\
                                        </div >');
                                });
                        } catch (e) {
                            $('#rmxDisplay').html('');
                        }
                    }
                    $('#rmxDisplay').show();
                    $('#prevTxtAreaRemarks').parent().attr('style', 'min-width: 42%;text-align: right;');
                    $("#tbl_attach > tbody").html('');
                    //var fileButtons = '';
                    //$.each(data.FList,
                    //    function(i, j) {
                    //        //$("#ulFileList").append('<li class="files" fileid="' + j.ATTACH_HEADER_ID + '"  fname="' + j.FILE_NAME + '"   base64=""> <span download="' + j.FILE_NAME + '">' + j.ATTACHMENT_TITLE + '</span>&nbsp;&nbsp;&nbsp;<label class="filedelete" style="cursor:pointer;">Delete File</label><label class="dnload" fname="' + j.FILE_NAME + '"  fileid="' + j.ATTACH_HEADER_ID + '" style="cursor: pointer;float: right; margin-right: 40px;">Download</label></li>');
                    //        //if (LoadFor == 'E') {
                    //        //    fileButtons = '<td><center><span class="filedelete zmdi zmdi-delete" style="cursor:pointer;color:red;"></span></center></td><td><center><span class="dnload zmdi zmdi-format-valign-bottom zmdi-hc-2x" fname="' + j.FILE_NAME + '"  fileid="' + j.ATTACH_HEADER_ID + '" style="cursor: pointer;color:#0095eb;"></span></center></td>';
                    //        //}
                    //        //else if (LoadFor == 'V') {
                    //        //    $('#btnFileDel').remove();
                    //        //    fileButtons = '<td><center><span class="dnload zmdi zmdi-format-valign-bottom zmdi-hc-2x" fname="' + j.FILE_NAME + '"  fileid="' + j.ATTACH_HEADER_ID + '" style="cursor: pointer;color:#0095eb;"></span></center></td>';
                    //        //}

                    //        var fileNameExists = fileNames.includes(j.FILE_NAME);
                    //        if (!fileNameExists) {
                    //            fileNames.push(j.FILE_NAME);
                    //        }
                    //        else {
                    //            swal({
                    //                title: "Error",
                    //                text: "Selected file has already been attached! Please select a different file.",
                    //                type: "warning"
                    //            });
                    //            return false;
                    //        }
                    //        $("#tbl_attach > tbody").append('<tr class="files" fileid="' +
                    //            j.ATTACH_HEADER_ID +
                    //            '"  fname="' +
                    //            j.FILE_NAME +
                    //            '" ftitle="' +
                    //            j.ATTACHMENT_TITLE +
                    //            '" fdescription="' +
                    //            j.ATTACHMENT_DESC +
                    //            '"  base64=""><td><span download="' +
                    //            j.FILE_NAME +
                    //            '">' +
                    //            j.ATTACHMENT_TITLE +
                    //            '</span></td><td><span>' +
                    //            j.ATTACHMENT_DESC +
                    //            '</span></td><td><span>' +
                    //            j.FILE_NAME +
                    //            '</span></td>\
                    //    <td class="clstdEdit"><center><span class="fileedit zmdi zmdi-edit" style="cursor:pointer;color:#0095eb;font-size: 1.5em;"></span></center></td>\
                    //    <td class="clstdDelete"><center><span class="filedelete zmdi zmdi-delete" style="cursor:pointer;color:red;font-size: 1.5em;"></span></center></td>\
                    //    <td><center><span class="dnload zmdi zmdi-format-valign-bottom zmdi-hc-2x" fileid="' +
                    //            j.ATTACH_HEADER_ID +
                    //            '" style="cursor: pointer;color:#0095eb;"></span></center></td></tr>');
                    //    });

                    $.each(data.FList,
                        function (i, j) {

                            debugger;
                            var fileNameExists = fileNames.includes(j.FILE_NAME);
                            if (j.FILE_NAME == '') {
                                $("#DownAll").hide();
                            }
                            else {
                                $("#DownAll").show();
                            }

                            if (!fileNameExists) {
                                fileNames.push(j.FILE_NAME);
                            }
                            else {
                                swal({
                                    title: "Error",
                                    text: "Selected file has already been attached! Please select a different file.",
                                    type: "warning"
                                });
                                return false;
                            }
                            if (j.FILE_LINK != null) {
                                $("#tbl_attach > tbody").append('<tr class="files" fileid="' + j.ATTACH_HEADER_ID + '"  fname="' + j.FILE_LINK + '" ftitle="' + j.ATTACHMENT_TITLE + '" fdescription="' + j.ATTACHMENT_DESC + '"  base64=""><td><span download="' + j.FILE_LINK + '">' + j.ATTACHMENT_TITLE + '</span></td><td><span>' + j.ATTACHMENT_DESC + '</span></td><td><span> <a target="_blank" style ="color:blue;" href="' + j.FILE_LINK + '">' + j.FILE_LINK + '</span></td>\
                                <td class="clstdEdit"><center><span class="fileedit zmdi zmdi-edit" style="cursor:pointer;color:#0095eb;font-size: 1.5em;"></span></center></td>\
                                <td class="clstdDelete"><center><span class="filedelete zmdi zmdi-delete" style="cursor:pointer;color:red;font-size: 1.5em;"></span></center></td>\
                                 <td><center><a target="_blank" style ="color:blue;" href="' + j.FILE_LINK + '">' + '<span class=" zmdi zmdi-format-valign-bottom zmdi-hc-2x" fileid="' + j.ATTACH_HEADER_ID + '" style="cursor: pointer;color:#0095eb;"></span>' + ' </a></center></td></tr>');
                            }
                            else {
                                $("#tbl_attach > tbody").append('<tr class="files" fileid="' + j.ATTACH_HEADER_ID + '"  fname="' + j.FILE_NAME + '" ftitle="' + j.ATTACHMENT_TITLE + '" fdescription="' + j.ATTACHMENT_DESC + '"  base64=""><td><span download="' + j.FILE_NAME + '">' + j.ATTACHMENT_TITLE + '</span></td><td><span>' + j.ATTACHMENT_DESC + '</span></td><td><span>' + j.FILE_NAME + '</span></td>\
                            <td class="clstdEdit"><center><span class="fileedit zmdi zmdi-edit" style="cursor:pointer;color:#0095eb;font-size: 1.5em;"></span></center></td>\
                            <td class="clstdDelete"><center><span class="filedelete zmdi zmdi-delete" style="cursor:pointer;color:red;font-size: 1.5em;"></span></center></td>\
                            <td><center><span class="dnload zmdi zmdi-format-valign-bottom zmdi-hc-2x" fileid="' + j.ATTACH_HEADER_ID + '" style="cursor: pointer;color:#0095eb;"></span></center></td></tr>');
                            }
                        });
                    //Osama


                    //Append Dispute Attachment Osama
                    debugger;
                    $.each(JSON.parse(data.DispAttach), function (i, j) {
                        var dispData = JSON.parse(data.DispAttach);
                        if (dispData.length != 0) {
                            if (dispData[i].SHOW_ON_PORTAL == 'Y') {
                                if (dispData[i].File_Link != null) {
                                    $('.clsDispDiv').show();
                                    if (dispData[i].File_Name != null && dispData[i].File_Name != "") {
                                        $("#tbl_dispute_attach > tbody").append('<tr class="files" fileid="' + dispData[i].Dispute_Attach_Id + '"  fname="' + dispData[i].File_Name + '" fdescription="' + dispData[i].File_Name + '"  base64="">\
                        <td><span>' + dispData[i].File_Name + '</span></td>\
                        <td><center><a target="_blank" style ="color:blue;" href="' + dispData[i].File_Link + '">' + '<span class="zmdi zmdi-format-valign-bottom zmdi-hc-2x" filedata="1" fileid="' + dispData[i].DISP_ATT_PK + '" style="cursor: pointer;color:#0095eb;"></span></center></td></tr>');
                                    }
                                    $("textarea#disputeNotes").val(dispData[0].DISPUTE_REMARKS);
                                }
                                else {
                                    $('.clsDispDiv').show();
                                    if (dispData[i].File_Name != null && dispData[i].File_Name != "") {
                                        $("#tbl_dispute_attach > tbody").append('<tr class="files" fileid="' + dispData[i].Dispute_Attach_Id + '"  fname="' + dispData[i].File_Name + '" fdescription="' + dispData[i].File_Name + '"  base64="">\
                        <td><span>' + dispData[i].File_Name + '</span></td>\
                        <td><center><span class="dnloadDisp zmdi zmdi-format-valign-bottom zmdi-hc-2x" filedata="1" fileid="' + dispData[i].DISP_ATT_PK + '" style="cursor: pointer;color:#0095eb;"></span></center></td></tr>');
                                    }
                                }

                                $("textarea#disputeNotes").val(dispData[0].DISPUTE_REMARKS);
                            }
                        }
                    });






                    $('.clstdEdit, .clstdDelete').hide();
                    if (data.UserDtl.utyp == "4") {
                        if (data.DHIHDR.APPROVED_STATUS == "Submitted" || data.DHIHDR.APPROVED_STATUS == "Received") {
                            $('#btnClear').parent().parent().hide();
                            $('#btnAddFiles, .btn-blk-delete, .filedelete, #btnAddRow').hide();
                            $('#btnadd').parent().hide();
                            $('#prevTxtAreaRemarks').parent().hide();
                            //$('#rmxDisplay').parent().parent()
                            //    .append(
                            //        '<div style="width:100%;padding-top: 35px;text-align: right;"><a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');
                            $('#rmxDisplayNew').parent().parent().append('<div style="width:100%;padding-top: 35px;text-align: right;"><a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');
                        } else {
                            $('#btnClear').parent().parent().hide();
                            $('#btnAddFiles, .btn-blk-delete, .filedelete, #btnAddRow').hide();
                            $('#btnadd').parent().hide();
                            $('#prevTxtAreaRemarks').parent().hide();
                            //$('#rmxDisplay').parent().parent().append(
                            //    '<div class="dynDiv" style="width:100%;padding-top: 35px;text-align: right;"><button type="button" class="btn btn-success btn-anim btnEdit">Edit</button> <a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');
                            $('#rmxDisplayNew').parent().parent().append('<div class="dynDiv" style="width:100%;padding-top: 35px;text-align: right;"><button type="button" class="btn btn-success btn-anim btnEdit">Edit</button> <a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');
                            if (data.DHIHDR.APPROVED_STATUS == "Returned") {
                                $('#btnWithDraw').parent().show();
                            }
                            if (data.DHIHDR.APPROVED_STATUS == "Withdraw" ||
                                data.DHIHDR.APPROVED_STATUS == "Claim Returned" ||
                                data.DHIHDR.APPROVED_STATUS == "Verified" ||
                                data.DHIHDR.APPROVED_STATUS == "Fully Paid" ||
                                data.DHIHDR.APPROVED_STATUS == "Partially Paid") {
                                $('.btnEdit').remove();
                            }
                        }
                    }
                    $('#hardCopyTR').hide();
                    if (data.UserDtl.utyp == "1" || data.UserDtl.utyp == "16") {
                        TechnicalHide();
                    }
                    else if (data.UserDtl.uid == 428) {
                        debugger;
                        $('#hardCopyTR').hide();
                        TechnicalHide();
                    }
                    else if (data.UserDtl.utyp == "2") {
                        if (data.DHIHDR.APPROVED_STATUS == "Submitted" && data.DHIHDR.IS_APPROVED_BY_TECHNICAL == "1") {
                            $('#status').val('Forwarded to Finance');
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Received" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == "1") {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Returned" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == "0") {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Returned" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == "1") {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Verified" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == 1) {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Fully Paid" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == 1) {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Claim Returned" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == 1) {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Submitted" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == "0") {
                            //TechnicalHide();
                            //$('#dynDiv').show();
                            showBtns(data);
                        } else if (data.DHIHDR.APPROVED_STATUS == "Submitted" &&
                            data.DHIHDR.IS_APPROVED_BY_TECHNICAL == null) {
                            showBtns(data);
                        } else if (data.DHIHDR.APPROVED_STATUS == "Received" && data.DHIHDR.IS_APPROVED_BY_TECHNICAL == null) {
                            showBtns(data);
                        }
                    }
                    if (data.UserDtl.utyp == "3") {
                        if (data.UserDtl.uid != 428) {
                            $('#hardCopyTR').show();
                        }
                        if (data.DHIHDR.APPROVED_STATUS != 'Submitted') {
                            $('#hardCopySub').prop('disabled', true);
                            $('#hardCopySubTime').prop('disabled', true);
                            $('#hardCopyType').prop('disabled', true);
                        } else {
                            $('#hardCopySub').prop('disabled', false);
                            $('#hardCopySubTime').prop('disabled', false);
                            $('#hardCopyType').prop('disabled', false);
                        }
                        if (data.DHIHDR.APPROVED_STATUS == "Received" && data.DHIHDR.IS_APPROVED_BY_FINANCE == "1") {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Returned" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == "0") {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Returned" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == "1") {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Submitted" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == "0") {
                            showBtns(data);
                        } else if (data.DHIHDR.APPROVED_STATUS == "Verified" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == 1) {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Fully Paid" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == 1) {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Claim Returned" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == 1) {
                            TechnicalHide();
                        } else if (data.DHIHDR.APPROVED_STATUS == "Submitted" &&
                            data.DHIHDR.IS_APPROVED_BY_FINANCE == null && data.UserDtl.uid != 428) {
                            showBtns(data);
                        }
                        else if (data.DHIHDR.APPROVED_STATUS == "Received" && data.DHIHDR.IS_APPROVED_BY_FINANCE == null && data.UserDtl.uid != 428) {
                            showBtns(data);
                        }
                    }

                    if (LoadFor == "V") {
                        $('.blk, .clsClaim, .txtRemarks').prop('disabled', true);
                    }
                    if (LoadFor == "E" && data.UserDtl.utyp == "4") {
                        LoadInvoiceList();
                        $($('.btnEdit')[0]).click();
                    }

                    $('#totalClaimV').html($('#totalClaim').val());

                    $('.dtToDate').datepicker("destroy");
                    $('.dtToDate').datepicker({
                        changeMonth: true,
                        changeYear: true,
                        dateFormat: 'dd-M-yy'
                    });
                    var thisCtrl;
                    $.each($('.dtToDate'),
                        function() {
                            thisCtrl = $($(this).parent().parent().find('.dtpfromDate')[0]).val();
                            $(this).datepicker('option', 'minDate', thisCtrl);
                        });
                }, //END OF AJAX SUCCESS
                error: function(request, textStatus, errorThrown) {
                    // alert(request.getResponseHeader('some_header'));
                    $.unblockUI();
                }
            }); //END OF AJAX CALL
        } //END OF LoadInterestInvoice FUNCTION


        function showBtns(data) {
            $('#btnClear').parent().parent().hide();
            $('#btnAddFiles, .btn-blk-delete, .filedelete, #btnAddRow').hide();
            $('#btnadd').parent().hide();

            $('#rmxDisplay').parent().parent().append(
                '<div class="dynDiv" style="width:100%;padding-top: 35px;text-align: right;">\
                                    <button type="button" tg="Received" style="margin-right: 20px;" class="btn btn-success btn-anim clsAction" id="btnAccept" uid="' +
                data.UserDtl.uid +
                '" utyp="' +
                data.UserDtl.utyp +
                '" uname="' +
                data.UserDtl.Name +
                '"  dhiid="' +
                data.DHIHDR.DIARY_HEADER_ID +
                '">\
                                            Receive Invoice\
                                        </button >\
<button type="button" tg="Returned" style="margin-right: 20px;" class="btn btn-danger  btn-anim clsAction" id="btnReject" uid="' +
                data.UserDtl.uid +
                '" utyp="' +
                data.UserDtl.utyp +
                '" uname="' +
                data.UserDtl.Name +
                '" dhiid="' +
                data.DHIHDR.DIARY_HEADER_ID +
                '">\
Return to Power Producer\
                                        </button > <a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');

        }

        function TechnicalHide() {
            $('#btnClear').parent().parent().hide();
            $('#btnAddFiles, .btn-blk-delete, .filedelete, #btnAddRow').hide();
            $('#btnadd').parent().hide();
            $('#prevTxtAreaRemarks').parent().hide();
            //$('#rmxDisplay').parent().parent()
            //    .append(
            //        '<div style="width:100%;padding-top: 35px;text-align: right;"><a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');
            $('#rmxDisplayNew').parent().parent().append('<div style="width:100%;padding-top: 35px;text-align: right;"><a style="color: white;" class="btn btn-danger btnCloseD" href="#">Close</a></div>');
        }

        $('body').off('click', '#btnClear');
        $('body').on('click',
            '#btnClear',
            function(e) {
                e.preventDefault();
                swal({
                        title: "Are you sure?",
                        text: "You are going to clear all fields!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "Yes, Clear all",
                        cancelButtonText: "No, cancel"
                    },
                    function() {
                        if (sitesLength > 1) {
                            $('#producerSite').val('0');
                            $("#producerSite").attr('disabled', false);
                            $("#producerSite").attr('tabindex', '1');
                        }
                        $("#invoiceType").val("0");
                        $("#invoiceType").attr('disabled', false);
                        $("#PreText").val("");
                        $("#ddlAddBlock").val("0");
                        $("#tblPI > tbody").html("");
                        $("#tblPI > tbody").attr("dellblock", "");
                        $("#tblComp > tbody").html("");
                        $("#invoiceType").trigger("change");
                        $("#invoiceDueDate").val("");
                        $("#invoiceLetterNumber").val("");
                        $("#invoiceLetterNumber").prop("disabled", false);
                        $("#invoiceDate").val("");
                        $("#invoicePeriodFrom").val("");
                        $("#invoicePeriodTo").val("");
                        $("#remarks").val("");
                        //$("#parentInvoice").val("0");
                        $("#prevTxtAreaRemarks").val("");
                        $("#totalClaim").val("");
                        $('#attachmentFile').val('');
                        //$('#ulFileList').html('');
                        $("#tbl_attach > tbody").html('');
                        $("#invoicePeriodFromTime")[0].selectedIndex = 0;
                        $("#invoicePeriodToTime")[0].selectedIndex = 0;
                        try {
                            if ($.browser.msie) {
                                $('#attachmentFile').replaceWith($('#attachmentFile').clone());
                            } else {
                                $('#attachmentFile').val('');
                            }
                            $('#attachmentFile').html('');
                        } catch (e) {
                            console.log(e);
                        }
                        swal("Cleared!", "All feilds have been cleared.", "success");
                    });

                //    .then((result) => {
                //    if (result.value) {

                //    } else {
                //        swal("Cancelled", "", "error");
                //    }
                //});
            });

        /*$('body').off('click', '.clsAction');
        $('body').on('click', '.clsAction', function (e) {
            var $val = $(this).attr('tg');
            var $id = $(this).attr('dhiid');

            swal({
                title: "Are you sure?",
                text: "",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn btn-danger",
                confirmButtonText: "Yes, Continue",
                cancelButtonText: "No, cancel"
            }).then((result) => {
                        if (result.value) {
                        e.preventDefault();
                        var $myForm = $id + "½" + $val + "½" + $('#prevTxtAreaRemarks').val() + '½' + $('#hardCopySub').val() + '½' + $('#hardCopySubTime').val();
                        console.log($myForm);
                        var fromdata = new FormData();
                        fromdata.append("strFormData", $myForm);
                        var choice = {};
                        choice.url = "https://cppa2.azurewebsites.net/v1/invoice/UpdateRemarks";
                        choice.type = "POST";
                        choice.data = fromdata;
                        //choice.headers = { "Token": Token };
                        choice.contentType = false;
                        choice.processData = false;
                        choice.beforeSend = function () {
                           // $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                        };
                        choice.complete = function () {
                           // $.unblockUI();
                        };
                        choice.success = function (result) {

                            if (result == "1") {
                                swal("Invoice!", "Invoice has been " + $val + " successfully.", "success", {
                                    button: "Continue!",
                                });
                                //location.href = _spPageContextInfo.webAbsoluteUrl + "/Pages/Home.aspx";
                                goToHome();
                            }
                            else {
                                swal({
                                    title: "Error!",
                                    text: result,
                                    type: "warning"
                                });
                            }

                        };
                        choice.error = function (err) {
                            console.log(err.statusText);
                        };
                        $.ajax(choice);
                        swal("Complete!", "", "success");
                    } else {
                        swal("Cancelled!", "", "error");
                    }
                });

        });*/ // end of save button

        // PRE FORM SETTINGS STARTED
        try {
            Token = ""; // sessionStorage.getItem('apiToken');
            $("#tokenkey").val('');
            //var data = JSON.parse(sessionStorage.getItem('invHeader'));
            var data = @Html.Raw(@ViewBag.invHeader);
            data.header_id_pk = $.parseJSON(data.header_id_pk);
            data.Interestinvoice_id_pk = $.parseJSON(data.Interestinvoice_id_pk);
            data.UserDTL = $.parseJSON(data.UserDTL)[0];
            if ($('#temp').html() == '') {
                var opt =
                    '<option></option><option value="BONUS">Bonus</option><option value="CPP">Capacity Purchase Price</option><option value="ENVIRONMENTAL COST">Environmental Cost</option><option value="EPP">Energy Purchase Price</option><option value="GST">General Sales Tax</option><option value="INS">Insurance Cost</option><option value="OCC(OPEN CYCLE COST)">OCC(Open Cycle Cost)</option><option value="PLAC">PLAC</option><option value="STARTUP">Startup</option><option value="SUPPLEMENTARY CHARGES">Supplementary Charges</option><option value="TRUE DOWN">True down</option><option value="TRUE UP">TRUE UP</option><option value="WHT ON DIVIDEND">WHT on Dividend</option><option value="PASS THROUGH">Pass Through</option>';
                //$.each(data.invoice_id_pk, function (x, y) {
                //    opt += '<option>' + y.INVOICE_TYPES + '</option>'
                //});
                $('#temp').html(opt);
            }

            var sitesLength = data.header_id_pk.length;
            var invVendorId = data.header_id_pk[0].VENDOR_ID;
        } catch (e) {
        }
        var producerSite = '';
        for (var i = 0; i < sitesLength; i++) {

            vendorID = data.header_id_pk[i].VENDOR_ID;
            $('#vendorID').val(vendorID);
            vendorName = data.header_id_pk[i].VENDOR_NAME;
            verndorSiteID = data.header_id_pk[i].VENDOR_SITE_ID;
            if (data.header_id_pk[i].ADDRESS_LINE1 != producerSite) {
                producerSite = data.header_id_pk[i].ADDRESS_LINE1;
                if (i == 0 && data.header_id_pk.length == 1) {
                    $("#producerSite").append('<option hid="' +
                        data.header_id_pk[i].HEADER_ID_PK +
                        '" selected="selected" value="' +
                        data.header_id_pk[i].VENDOR_SITE_ID +
                        '">' +
                        producerSite +
                        '</option>');

                    //  $("#producerSite").append('<option selected="selected" value="' + data.header_id_pk[i].VENDOR_SITE_ID + '">' + producerSite + '</option>');
                    $("#producerSite").attr('disabled', true);


                    $.each(data.Interestinvoice_id_pk,
                        function(i, clue) {
                            $("#invoiceType").append('<option adjustments="' +
                                clue.ADJUSTMENTS +
                                '" tg="' +
                                clue.IS_HOURLY +
                                '" value="' +
                                clue.APP_INVOICES_ID_PK +
                                '">' +
                                clue.INVOICE_TYPES +
                                '</option>');

                        });

                    LoadInvoiceList();
                } else {
                    $("#producerSite").attr('disabled', false);
                    $("#producerSite").append('<option hid="' +
                        data.header_id_pk[i].HEADER_ID_PK +
                        '" value="' +
                        data.header_id_pk[i].VENDOR_SITE_ID +
                        '">' +
                        producerSite +
                        '</option>');

                    //  $("#producerSite").append('<option value="' + data.header_id_pk[i].VENDOR_SITE_ID + '">' + producerSite + '</option>');
                }
            }
            headerID = data.header_id_pk[i].HEADER_ID_PK;
            $("#headerID").val(headerID);
            $("#powerProducer").val(vendorName);

        }
        /*  data.Interestinvoice_id_pk.sort(function (a, b) {
              var textA = a.INVOICE_TYPES.toUpperCase();
              var textB = b.INVOICE_TYPES.toUpperCase();
              return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;
          });
          $.each(data.Interestinvoice_id_pk, function (i, clue) {
              $("#invoiceType").append('<option adjustments="' + clue.ADJUSTMENTS + '" tg="' + clue.IS_HOURLY + '" value="' + clue.APP_INVOICES_ID_PK + '">' + clue.INVOICE_TYPES + '</option>');
          }); */

        $('body').on('focus',
            ".dtDate",
            function() {
                $(this).datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'dd-M-yy'
                });
            });

        $('body').on('focus',
            ".dtToDate",
            function() {
                $(this).datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'dd-M-yy',
                    minDate: $($(this).parent().prev().children()[0]).val()
                });
            });

        $('body').on('change',
            ".dtToDate",
            function() {
                if ($($(this).parent().prev().children()[0]).val() == '') {
                    swal({
                        title: "Error",
                        text: "Please select from date first!",
                        type: "warning"
                    });
                    $(this).val('');
                    return false;
                }
            });

        $('body').on('focus',
            ".dtcfromDate",
            function() {
                var control = $($(this).parent().next().children()[0]);
                $(this).datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'dd-M-yy',
                    onSelect: function(dateText) {
                        var d1 = Date.parse($(this).val());
                        var d2 = Date.parse($(control).val());
                        if (d1 > d2) {
                            $(control).val('');
                        }
                        $(control).datepicker("option", { setDate: null, minDate: null, maxDate: null });
                        $(control).datepicker("option", "minDate", $(this).val());
                    }
                });
            });

        $('body').on('focus',
            ".dtpfromDate",
            function() {
                var control = $($(this).parent().next().children()[0]);
                $(this).datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'dd-M-yy',
                    onSelect: function(dateText) {
                        var d1 = Date.parse($(this).val());
                        var d2 = Date.parse($(control).val());
                        if (d1 > d2) {
                            $(control).val('');
                        }
                        $(control).datepicker("option", { setDate: null, minDate: null, maxDate: null });
                        $(control).datepicker("option", "minDate", $(this).val());
                    }
                });
            });

        $('body').on('focus',
            ".dtEndDate",
            function() {
                $(this).datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'dd-M-yy',
                    minDate: $($(this).parent().prev().children()[0]).val()
                });
            });


        $('body').on('change',
            ".dtEndDate",
            function() {
                if ($($(this).parent().prev().children()[0]).val() == '') {
                    swal({
                        title: "Error",
                        text: "Please select from date first!",
                        type: "warning"
                    });
                    $(this).val('');
                    return false;
                }
            });

        /*    $('body').on('change', "#preFromDate", function () {
                $($('#preFromDate').parent().next().children()[0]).val('');
            });*/

        $('#invoiceDueDate, #invoiceDate, #invoicePeriodFrom,#invoicePeriodTo, #hardCopySub').datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'dd-M-yy'
        });


        ///PRE FORM SETTINGS END
        ///PRE FORM SETTINGS END
        ///PRE FORM SETTINGS END
        ///PRE FORM SETTINGS END


        $('body').off('change', '#pp');
        $('body').on('change',
            '#pp',
            function(e) {
                e.preventDefault();
                if ($(this).val() == "PRE") {
                    $("#PreText").show();
                    $("#ddlAddBlock").hide();
                } else {
                    $("#PreText").val('');
                    $("#PreText").hide();
                    $("#ddlAddBlock").show();
                }
            });
        $('body').off('change', '#invoiceType');
        $('body').on('change',
            '#invoiceType',
            function(e) {
                e.preventDefault();
                ////////////////////////////////////////////////////////////////////////////////////
                // Interest / Late Payment Charge//// only Post

                if ($(this).find(':selected').attr('adjustments') == "Y") {
                    $('#dvAdjustment').show();
                } else {
                    $('#dvAdjustment').hide();
                }
                loadAdjInvDll();

                var v = $(this).val();
                var txt = $('#invoiceType option[value="' + v + '"]').text();
                if (txt == "Pre Live Interest") {
                    $("#PreText").show();
                    $("#pp").val('PRE');
                    $("#pp").show();
                    $("#ddlAddBlock").hide();
                    $("#btnadd").show();
                    $("#pFromPI").html('Period From <span style="color:rgb(0, 149, 235);">*</span>');
                    $("#pToPI").html('Period To <span style="color:rgb(0, 149, 235);">*</span>');
                } else if (txt == "Interest / Late Payment Charge") {
                    $("#PreText").val('');
                    $("#PreText").hide();
                    $("#pp").show();
                    $("#pp").val('POST');
                    $("#ddlAddBlock").show();
                    $("#btnadd").show();
                    $("#pFromPI").html('Period From');
                    $("#pToPI").html('Period To');
                } else {
                    $("#PreText").hide();
                    $("#ddlAddBlock").hide();
                    $("#btnadd").hide();
                    $("#pp").hide();
                }
            });


        $('body').off('change', '#producerSite');
        $('body').on('change',
            '#producerSite',
            function(e) {


                e.preventDefault();


                $("#invoiceType").html('<option value="0">Select</option>');
                var siteId = $(this).val();
                var fromdata = new FormData();
                fromdata.append("vls", '11½' + siteId);
                $.ajax
                ({
                    //type: "GET",
                    //url: "https://cppa2.azurewebsites.net/v1/invoice/GetInterestInvoiceTypes?siteid=" + siteId,
                    //dataType: 'json',
                    //headers: {
                    //    "Token": Token
                    //},
                    beforeSend: function() {
                        $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });

                    },
                    complete: function() {
                        $.unblockUI();
                    },
                    type: "POST",
                    url: "/Invoice/AjaxCall" + $(location).attr("search"),
                    data: fromdata,
                    contentType: false,
                    processData: false,
                    dataType: 'json',
                    success: function(data) {


                        $.each(data,
                            function(i, clue) {
                                $("#invoiceType").append('<option adjustments="' +
                                    clue.ADJUSTMENTS +
                                    '"  tg="' +
                                    clue.IS_HOURLY +
                                    '" value="' +
                                    clue.APP_INVOICES_ID_PK +
                                    '">' +
                                    clue.INVOICE_TYPES +
                                    '</option>');
                            });
                        headerID = $("option:selected", this).attr("hid");

                        LoadInvoiceList();
                    },
                    error: function(request, textStatus, errorThrown) {

                        $.unblockUI();
                    }
                });
            });


        $('body').off('change', '#txtAdjAmount');
        $('body').on('change',
            '#txtAdjAmount',
            function(event) {
                var v = $(this).val();
                $(this).val(numberWithCommas(v));
            });

        function removeComma() {
            $('#totalClaim, .clsClaim, .defClaim, .clsAddComa').each(function(index, element) {
                var $val = $(this).val().replace(/,/g, '');
                $(this).val($val);
            });
        }

        function addComma() {
            $('#totalClaim, .clsClaim, .defClaim, .clsAddComa').each(function(index, element) {
                var $val = $(this).val().replace(/,/g, '');
                $val = numberWithCommas($val);
                $(this).val($val);
            });
        }

        function numberWithCommas(x) {
            // return x.toString().replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            x = x.toString();
            if (x % 1 == 0) {
                if (x.indexOf(".") < 0) {
                    x = x.replace(/\D-/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    x += ".0000";
                } else {
                    x = x.replace('.0000', '').replace('.000', '').replace('.00', '').replace('.0', '');
                    x = x.replace(/\D-/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                    x += ".0000";

                }
            } else {
                var index = x.indexOf(".");
                var p1 = x.substring(0, index);
                p1 = p1.replace(/\D-/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                var p2 = x.substring(index);
                p2 = p2 + "0000";
                p2 = p2.substring(0, 5);
                x = p1 + p2;
            }
            return x;
        }


        $('body').off('click', '#btnAddRow');
        $('body').on('click',
            '#btnAddRow',
            function(e) {
                e.preventDefault();
                var flg = false;
                var r = '';
                $('.rd-blk').each(function(i, j) {
                    if ($(this).is(':checked')) {
                        flg = true;
                        r = $(this).attr('r');
                    }
                });
                if (flg) {
                    $('#tblComp > tbody').append('<tr r="' +
                        r +
                        '" bid="0" isnew="0">\
            <td><input type="text" class="blk form-control dtDate" value="" readonly /></td>\
            <td><input type="text" class="blk form-control clsNoOfDays" predays="0" value="0" /></td>\
            <td><input type="text" class="blk form-control clsAddComa" value="0.0000" /></td>\
            <td><input type="text" class="blk form-control clsAddComa clsInterestRate" prevalue="0.0000" value="0.0000" /></td>\
            <td><input type="text" class="blk form-control clsClaim" value="0.0000" r="' +
                        r +
                        '" /></td>\
            <td><input type="text" class="blk form-control dtcfromDate"  value="" readonly /></td>\
            <td><input type="text" class="blk form-control dtEndDate" value="" readonly /></td>\
            <td style="padding-right:8px;"><i class="ti-trash btn-detail-delete btn-block" title="Delete" style="text-align: center;line-height: 2;color: black;background: #c6c6c6; color:red;" r="' +
                        r +
                        '"> </i></td>\
</tr>');
                } else {
                    swal({
                        title: "Error",
                        text: "Please select at least one parent invoice...!",
                        type: "warning"
                    });
                    return false;
                }
                var tabLength = $('#tblComp > tbody > tr[r="' + r + '"] > td > input').attr('tabindex');
                if ($('#tblComp > tbody > tr').length > 1) {
                    $('#tblComp > tbody > tr[r="' + r + '"] > td > input').attr('tabindex', tabLength);
                } else if ($('#tblComp > tbody > tr').length == 1) {
                    tabLength = $($('#tblPI > tbody > tr[r="' + r + '"]:last > td:last').prev().children()[0])
                        .attr('tabindex');
                    tabLength = tabLength + 1;
                    $('#tblComp > tbody > tr[r="' + r + '"] > td > input').attr('tabindex', tabLength);
                }
                $('#btnAddFiles').attr('tabindex', ++tabLength);
                $('#prevTxtAreaRemarks').attr('tabindex', ++tabLength);
            });

        $('body').off('click', '.btn-detail-delete');
        $('body').on('click',
            '.btn-detail-delete',
            function (e) {

                e.preventDefault();
                removeComma();
                var $tr = $(this).parent().parent();
                var $r = $(this).parent().parent().attr('isnew');
                if ($r != "0") {
                    var $val = $('#tblComp').attr('delDetail');
                    if ($val == "") {
                        $('#tblComp').attr('delDetail', $r);
                    } else {
                        $('#tblComp').attr('delDetail', $val + '½' + $r);
                    }
                }
                $tr.remove();




                var rID = $(this).attr('r');
                var ttl = parseFloat(0);
                $('.clsClaim[r="' + rID + '"]').each(function(i, j) {
                    try {
                        if ($(this).val() == '')
                            return;
                        ttl = +(ttl + parseFloat($(this).val())).toFixed(4);
                        // var x = parseFloat($(this).val());
                        //ttl += x;
                    } catch (e) {
                        return false;
                    }
                }); //end of each
                // ttl=ttl.toFixed(4);
                $('.defClaim[r="' + rID + '"]').val(ttl);

                var ttlx = parseFloat(0);
                $('.clsClaim').each(function(x, y) {
                    try {
                        ttlx = +(ttlx + parseFloat($(this).val())).toFixed(4);
                        // var x = parseFloat($(this).val());
                        //ttlx += x;
                    } catch (e) {
                        return false;
                    }
                });
                //ParClaim=ttlx;
                $('#totalClaim').val(ttlx);

                if ($('.btn-detail-delete[r="' + rID + '"]').length == 0) {
                    $('.btn-blk-delete[r="' + rID + '"]').click();
                }
                addComma();
            });

        $('body').off('click', '.btn-blk-delete');
        $('body').on('click',
            '.btn-blk-delete',
            function(e) {
                e.preventDefault();
                var $tr = $(this).parent().parent();
                var $r = $(this).attr('r');

                if ($tr.attr('isnew') != "0") {
                    var $val = $('#tblPI').attr('dellblock');
                    if ($val == "") {
                        $('#tblPI').attr('dellblock', $tr.attr('isnew'));
                    } else {
                        $('#tblPI').attr('dellblock', $val + '½' + $tr.attr('isnew'));
                    }
                }


                $('#tblPI tbody tr[r="' + $r + '"]').remove();
                $('#tblComp tbody tr[r="' + $r + '"]').remove();

                if ($('#tblPI > tbody > tr').length > 0) {
                    var tabLength = $($('#tblPI > tbody > tr:last > td:last').prev().children()[0]).attr('tabindex');
                    $('#tblComp > tbody > tr[r="' + $r + '"] > td > input').attr('tabindex', ++tabLength);
                    $('#btnAddFiles').attr('tabindex', ++tabLength);
                    $('#prevTxtAreaRemarks').attr('tabindex', ++tabLength);
                } else {
                    $('#btnAddFiles').attr('tabindex', '15');
                    $('#prevTxtAreaRemarks').attr('tabindex', '16');
                }

                if ($('#tblPI tbody tr').length <= 0) {
                    $('#invoiceType').prop('disabled', false);
                } else {
                    $('#invoiceType').prop('disabled', true);
                }
                removeComma();
                var ttlx = parseFloat(0);
                $('.defClaim').each(function(x, y) {
                    try {
                        ttlx = +(ttlx + parseFloat($(this).val())).toFixed(4);
                        // var x = parseFloat($(this).val());
                        //ttlx += x;
                    } catch (e) {
                        return false;
                    }
                });
                //ParClaim=ttlx;
                $('#totalClaim').val(ttlx);
                addComma();

            }); ///END OF DELETE CLICK



        var rno = 0;
        $('body').off('click', '#btnadd');
        $('body').on('click',
            '#btnadd',
            function(e) {
                e.preventDefault();
                headerID = $('#producerSite option:selected').attr('hid');

                rno = rno + 1;
                //if ($('#pp').val() == "PRE") {
                if ($('#invoiceType option:selected').text() == "Pre Live Interest") {

                    if ($('#pp').val() == "PRE") {
                        if ($('#PreText').val() == "") {
                            swal({
                                title: "Error",
                                text: "Please enter valid Invoice Number...!",
                                type: "warning"
                            });
                            return false;
                        }

                        /*if ($('#tblPI tbody tr').length > 0) {

                            swal({
                                title: "Error",
                                text: "Only one Pre-Live Interest Invoice can be added...!",
                                type: "warning"
                            });
                            return false;
                        }*/

                        $('#tblPI tbody').append('<tr r="' +
                            rno +
                            '" headeridpk="0" isnew="0">  <td><span class="radio radio-info"><input type="radio" name="blkRd" class="rd-blk" r="' +
                            rno +
                            '" headeridpk="0"></span></td>\
                                          <td><input type="text" class="blk form-control" value="Pre" style="width:110px;" disabled /></td>\
                                          <td><input type="text" class="blk form-control" value="' +
                            $("#PreText").val() +
                            '" style="width:110px;" disabled /></td>\
                                          <td><select tabindex="' +
                            tab +
                            '" class="blk form-control" style="background-color: #FBFFC1;">' +
                            $('#temp').html() +
                            '</select></td>\
                                          <td><input tabindex="' +
                            tab +
                            '" maxlength="11" type="text" class="blk form-control dtpfromDate" value=""  style="width:110px;background-color: #FBFFC1;" readonly /></td>\
                                          <td><input tabindex="' +
                            tab +
                            '" maxlength="11" type="text" class="blk form-control dtToDate" value=""  style="width:110px;background-color: #FBFFC1;" readonly /></td>\
                                          <td><input tabindex="' +
                            tab +
                            '" maxlength="15" type="text" class="blk form-control clsAddComa" value="0.0000" style="width:110px;" /></td>\
                                          <td><input tabindex="' +
                            tab +
                            '" maxlength="15" type="text" class="blk form-control clsAddComa" value="0.0000" style="width:110px;" /></td>\
                                          <td><input type="text" class="blk form-control defClaim"  r="' +
                            rno +
                            '"  value="0.0000" style="width:110px;" disabled /></td>\
                                          <td><input tabindex="' +
                            tab +
                            '" maxlength="100" type="text" class="blk form-control" value="" style="width:110px;" /></td>\
                                          <td style="padding-right:8px;"><i class="ti-trash btn-delete btn-block btn-blk-delete" title="Delete" style="text-align: center;line-height: 2;color: black;background: #c6c6c6; color:red;" r="' +
                            rno +
                            '"> </i></td></tr>');
                        tab = tab + 1;
                        //LoadBlockComponentListPre(0, rno);
                        $('#PreText').val('');
                    } else {
                        swal({
                                title: "Error",
                                text:
                                    "Please select a valid parent invoice in lieu of invoice type at header level...!",
                                type: "warning"
                                //,
                                //onAfterClose: () => {
                                //    setTimeout(() => $('#invoiceType').focus(), 100)
                                //}
                            },
                            function() { setTimeout(() => $('#invoiceType').focus(), 100); });
                        return false;
                    }
                } // end of first if for pree
                else {
                    if ($('#pp').val() == "PRE") {
                        swal({
                                title: "Error",
                                text:
                                    "Please select a valid parent invoice in lieu of invoice type at header level...!",
                                type: "warning"
                                //,
                                //onAfterClose: () => {
                                //    setTimeout(() => $('#invoiceType').focus(), 100)
                                //}
                            },
                            function() { setTimeout(() => $('#invoiceType').focus(), 100); });
                        return false;
                    } else {
                        if ($('#tblPI tbody tr[headeridpk="' + $('#ddlAddBlock').val() + '"]').length > 0) {
                            swal({
                                title: "Error",
                                text: "The invoice is already selected...!",
                                type: "warning"
                            });
                            return false;
                        }
                        $.each($InvList,
                            function(i, j) {
                                if (j.HEADER_ID_PK == $("#ddlAddBlock").val()) {

                                    $('#tblPI tbody').append('<tr r="' +
                                        rno +
                                        '" headeridpk="' +
                                        j.HEADER_ID_PK +
                                        '" isnew="0">  <td><span class="radio radio-info"><input type="radio" name="blkRd" class="rd-blk" r="' +
                                        rno +
                                        '" headeridpk="' +
                                        j.HEADER_ID_PK +
                                        '"></span></td>\
                                                                <td><input type="text" class="blk form-control" value="Post" style="width:110px;" disabled /></td>\
                                                                <td><input type="text" class="blk form-control" value="' +
                                        j.VENDOR_INV_NO +
                                        '" style="width:110px;" disabled /></td>\
                                                                <td><input type="text" class="blk form-control" value="' +
                                        j.INV_TYPE +
                                        '" style="width:110px;" disabled /></td>\
                                                                <td><input type="text" class="blk form-control dtpfromDate" value="' +
                                        j.INV_PERIOD_FRM +
                                        '" style="width:110px;" disabled /></td>\
                                                                <td><input type="text" class="blk form-control dtToDate" value="' +
                                        j.INV_PERIOD_TO +
                                        '" style="width:110px;" disabled /></td>\
                                                                <td><input type="text" class="blk form-control clsAddComa" value="' +
                                        j.TOTAL_CLAIMED_AMOUNT +
                                        '" style="width:110px;" disabled /></td>\
                                                                <td> <input type="text" class="blk form-control clsAddComa" value="' +
                                        j.TOT_INC_GST_CL +
                                        '" style="width:110px;" disabled /></td>\
                                                                <td><input type="text"  r="' +
                                        rno +
                                        '"  class="blk form-control defClaim" value="0.0000" style="width:110px;" disabled /></td>\
                                                                <td><input tabindex="' +
                                        tab +
                                        '" type="text" class="blk form-control" value="" style="width:110px;" /></td>\
                                                                <td style="padding-right:8px;"><i class="ti-trash btn-delete btn-block btn-blk-delete" title="Delete" style="text-align: center;line-height: 2;color: black;background: #c6c6c6; color:red;" r="' +
                                        rno +
                                        '"> </i></td></tr>');
                                    // LoadBlockComponentList(j.HEADER_ID_PK, rno);
                                    tab = tab + 1;
                                }

                            });
                    }
                }
                $('#invoiceType').attr('disabled', true);
                addComma();
                var tabLength = $($('#tblPI > tbody > tr:last > td:last').prev().children()[0]).attr('tabindex');
                $('#tblComp > tbody > tr[r="' + $('.rd-blk:checked').attr('r') + '"] > td > input')
                    .attr('tabindex', ++tabLength);
                $('#btnAddFiles').attr('tabindex', ++tabLength);
                $('#prevTxtAreaRemarks').attr('tabindex', ++tabLength);
            }); //end of btnAddInvice


        $('body').off('keyup', '.clsInterestRate');
        $('body').on('keyup',
            '.clsInterestRate',
            function() {
                if (parseFloat($(this).val()) > 100) {
                    var thisC = this;
                    swal({
                            title: "Error",
                            text: "Interest Rate must be between 0 to 100!",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK"
                        },
                        function() {
                            //swal.close();
                            $(thisC).val($(thisC).attr('prevalue'));
                            addComma();
                        });
                    //.then((result) => {
                    //    if (result.value) {

                    //    }
                    //});
                }
            }); //end of key up

        $('body').off('keyup', '.clsNoOfDays');
        $('body').on('keyup',
            '.clsNoOfDays',
            function() {
                if (parseInt($(this).val()) > 10000) {
                    swal({
                        title: "Error",
                        text: "Limit of delay days is exceeded(0-10000)!",
                        type: "warning"
                    });
                    $(this).val($(this).attr('predays'));
                }

            }); //end of key up

        $('body').off('keypress', '.clsNoOfDays');
        $('body').on('keypress',
            '.clsNoOfDays',
            function(event) {
                removeComma();

                var keyCode = event.keyCode || event.which;
                if (keyCode == 9) {
                    e.preventDefault();
                    // call custom function here
                }
                var $this = $(this);
                if (((event.which < 48 || event.which > 57) &&
                    (event.which != 0 && event.which != 8))) {
                    event.preventDefault();

                }
            }); // END OF KEY PRESS

        $('body').off('keypress', '.clsClaim, .clsAddComa, #txtAdjAmount');
        $('body').on('keypress',
            '.clsClaim, .clsAddComa, #txtAdjAmount',
            function(event) {
                removeComma();

                var checkNegative = $(this).val();
                var len = $(this).val().length;
                //condition to allow only one minus sign in number
                if (checkNegative.match("-") && event.which == 45) {
                    event.preventDefault();
                }
                //condition to allow minus sign only on first place, 2-3 is invalid, -23 is valid
                if (event.which == 45 && len > 0) {
                    event.preventDefault();
                }


                if (event.which == 45 && $(this).hasClass("clsInterestRate")) {
                    event.preventDefault();
                }

                if (event.which == 45 && this.id == "txtAdjAmount") {
                    event.preventDefault();
                }


                var keyCode = event.keyCode || event.which;
                if (keyCode == 9) {
                    e.preventDefault();
                    // call custom function here
                }
                var $this = $(this);
                if ((event.which != 46 || $this.val().indexOf('.') != -1) &&
                    ((event.which != 45 && (event.which < 48 || event.which > 57)) &&
                        (event.which != 0 && event.which != 8))) {
                    event.preventDefault();

                }


                var text = $(this).val();
                text = text.replace(/,/g, '');
                if ((event.which == 46) && (text.indexOf('.') == -1)) {
                    setTimeout(function() {
                            if ($this.val().substring($this.val().indexOf('.')).length > 5) {
                                $this.val($this.val().substring(0, $this.val().indexOf('.') + 5));
                            }
                        },
                        1);
                }

                if ((text.indexOf('.') != -1) &&
                    (text.substring(text.indexOf('.')).length > 4) &&
                    (event.which != 0 && event.which != 8) &&
                    ($(this)[0].selectionStart >= text.length - 4)) {
                    event.preventDefault();
                }

            }); // END OF KEY PRESS

        $('body').off('change', '.clsClaim, .clsAddComa');
        $('body').on('change',
            '.clsClaim, .clsAddComa',
            function(event) {
                removeComma();
                var rID = $(this).attr('r');
                var ttl = parseFloat(0);
                $('.clsClaim[r="' + rID + '"]').each(function(i, j) {
                    try {
                        if ($(this).val() == '')
                            return;
                        ttl = +(ttl + parseFloat($(this).val())).toFixed(4);
                        // var x = parseFloat($(this).val());
                        //ttl += x;
                    } catch (e) {
                        return false;
                    }
                }); //end of each
                // ttl=ttl.toFixed(4);
                $('.defClaim[r="' + rID + '"]').val(ttl);

                var ttlx = parseFloat(0);

                $('.defClaim').each(function(x, y) {
                    try {
                        ttlx = +(ttlx + parseFloat($(this).val())).toFixed(4);
                        // var x = parseFloat($(this).val());
                        //ttlx += x;
                    } catch (e) {
                        return false;
                    }
                });
                //ParClaim=ttlx;
                $('#totalClaim').val(ttlx);

                addComma();
            }); //END OF CHANGE


        $('body').off("paste", '.clsClaim, .clsAddComa, #txtAdjAmount');
        $('body').on("paste",
            '.clsClaim, .clsAddComa, #txtAdjAmount',
            function (e) {
                debugger;

                var thisCtrl = this;
                var text = e.originalEvent.clipboardData.getData('Text');
                text = text.replace(/,/g, '');
                text = text.trim().replace(/\s/g, '');
                if ($.isNumeric(text)) {
                    if ((text.substring(text.indexOf('.')).length >= 5) && (text.indexOf('.') > -1)) {
                        e.preventDefault();
                        setTimeout(function () {
                            $(thisCtrl).val(text.substring(0, text.indexOf('.') + 5));
                            $(thisCtrl).change();

                        }, 250);
                    }
                    else if (parseFloat(text) < 0) {
                        e.preventDefault();
                    }
                    else {
                        //
                        setTimeout(function () {
                            $(thisCtrl).val(text);
                        }, 250);
                    }

                } else {
                    e.preventDefault();
                    swal({
                        title: "Invalid Input",
                        text: "Please enter only numeric values!",
                        type: "warning",
                        showCancelButton: false,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK",
                        //onAfterClose: () => {
                        //    setTimeout(() => $(this).focus(), 100)
                        //}
                    },
                        function () { setTimeout(() => $(thisCtrl).focus(), 100); });

                }
            });
        $('body').off('click', '.rd-blk');
        $('body').on('click',
            '.rd-blk',
            function(e) {
                // e.preventDefault();
                var rNo = $(this).attr('r');
                var tabLength = $($('#tblPI > tbody > tr:last > td:last').prev().children()[0]).attr('tabindex');
                $('#tblComp > tbody > tr[r="' + rNo + '"] > td > input').attr('tabindex', ++tabLength);
                $('#btnAddFiles').attr('tabindex', ++tabLength);
                $('#prevTxtAreaRemarks').attr('tabindex', ++tabLength);
                $('#tblComp > tbody > tr').hide();
                $('#tblComp > tbody > tr[r="' + rNo + '"]').show();


            }); //END OF RADIO BUTTON CLICK

        function LoadInvoiceList() {
            var siteid = $('#producerSite').val();
            var fromdata = new FormData();
            fromdata.append("vls", '12½' + siteid);
            $.ajax
            ({
                //type: "GET",
                //url: "https://cppa2.azurewebsites.net/v1/invoice/GetIList/" + siteid,
                //dataType: 'json',
                //headers: {
                //    "Token": Token
                //},
                beforeSend: function() {
                    $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                },
                complete: function() {
                    $.unblockUI();
                },
                type: "POST",
                url: "/Invoice/AjaxCall" + $(location).attr("search"),
                data: fromdata,
                contentType: false,
                processData: false,
                success: function(data) {
                    $InvList = $.parseJSON(data);
                    $.each($InvList,
                        function(i, j) {
                            $('#ddlAddBlock')
                                .append('<option value="' + j.HEADER_ID_PK + '">' + j.VENDOR_INV_NO + '</option>');
                        });
                },
                error: function(request, textStatus, errorThrown) {
                    // alert(request.getResponseHeader('some_header'));
                    $.unblockUI();
                }
            });
        }

        function LoadBlockComponentListPre(id, rNo) {
            var fromdata = new FormData();
            fromdata.append("vls", '0½' + headerID + '½' + $('#producerSite').val() + '½' + $('#invoiceType').val());
            $.ajax
            ({
                //type: "GET",
                //url: "https://cppa2.azurewebsites.net/v1/PPABlkFuel/ByPPAandInvTypes4Create?ppaHeaderid=" + headerID + "&ppaInvTypeID=" + $('#invoiceType').val(),
                //dataType: 'json',
                //headers: {
                //    "Token": Token
                //},
                beforeSend: function() {
                    $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                },
                complete: function() {
                    $.unblockUI();
                },
                type: "POST",
                url: "/Invoice/AjaxCall" + $(location).attr("search"),
                data: fromdata,
                contentType: false,
                processData: false,
                success: function(data) {
                    data = $.parseJSON(data);

                    $.each(data,
                        function(i, j) {
                            var compData = $.parseJSON(j.COMPONENTS);
                            $.each(compData,
                                function(x, y) {
                                    if (y.IS_INCLUDE_IN_TOTAL == 'YES') {
                                        $('#tblComp > tbody').append('<tr r="' +
                                            rNo +
                                            '" blkid="' +
                                            j.BLK_FUEL_ID_PK +
                                            '" compid="' +
                                            y.COM_DEF_ID_FK +
                                            '" style="display:none;">\
                                                            <td>' +
                                            j.BLOCK_NO +
                                            '</td>\
                                                            <td>' +
                                            j.FUEL_TYPE +
                                            '</td>\
                                                            <td>' +
                                            y.COMP_NAME +
                                            '</td>\
                                                            <td>' +
                                            y.UNIT +
                                            '</td>\
                                                            <td><input type="text" value="0.0000" class="blk form-control clsClaim" r="' +
                                            rNo +
                                            '" blkid="' +
                                            j.BLK_FUEL_ID_PK +
                                            '" compid="' +
                                            y.COM_DEF_ID_FK +
                                            '" /></td>\
                                                            <td><input type="text" value="" class="blk form-control txtRemarks" r="' +
                                            rNo +
                                            '" blkid="' +
                                            j.BLK_FUEL_ID_PK +
                                            '" compid="' +
                                            y.COM_DEF_ID_FK +
                                            '" /></td>\
                                                            </tr>');
                                    }

                                }); //END OF COMP


                        }); //END OF BLOCK
                },
                error: function(request, textStatus, errorThrown) {
                    // alert(request.getResponseHeader('some_header'));
                    $.unblockUI();
                }
            });
        }

        function LoadBlockComponentList(id, rNo) {
            var fromdata = new FormData();
            fromdata.append("vls", '8½' + id);
            $.ajax
            ({
                //type: "GET",
                //url: "https://cppa2.azurewebsites.net/v1/invoice/GetCList/" + id,
                //dataType: 'json',
                //headers: {
                //    "Token": Token
                //},
                beforeSend: function() {
                    $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                },
                complete: function() {
                    $.unblockUI();
                },
                type: "POST",
                url: "/Invoice/AjaxCall" + $(location).attr("search"),
                data: fromdata,
                contentType: false,
                processData: false,
                success: function(data) {
                    data = $.parseJSON(data);

                    $.each(data,
                        function(i, j) {

                            $('#tblComp > tbody').append('<tr r="' +
                                rNo +
                                '" blkid="' +
                                j.BLK_FUEL_ID_PK +
                                '" compid="' +
                                j.COMP_DEF_ID_PK +
                                '" style="display:none;">\
                                                            <td>' +
                                j.BLOCK_NO +
                                '</td>\
                                                            <td>' +
                                j.FUEL_TYPE +
                                '</td>\
                                                            <td>' +
                                j.COMP_NAME +
                                '</td>\
                                                            <td>' +
                                j.UNIT +
                                '</td>\
                                                            <td><input type="text" value="0.0000" class="blk form-control clsClaim" r="' +
                                rNo +
                                '" blkid="' +
                                j.BLK_FUEL_ID_PK +
                                '" compid="' +
                                j.COMP_DEF_ID_PK +
                                '" /></td>\
                                                            <td><input type="text" value="" class="blk form-control txtRemarks" r="' +
                                rNo +
                                '" blkid="' +
                                j.BLK_FUEL_ID_PK +
                                '" compid="' +
                                j.COMP_DEF_ID_PK +
                                '" /></td>\
                                                            </tr>');
                        });
                },
                error: function(request, textStatus, errorThrown) {
                    // alert(request.getResponseHeader('some_header'));
                    $.unblockUI();
                }
            });
        }

        //FILE ATTACHMENTS STARTED
        //FILE ATTACHMENTS STARTED
        //FILE ATTACHMENTS STARTED
        //FILE ATTACHMENTS STARTED

        $('#myModal').dialog({
            autoOpen: false,
            height: 455,
            width: 650,
            modal: true,
            show: {
                effect: "clip",
                duration: 500
            },
            hide: {
                effect: "clip",
                duration: 500
            }
        });


        $('body').off('click', '#btnAddFiles');
        $('body').on('click',
            '#btnAddFiles',
            function(e) {
                e.preventDefault();
                $('#attachmentTitle').val('');
                $('#attachmentDesc').val('');
                $('#btnUpload').attr('tg', '0');
                $('#btnUpload').attr('typ', "0");
                $('#myModal').dialog('open');
            }); //end of btnAddFiles

        $('body').off("click", '#btnCloseDialog');
        $('body').on("click",
            '#btnCloseDialog',
            function(e) {
                e.preventDefault();
                $('#myModal').dialog('close');
                $('#attachmentTitle').val('');
                $('#attachmentDesc').val('');
                $('#attachmentFile').val('');
                try {
                    if ($.browser.msie) {
                        $('#attachmentFile').replaceWith($('#attachmentFile').clone());
                    } else {
                        $('#attachmentFile').val('');
                    }
                    $('#attachmentFile').html('');
                } catch (e) {
                    return false;
                }
            });
        var fileNames = [];
        $('body').off('click', '#btnUpload');
        $('body').on('click',
            '#btnUpload',
            function(e) {
                e.preventDefault();
                var $typ = $(this).attr('typ');
                var $tg = $(this).attr('tg');
                if ($('#attachmentFile')[0].files.length == 0 && $(this).attr('typ') == "0") {
                    swal({
                        title: "Error",
                        text: "Please Select File!",
                        type: "warning"
                    });
                    return false;
                }

                var fullPath = $('#attachmentFile').val(); // Get the full file path
                var fileNameWithExtension = fullPath.split('\\').pop(); // Extract the filename with extension
                var fileNameWithoutExtension = fileNameWithExtension.split('.').slice(0, -1).join('.'); // Remove the extension


                // Validate the file name (allow only alphabets, numbers, and spaces)
                var alphanumericPattern = /^[a-zA-Z0-9\s.-]*$/;
                if (!alphanumericPattern.test(fileNameWithoutExtension)) {
                    swal({
                        title: "Error",
                        text: "File name can only contain alphabets, numbers, and spaces! Please rename the file and try again.",
                        type: "warning"
                    });
                    return false;
                }
                if ($('#attachmentTitle').val() == '') {
                    swal({
                        title: "Error",
                        text: "Please enter attachment title!",
                        type: "warning"
                    });
                    return false;
                }
                if ($('#attachmentFile')[0].files.length == 0 && $typ == "1") {
                    $('#tbl_attach tbody tr[bisedit="bisedit"]').attr('ftitle', $('#attachmentTitle').val());
                    $('#tbl_attach tbody tr[bisedit="bisedit"]').attr('fdescription', $('#attachmentDesc').val());
                    $($('#tbl_attach tbody tr[bisedit="bisedit"]').find('td')[0])
                        .html('<span>' + $('#attachmentTitle').val() + '</span>');
                    $($('#tbl_attach tbody tr[bisedit="bisedit"]').find('td')[1])
                        .html('<span>' + $('#attachmentDesc').val() + '</span>');
                    if ($tg != "0") {
                        $('#tbl_attach tbody tr[bisedit="bisedit"]').attr('fileupdate', 'fileupdate');
                    }
                    $('#myModal').dialog('close');
                    return false;
                } else if ($('#attachmentFile')[0].files.length > 0 && $typ == "1") {
                    $($('#tbl_attach tbody tr[bisedit="bisedit"]').find('.filedelete')[0]).click();
                    $('#tbl_attach tbody tr[bisedit="bisedit"]').remove();


                }

                var fileTitle = $('#attachmentTitle').val();
                var fileDesc = $('#attachmentDesc').val();
                var file = $('#attachmentFile')[0].files[0],
                    fileName = file.name,
                    fileType = file.type,
                    fileSize = file.size;
                var fileNameExists = fileNames.includes(fileName);
                if (!fileNameExists) {
                    fileNames.push(fileName);
                }
                else {
                    swal({
                        title: "Error",
                        text: "Selected file has already been attached! Please select a different file.",
                        type: "warning"
                    });
                    return false;
                }

                var fileExt = fileName.split('.').pop();

                if (fileExt == 'rar') {
                    fileType = 'application/x-rar-compressed, application/octet-stream';
                } else if (fileExt == 'zip') {
                    fileType = 'application/zip';
                }

                var sizeLimit = 0, fileSizeMsg = '';
                if (fileType == 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                    fileType == 'application/vnd.ms-excel' ||
                    fileType == 'application/pdf') {
                    sizeLimit = 5242880;
                    fileSizeMsg = "File size must be less than 5MB!";
                } else {
                    sizeLimit = 2097152;
                    fileSizeMsg = "File size must be less than 2MB!";
                }

                if (fileSize > sizeLimit) {
                    swal({
                        title: "Error",
                        text: fileSizeMsg,
                        type: "warning"
                    });
                    return false;
                }

                var filedata;
                var input = $('#attachmentFile');
                var reader = new FileReader();
                reader.onload = function() {
                    var arrayBuffer = reader.result;

                    arrayBuffer = arrayBuffer.substring(arrayBuffer.indexOf(",") + 1);
                    var base64String = arrayBuffer;
                    var ext = fileName.split('.').pop();
                    //$("#ulFileList").append('<li class="files" fileid="0" fext=".' + ext + '" ftype="' + fileType + '" fname="' + fileName + '" ftitle="' + $('#attachmentTitle').val() + '" fdescription="' + $('#attachmentDesc').val() + '"  base64="' + base64String + '"> <a href="data:' + fileType + ";base64," + base64String + '" download="' + fileName + '">' + fileTitle + '</a>&nbsp;&nbsp;&nbsp;<label class="filedelete" style="cursor:pointer;">Delete File</label><label class="dnload" fileid="0" style="cursor: pointer;float: right; margin-right: 40px;">Download</label></li>');
                    $("#tbl_attach > tbody").append('<tr class="files" fileid="0" fext=".' +
                        ext +
                        '" ftype="' +
                        fileType +
                        '" fname="' +
                        fileName +
                        '" ftitle="' +
                        $('#attachmentTitle').val() +
                        '" fdescription="' +
                        $('#attachmentDesc').val() +
                        '"  base64="' +
                        base64String +
                        '"> <td><a href="data:' +
                        fileType +
                        ";base64," +
                        base64String +
                        '" download="' +
                        fileName +
                        '">' +
                        fileTitle +
                        '</a></td><td><span>' +
                        fileDesc +
                        '</span></td><td><span>' +
                        fileName +
                        '</span></td>\
                <td class="clstdEdit"><center><span class="fileedit zmdi zmdi-edit" style="cursor:pointer;color:#0095eb;font-size: 1.5em;"></span></center></td>\
                <td class="clstdDelete"><center><span class="filedelete zmdi zmdi-delete" style="cursor:pointer;color:red;font-size: 1.5em;"></span></center></td>\
                <td><center><span class="dnload zmdi zmdi-format-valign-bottom zmdi-hc-2x" fileid="0" style="cursor: pointer;color:#0095eb;"></span></center></td></tr>');
                    $('#myModal').dialog('close');
                    $('#attachmentTitle').val('');
                    $('#attachmentDesc').val('');
                    $('#attachmentFile').val('');
                    try {
                        if ($.browser.msie) {
                            $('#attachmentFile').replaceWith($('#attachmentFile').clone());
                        } else {
                            $('#attachmentFile').val('');
                        }
                        $('#attachmentFile').html('');
                    } catch (e) {
                        return false;
                    }
                };
                reader.readAsDataURL(file);

            }); //end of click event

        $('body').off('click', '.dnloadDisp');
        $('body').on('click', '.dnloadDisp', function (e) {
            e.preventDefault();
            var $id = $(this).attr('fileid');
            var $fname = $(this).attr('fname');
            var $filedata = $(this).attr('filedata');

            if ($id == "0") {
                var link = $(this).parent().parent().parent().find('a')[0];
                link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
            }
            else {

                var fromdata = new FormData();
                fromdata.append("vls", '18½' + $id + '½' + $filedata);
                var choice = {};
                choice.url = "/Invoice/AjaxCall" + $(location).attr("search");
                choice.type = "POST";
                choice.responseType = "blob";
                choice.data = fromdata;
                choice.contentType = false;
                choice.processData = false;
                choice.success = function (result) {
                    debugger;
                    result = $.parseJSON(result);
                    console.log(result);
                    var myUrl = "/content/_FilesNew/" + $id + "." + result.ext;
                    var win = window.open(myUrl, '_blank');
                    if (win) {
                        //Browser has allowed it to be opened
                        win.focus();
                    } else {
                        //Browser has blocked it
                        alert('Please allow popups for this website');
                    }


                    //var link = document.createElement('a');
                    //link.href = 'data:' + result.typ + ';base64,' + result.fdata;
                    //link.download = result.name;
                    //link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
                };//END OF SUCCESS
                choice.error = function (err) {
                    console.log(err.statusText);
                };
                $.ajax(choice);
            }

        });
        ////FILE ATTACHMENTS END


        $('body').off('click', '.fileedit');
        $('body').on('click',
            '.fileedit',
            function(e) {
                e.preventDefault();
                var fid = $(this).parent().parent().parent().attr('fileid');
                var $tr = $(this).parent().parent().parent();
                $('#tbl_attach tbody tr').removeAttr('bisedit');
                $tr.attr('bisedit', 'bisedit');
                $('#attachmentTitle').val($tr.attr('ftitle'));
                $('#attachmentDesc').val($tr.attr('fdescription'));
                $('#btnUpload').attr('tg', fid);
                $('#btnUpload').attr('typ', "1");
                $('#myModal').dialog('open');
            }); //END OF Edit BUTNN

        $('body').off('click', '.filedelete');
        $('body').on('click',
            '.filedelete',
            function(e) {
                e.preventDefault();
                var fid = $(this).parent().parent().parent().attr('fileid');
                if (fid != "0") {
                    var pdlist = "";
                    try {
                        //pdlist = $('#ulFileList').attr('dellist');
                        pdlist = $('#tbl_attach').attr('dellist');
                        if (pdlist == "") {
                            pdlist = fid
                        } else {
                            pdlist = pdlist + '½' + fid;
                        }
                        //$('#ulFileList').attr('dellist', pdlist);
                        $('#tbl_attach').attr('dellist', pdlist);
                    } catch (e) {
                        pdlist = fid;
                        //$('#ulFileList').attr('dellist', pdlist);
                        $('#tbl_attach').attr('dellist', pdlist);
                    }
                }

                $(this).parent().parent().parent().remove();
            }); //END OF DELETE BUTNN

        //$('body').off('click', '.dnload');
        //$('body').on('click',
        //    '.dnload',
        //    function(e) {
        //        e.preventDefault();
        //        var $id = $(this).attr('fileid');
        //        var $fname = $(this).attr('fname');

        //        if ($id == "0") {
        //            var link = $(this).parent().parent().parent().find('a')[0];
        //            link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
        //        } else {

        //            var fromdata = new FormData();
        //            fromdata.append("vls", '2½' + $id);
        //            var choice = {};
        //            //choice.url = "https://cppa2.azurewebsites.net/v1/invoice/GetFile/" + $id;
        //            //choice.type = "GET";
        //            //choice.responseType = "blob";
        //            //choice.headers = { "Token": Token };
        //            //choice.contentType = false;
        //            //choice.processData = false;
        //            choice.url = "/Invoice/AjaxCall" + $(location).attr("search");
        //            choice.type = "POST";
        //            choice.responseType = "blob";
        //            choice.data = fromdata;
        //            choice.contentType = false;
        //            choice.processData = false;
        //            choice.success = function(result) {
        //                result = $.parseJSON(result);
        //                //var myUrl = "https://cppa2.azurewebsites.net/content/_FilesNew/" + $id + "." + result.ext;
        //                var myUrl = "content/_FilesNew/" + $id + "." + result.ext;
        //                var win = window.open(myUrl, '_blank');
        //                if (win) {
        //                    //Browser has allowed it to be opened
        //                    win.focus();
        //                } else {
        //                    //Browser has blocked it
        //                    alert('Please allow popups for this website');
        //                }

        //                //var link = document.createElement('a');
        //                //link.href = 'data:' + result.typ + ';base64,' + result.fdata;
        //                //link.download = result.name;
        //                //link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
        //            };
        //            choice.error = function(err) {
        //                console.log(err.statusText);
        //            };
        //            $.ajax(choice);
        //        }

        //    }); //END OF DNLOAD CLICK

        ////FILE ATTACHMENTS start

        $('body').off('click', '.dnload');
        $('body').on('click', '.dnload', function (e) {
            e.preventDefault();

            var $id = $(this).attr('fileid');
            var $fname = $(this).attr('fname');

            if ($id == "0") {
                var link = $(this).parent().parent().parent().find('a')[0];
                link.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true, view: window }));
            } else {
                var fromdata = new FormData();
                fromdata.append("vls", '2½' + $id);

                $.ajax({
                    url: "/Invoice/AjaxCall" + $(location).attr("search"),
                    type: "POST",
                    responseType: "blob",
                    data: fromdata,
                    contentType: false,
                    processData: false,
                    success: function (result) {
                        result = $.parseJSON(result);
                        debugger;
                        // Decode base64 file data
                        var byteCharacters = atob(result.fdata);
                        var byteNumbers = new Array(byteCharacters.length);
                        for (var i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        var byteArray = new Uint8Array(byteNumbers);
                        var fileBlob = new Blob([byteArray], { type: result.typ });
                        var fileURL = URL.createObjectURL(fileBlob);

                        if (result.typ === "application/pdf") {
                            // Open PDF files in a new tab
                            window.open(fileURL, '_blank');
                        } else {
                            // Trigger download for other file types with a specified name
                            var downloadLink = document.createElement('a');
                            downloadLink.href = fileURL;
                            downloadLink.download = result.name; // Set the file name from the result
                            document.body.appendChild(downloadLink);
                            downloadLink.click();
                            document.body.removeChild(downloadLink);
                        }

                        // Revoke the object URL after use
                        setTimeout(function () {
                            URL.revokeObjectURL(fileURL);
                        }, 1000);
                    },
                    error: function (err) {
                        console.log(err.statusText);
                    }
                });
            }
        });
        ////FILE ATTACHMENTS END


        $('body').off('click', '.btnAction');
        $('body').on('click',
            '.btnAction',
            function(e) {
                e.preventDefault();

                if (!ValidateTbl()) {
                    swal({
                        title: "Warning",
                        text: "Please Validate all inputs..!",
                        type: "warning",
                        showCancelButton: false,
                        showConfirmButton: true
                    });
                    return false;



                }


                var btnStatus = $(this).val();
                var isTrue = checkEmpty(btnStatus);
                var chk = true;
                var R_Detail = [];
                ComClaim = 0.0000, ParClaim = 0.0000;
                if (isTrue) {

                    var $val = $('#totalClaim').val().replace(/,/g, '');

                    //The following check is to ensure that Parent section should not be saved without payment details
                    $('#tblComp > tbody > tr').each(function(k, l) { // Payment Detail Table loop

                        R_Detail.push($(this).attr('r')); //An array containing all the r values from the rows

                    });


                    $('#tblPI > tbody > tr').each(function(i, j) { //Parent Table loop
                        // flg = true;
                        var b_r = $(this).attr('r');
                        var radioObj = $($(this).children()[0]).children().children();
                        //var focusedObj = $($(this).children()[9]).children();


                        if (jQuery.inArray(b_r, R_Detail) == -1) {
                            swal({
                                    title: "Error",
                                    text: "Please enter missing Payment Detail of the respective Parent",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonClass: "btn btn-danger",
                                    confirmButtonText: "OK"
                                    //,
                                    //onAfterClose: () => {

                                    //    setTimeout(() =>
                                    //        //$(radioObj).prop('checked', true),
                                    //        {
                                    //            $(radioObj).focus(),
                                    //                $(radioObj).click()
                                    //        }, 100)

                                    //}

                                },
                                function() {
                                    setTimeout(() =>
                                        //$(radioObj).prop('checked', true),
                                        {
                                            $(radioObj).focus(),
                                                $(radioObj).click();
                                        },
                                        100);
                                });
                            chk = false;
                            return false;
                        }

                    });

                    if (!chk) {
                        return false;
                    }

                    //End of the check
                    removeComma();


                    $('#tblComp > tbody > tr .clsClaim').each(function(i, v) {
                        ComClaim = +(ComClaim + parseFloat($(this).val())).toFixed(4);
                        //ComClaim += parseFloat($(this).val());

                    });

                    $('#tblPI > tbody > tr .defClaim').each(function(i, v) {
                        ParClaim = +(ParClaim + parseFloat($(this).val())).toFixed(4);
                        //ParClaim += parseFloat($(this).val());
                    });

                    //ComClaim =ComClaim.toFixed(4);
                    //ParClaim = ParClaim.toFixed(4);
                    addComma();

                    ComClaim = parseFloat(ComClaim);
                    ParClaim = parseFloat(ParClaim);

                    if (ParClaim != parseFloat($val)) {
                        swal({
                            title: "Error",
                            text: "Total Claim amount is not equal to Sum of Block Claim...!",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK"
                        });

                        return false;
                    }

                    if (ParClaim != ComClaim) {
                        swal({
                            title: "Error",
                            text: "Components' Claim Sum is not equal to Sum of Block Claim...!",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK"
                        });

                        return false;
                    }


                    /* if(ParClaim!=$val){
                      swal({
                         title: "Error",
                         text: "Total Claim amount is not equal to Sum of Component Claim...!",
                         type: "warning",
                         showCancelButton: false,
                         confirmButtonClass: "btn btn-danger",
                         confirmButtonText: "OK"
                     });

                      return false;
                  } */

                    if ($('#totalClaim').val() == 0) {
                        swal({
                                title: "Are you sure?",
                                text: "You are about to create an invoice with zero total claim.",
                                type: "warning",
                                showCancelButton: true,
                                confirmButtonClass: "btn btn-danger",
                                confirmButtonText: "Continue"
                            },
                            function() {
                                callAjax(btnStatus);
                                //swal("Success!", "Record has been saved Successfully.", "success");
                            });
                        //.then((result) => {
                        //    if (result.value) {

                        //    }
                        //    else {
                        //        swal.close();
                        //    }
                        //});
                    } else {
                        if (btnStatus == "Draft") {
                            callAjax(btnStatus);
                        } else {
                            swal({
                                    title: "Submit Confirmation",
                                    text: "Do you want to submit this invoice?",
                                    type: "warning",
                                    showCancelButton: true,
                                    confirmButtonClass: "btn btn-danger",
                                    confirmButtonText: "Continue"
                                },
                                function() {
                                    callAjax(btnStatus);
                                    //swal("Success!", "Record has been saved Successfully.", "success");
                                });

                            //.then((result) => {
                            //    if (result.value) {

                            //    }
                            //    else {
                            //        swal.close();
                            //    }
                            //});
                        }
                    }
                }
            }); // end of save button

        function callAjax(value) {
            //swal.close();
            var myForm = $('#producerSite option:selected').attr('hid') + '½';

            //  var myForm = headerID + '½';
            myForm += $('#powerProducer').val() +
                '½' +
                $('#producerSite').val() +
                '½' +
                $('#status').val() +
                '½' +
                $('#invoiceType').val() +
                '½' +
                $('#invoiceDueDate').val() +
                '½' +
                $('#invoiceLetterNumber').val() +
                '½0½' +
                $('#invoiceDate').val() +
                '½' +
                $('#invoicePeriodFrom').val() +
                '½' +
                $('#invoicePeriodFromTime').val() +
                '½' +
                $('#invoicePeriodTo').val() +
                '½' +
                $('#invoicePeriodToTime').val() +
                '½' +
                $('#currency').val() +
                '½' +
                $('#totalClaim').val() +
                '½' +
                $('#remarks').val() +
                '½';
            myForm += value + '½' + $('#prevTxtAreaRemarks').val() + '½' + $('#btnSave').attr('tg');

            var blockData = '';
            $('#tblPI tbody tr').each(function() {

                var $tr = $(this);

                blockData += $(this).attr('headeridpk') + '½';
                $tr.find('.blk').each(function(i, j) {
                    blockData += $(this).val() + '½';
                });
                blockData += $tr.attr('isnew');
                if (blockData.endsWith("½")) {
                    blockData += '¼';
                    blockData = blockData.replace('½¼', '¡');
                } else {
                    blockData += '¡';
                }


                var id = $(this).attr('r');

                $('#tblComp > tbody > tr[r="' + id + '"]').each(function(i, j) {
                    var $tr = $(this);
                    blockData += $tr.attr('bid') + '½';
                    $tr.find('.blk').each(function(c, d) {
                        blockData += $(this).val() + '½';
                    });
                    if (blockData.endsWith('½')) {
                        blockData += '¼';
                        blockData = blockData.replace('½¼', '¡');
                    } else {
                        blockData += '¡';
                    }


                });
                if (blockData.endsWith('¡')) {
                    blockData += '¼';
                    blockData = blockData.replace('¡¼', '»');
                }

            });

            var filekData = '';
            $('.files[fileid="0"]').each(function(iii, jjj) {
                // element == this
                filekData += $(this).attr('fext') +
                    '½' +
                    $(this).attr('ftype') +
                    '½' +
                    $(this).attr('fname') +
                    '½' +
                    $(this).attr('ftitle') +
                    '½' +
                    $(this).attr('fdescription') +
                    '½' +
                    $(this).attr('base64') +
                    '¡';
            });

            if (filekData.endsWith('¡')) {
                filekData += '¼';
                filekData = filekData.replace('¡¼', '');
            }


            var fileDelData = "";
            if ($('#tbl_attach').attr('dellist') != "") {
                fileDelData = '¼' + $('#tbl_attach').attr('dellist');
                fileDelData = fileDelData.replace(/¼½/g, '');
            }
            var dellblock = $('#tblPI').attr('dellblock');

            fileupdate = '';
            $('.files[fileupdate="fileupdate"]').each(function(iii, jjj) {
                // element == this
                fileupdate += $(this).attr('fileid') +
                    '½' +
                    $(this).attr('ftitle') +
                    '½' +
                    $(this).attr('fdescription') +
                    '¡';
            });
            if (fileupdate.endsWith('¡')) {
                fileupdate += '¼';
                fileupdate = fileupdate.replace('¡¼', '');
            }

            var adjData = '';
            $('#tblADJ tbody tr').each(function(index, element) {
                var $tr = $(this);
                adjData += $tr.attr('aid') +
                    "½" +
                    $($tr.find('td')[0]).html() +
                    "½" +
                    $($tr.find('td')[1]).html() +
                    "½" +
                    $($tr.find('td')[2]).html() +
                    "½" +
                    $($tr.find('td')[3]).html() +
                    "¼";
            });
            if (adjData.endsWith("¼")) {
                adjData += "¡";
                adjData = adjData.replace('¼¡', '');
            }


            var fromdata = new FormData();
            fromdata.append("strFormData", myForm);
            fromdata.append("strBlockData", blockData);
            fromdata.append("strfilekData", filekData);
            fromdata.append("strfileDelData", fileDelData);
            fromdata.append("strdellblock", dellblock);
            fromdata.append("strfileupdate", fileupdate);
            fromdata.append("stradjData", adjData);
            fromdata.append("stradjDelData", $('#tblADJ').attr('adjdellist'));
            fromdata.append("strdelDetail", $('#tblComp').attr('delDetail'));

            var choice = {};
            //choice.url = "https://cppa2.azurewebsites.net/v1/invoice/IInvoice?strFormData=0&strBlockData=0";
            choice.url = "/Invoice/IInvoice" + $(location).attr("search");
            choice.type = "POST";
            choice.data = fromdata;
            //choice.headers = { "Token": Token };
            choice.contentType = false;
            choice.processData = false;
            choice.beforeSend = function() {
                $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
            };
            choice.complete = function() {
                $.unblockUI();
            };
            choice.success = function(result) {

                if (result == "0") {
                    value = "saved";
                    swal({
                            title: "Invoice!",
                            text: "Invoice has been " + value.toLowerCase() + " successfully.",
                            type: "success",
                            showCancelButton: false,
                            showConfirmButton: true
                        },
                        function() {
                            goToHome();
                        });
                    //location.href = _spPageContextInfo.webAbsoluteUrl + "/Pages/Home.aspx";
                    return false;
                } else if (parseInt(result) > 0) {

                    swal({
                            title: "Invoice!",
                            text: "Invoice with transaction no " +
                                result +
                                " has been " +
                                value.toLowerCase() +
                                " successfully.",
                            type: "success",
                            showCancelButton: false,
                            showConfirmButton: true

                        },
                        function() {
                            goToHome();
                        });
                    //location.href = _spPageContextInfo.webAbsoluteUrl + "/Pages/Home.aspx";
                    return false;
                } else if (result == "-1") {
                    swal({
                        title: "Warning",
                        text: "Invoice Letter " + $('#invoiceLetterNumber').val() + " is already exists.",
                        type: "warning",
                        showCancelButton: false,
                        showConfirmButton: true
                    });
                } else if (result == "-2") {
                    swal({
                        title: "Warning",
                        text: "Today is gazetted holiday. Please save invoice to process on coming working day...!",
                        type: "warning",
                        showCancelButton: false,
                        showConfirmButton: true
                    });
                } else if (result == "-3") {
                    swal({
                        title: "Warning",
                        text: "Invoices can only be submitted in working hours...!",
                        type: "warning",
                        showCancelButton: false,
                        showConfirmButton: true
                    });
                } else if (result == "-4") {
                    swal({
                        title: "Warning",
                        text: "Invalid date format or null value in Interest date field. Please enter a valid date.",
                        type: "warning",
                        showCancelButton: false,
                        showConfirmButton: true
                    });
                }
                else {
                    
                    swal({
                        title: "Error!",
                        text: result, // Display the original error message for other errors
                        type: "warning"
                    });
                    //  }
                }

            };
            choice.error = function(err) {
                console.log(err.statusText);
            };
            $.ajax(choice);
        } //END OF FUNCTION 	callAjax

        LoadInterestInvoice();

        $('body').off('click', '.clsAction');
        $('body').on('click',
            '.clsAction',
            function(e) {
                var $val = $(this).attr('tg');
                var $id = $(this).attr('dhiid');

                var intClaim = $('#totalClaim').val().replace(/,/g, '');
                intClaim = parseFloat(intClaim);
                if ($val == "Received") {

                    ComClaim = parseFloat(ComClaim);
                    ParClaim = parseFloat(ParClaim);

                    if (ParClaim != intClaim) {
                        swal({
                            title: "Error",
                            text: "Total Claim amount is not equal to Sum of Block Claim...!",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK"
                        });

                        return false;
                    }

                    if (ParClaim != ComClaim) {
                        swal({
                            title: "Error",
                            text: "Components' Claim Sum is not equal to Sum of Block Claim...!",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK"
                        });

                        return false;
                    }
                }
                if ($val != "Returned") {
                    if (($('#hardCopySub').val() == "" ||
                            $('#hardCopySubTime').val() == "" ||
                            $('#hardCopySubTime').val() == null) &&
                        currentUserType == 3) {
                        swal({
                                title: "Error",
                            text: "Please select invoice receiving date and time!",
                                type: "warning",
                                confirmButtonClass: "btn btn-danger",
                                confirmButtonText: "OK",
                                showCancelButton: false
                                //,
                                //onAfterClose: () => {
                                //    setTimeout(() => $('#hardCopySub').focus(), 100)
                                //}
                            },
                            function() { setTimeout(() => $('#hardCopySub').focus(), 100); });
                        return false;
                    }
                }
                if ($val == "Returned" && $('#prevTxtAreaRemarks').val() == '') {
                    swal({
                            title: "Error",
                            text: "Please enter notes!",
                            type: "warning",
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK",
                            showCancelButton: false
                            //,
                            //onAfterClose: () => {
                            //    setTimeout(() => $('#prevTxtAreaRemarks').focus(), 100)
                            //}
                        },
                        function() { setTimeout(() => $('#prevTxtAreaRemarks').focus(), 100); });
                    return false;
                }

                swal({
                        title: "Are you sure?",
                        text: "",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "Yes, Continue",
                        cancelButtonText: "No, cancel"
                    },
                    function() {
                        e.preventDefault();
                        var $myForm = $id +
                            "½" +
                            $val +
                            "½" +
                            $('#prevTxtAreaRemarks').val() +
                            '½' +
                            $('#hardCopySub').val() +
                            '½' +
                            $('#hardCopySubTime').val() +
                            '½' +
                            $('#hardCopyType').val();

                        var fromdata = new FormData();
                        fromdata.append("strFormData", $myForm);
                        var choice = {};
                        //choice.url = "https://cppa2.azurewebsites.net/v1/invoice/UpdateRemarks";
                        choice.url = "/Invoice/UpdateRemarks" + $(location).attr("search");
                        choice.type = "POST";
                        choice.data = fromdata;
                        //choice.headers = { "Token": Token };
                        choice.contentType = false;
                        choice.processData = false;
                        choice.beforeSend = function() {
                            $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                        };
                        choice.complete = function() {
                            $.unblockUI();
                        };
                        choice.success = function(result) {

                            const myarray = result.split("½");
                            var abc = "0";
                            if (myarray[2] > 30) {
                                abc = Math.ceil(Math.round(myarray[2] / 30)).toString();
                            }
                            if (myarray[0] == "1") {
                                swal({
                                    title: "Invoice!",
                                    text: "Invoice has been " + $val + " successfully.",
                                    type: "success",
                                    showCancelButton: false,
                                    showConfirmButton: true,

                                    closeOnConfirm: true
                                },
                                    function () {
                                        if (myarray[1] == "Received") {
                                            debugger;
                                            EcmFileTransfer($id, Vname, VsiteID, abc);
                                        }
                                        goToHome();
                                    });


                                return false;
                            }

                            else {
                                swal({
                                    title: "Error!",
                                    text: result,
                                    type: "warning"
                                });
                            }

                        };
                        choice.error = function(err) {
                            console.log(err.statusText);
                        };
                        $.ajax(choice);
                        //swal("Complete!", "", "success");
                    });
                //.then((result) => {
                //    if (result.value) {

                //    } else {
                //        swal("Cancelled!", "", "error");
                //    }
                //});

            }); // end of save button
        $('body').off('click', '#btnWithDraw');
        $('body').on('click',
            '#btnWithDraw',
            function(e) {
                var $val = $(this).attr('tg');
                var $id = $(this).attr('dhiid');

                if ($val == "Returned" && $('#prevTxtAreaRemarks').val() == '') {
                    swal({
                            title: "Error",
                            text: "Please enter notes!",
                            type: "warning",
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK",
                            showCancelButton: false
                            //,
                            //onAfterClose: () => {
                            //    setTimeout(() => $('#prevTxtAreaRemarks').focus(), 100);
                            //}
                        },
                        function() { setTimeout(() => $('#prevTxtAreaRemarks').focus(), 100); });
                    return false;
                }

                swal({
                        title: "Are you sure?",
                        text: "",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "Yes, Continue",
                        cancelButtonText: "No, cancel"
                    },
                    function() {
                        e.preventDefault();
                        var $myForm = $('#btnSave').attr('tg');

                        var fromdata = new FormData();
                        fromdata.append("strFormData", $myForm);
                        var choice = {};
                        //choice.url = "https://cppa2.azurewebsites.net/v1/invoice/Withdraw";
                        choice.url = "/Invoice/Withdraw" + $(location).attr("search");
                        choice.type = "POST";
                        choice.data = fromdata;
                        //choice.headers = { "Token": Token };
                        choice.contentType = false;
                        choice.processData = false;
                        choice.beforeSend = function() {
                            $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                        };
                        choice.complete = function() {
                            $.unblockUI();
                        };
                        choice.success = function(result) {

                            if (result == "1") {
                                swal({
                                        title: "Invoice!",
                                        text: "Invoice has been withdrawn successfully.",
                                        type: "success",
                                        showCancelButton: false,
                                        showConfirmButton: true
                                    },
                                    function() {
                                        goToHome();
                                    });

                                /*swal("Invoice!", "Invoice has been " + $val + " successfully.", "success", {
                                    button: "Continue!",
                                });*/
                                //location.href = _spPageContextInfo.webAbsoluteUrl + "/Pages/Home.aspx";
                                return false;
                            } else {
                                swal({
                                    title: "Error!",
                                    text: result,
                                    type: "warning"
                                });
                            }

                        };
                        choice.error = function(err) {
                            console.log(err.statusText);
                        };
                        $.ajax(choice);
                        swal("Complete!", "", "success");
                    });

                //    .then((result) => {
                //    if (result.value) {

                //    } else {
                //        swal("Cancelled!", "", "error");
                //    }
                //});

            }); // end of btnWithDraw button


        /////////
        $('#dvAdjustmentAdd').dialog({
            autoOpen: false,
            height: 215,
            width: 650,
            modal: true,
            show: {
                effect: "clip",
                duration: 500
            },
            hide: {
                effect: "clip",
                duration: 500
            }
        });


        $('body').off('click', '#btnAddAdjustment');
        $('body').on('click',
            '#btnAddAdjustment',
            function(e) {
                e.preventDefault();
                $('.adj').val('');
                $(this).attr('typ', '0');
                $(this).attr('tg', '0');
                $('#dvAdjustmentAdd').dialog('open');
                $(this).prop('disabled', false);
            }); //end of btnAddFiles

        $('body').off("click", '#btnCloseDialogAdj');
        $('body').on("click",
            '#btnCloseDialogAdj',
            function(e) {
                e.preventDefault();
                $('#dvAdjustmentAdd').dialog('close');
                $('.adj').val('');
            });

        function loadAdjInvDll() {
            var fromdata = new FormData();
            fromdata.append("vls", '4½' + $('#producerSite').val() + '½' + $('#invoiceType').val());
            $.ajax
            ({
                //type: "GET",
                //url: "https://cppa2.azurewebsites.net/v1/PPABlkFuel/Adjdll?VENDOR_SITE_ID_FK=" + $('#producerSite').val() + "&ppaInvTypeID=" + $('#invoiceType').val(),
                //dataType: 'json',
                //headers: {
                //    "Token": Token
                //},
                beforeSend: function() {
                    $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                },
                complete: function() {
                    $.unblockUI();
                },
                type: "POST",
                url: "/Invoice/AjaxCall" + $(location).attr("search"),
                data: fromdata,
                contentType: false,
                processData: false,
                success: function(data) {
                    if ($('#ddlPrefInvoice').hasClass('selectized')) {
                        $('#ddlPrefInvoice')[0].selectize.destroy();
                    }
                    $("#ddlPrefInvoice").html(data);
                    //$("#ddlPrefInvoice").selectize();
                }, //end of ajax success
                error: function(request, textStatus, errorThrown) {
                }
            });
        } // end of loadAdjInvDll
        /*$('body').off('change', '#invoiceType');
        $('body').on('change', '#invoiceType', function () {
            if ($(this).find(':selected').attr('adjustments') == "Y") {
                $('#dvAdjustment').show();
            } else {
                $('#dvAdjustment').hide();
            }
            loadAdjInvDll();
            $('#btnadd, #pp, #PreText').show();
        });*/

        $('body').off('click', '#btnSaveAdj');
        $('body').on('click',
            '#btnSaveAdj',
            function(e) {
                e.preventDefault();

                if ($('#ddlPrefInvoice').val() == "0" ||
                    $('#ddlPrefInvoice').val() == "" ||
                    $('#ddlPrefInvoice').val() == null ||
                    $('#ddlPrefInvoice').val() == undefined) {

                    swal({
                        title: "Error",
                        text: "Please select REFERENCE INVOICE!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK",
                        showCancelButton: false

                    });

                    return false;
                }
                if ($('#txtAdjAmount').val() == "0" ||
                    $('#txtAdjAmount').val() == "0.0000" ||
                    $('#txtAdjAmount').val() == "") {
                    swal({
                        title: "Error",
                        text: "Please select REFERENCE INVOICE!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK",
                        showCancelButton: false
                    });
                    return false;
                }


                if ($(this).attr('typ') == '0') {

                    $(this).prop('disabled', true);
                    $('#tblADJ tbody').append('<tr aid="0">\
<td>' +
                        $('#ddlPrefInvoice').val() +
                        '</td>\
<td>' +
                        $($('.adj')[0]).val() +
                        '</td>\
<td>' +
                        $($('.adj')[1]).val() +
                        '</td>\
<td>' +
                        $($('.adj')[6]).val() +
                        '</td>\
<td class="clsAJDEdit"><center><span class="adjedit zmdi zmdi-edit" style="cursor:pointer;color:#0095eb;font-size: 1.5em;"></span></center></td>\
<td class="clsAJDDelete"><center><span class="adjdelete zmdi zmdi-delete" style="cursor: pointer; color: red; font-size: 1.5em; display: inline-block;"></span></center></td>\
');
                } else {
                    $(this).prop('disabled', true);
                    var $tds = $('#tblADJ tbody tr[biseditadj="biseditadj"]').find('td');
                    $($tds[0]).html($('#ddlPrefInvoice').val());
                    $($tds[1]).html($($('.adj')[0]).val());
                    $($tds[2]).html($($('.adj')[1]).val());
                    $($tds[3]).html($($('.adj')[6]).val());
                }
                $('#dvAdjustmentAdd').dialog('close');
            }); //END OF CLICK


        $('body').off('click', '.adjdelete');
        $('body').on('click',
            '.adjdelete',
            function(e) {
                e.preventDefault();
                var aid = $(this).parent().parent().parent().attr('aid');
                if (aid != "0") {
                    var pdlist = "";
                    try {
                        pdlist = $('#tblADJ').attr('adjdellist');
                        if (pdlist == "") {
                            pdlist = aid
                        } else {
                            pdlist = pdlist + '½' + aid;
                        }
                        $('#tblADJ').attr('adjdellist', pdlist);
                    } catch (e) {
                        pdlist = aid;
                        $('#tblADJ').attr('adjdellist', pdlist);
                    }
                }
                $(this).parent().parent().parent().remove();
            }); //END OF DELETE BUTNN

        $('body').off('click', '.adjedit');
        $('body').on('click',
            '.adjedit',
            function(e) {
                e.preventDefault();
                var aid = $(this).parent().parent().parent().attr('aid');
                var $tr = $(this).parent().parent().parent();
                $('#tblADJ tbody tr').removeAttr('biseditadj');
                $tr.attr('biseditadj', 'biseditadj');
                //$('#attachmentTitle').val($tr.attr('ftitle'));
                //$('#attachmentDesc').val($tr.attr('fdescription'));
                //$('#btnUpload').attr('tg', aid);
                $('#ddlPrefInvoice').val($($tr.find('td')[0]).html());

                if ($('#ddlPrefInvoice').hasClass('selectized')) {
                    $('#ddlPrefInvoice')[0].selectize.destroy();
                }
                $("#ddlPrefInvoice").val($($tr.find('td')[0]).html());
                //$("#ddlPrefInvoice").selectize();
                $($('.adj')[0]).val($($tr.find('td')[1]).html());
                $($('.adj')[1]).val($($tr.find('td')[2]).html());
                $($('.adj')[6]).val($($tr.find('td')[3]).html());

                $('#btnSaveAdj').attr('typ', "1");
                $('#dvAdjustmentAdd').dialog('open');
                $($('.adj')[0]).focus();
                $('#ddlPrefInvoice').next().find('.selectize-dropdown').hide();
                $($('#ddlPrefInvoice').next().find('.selectize-input')[0]).removeClass('dropdown-active');
                $(this).prop('disabled', false);
            }); //END OF Edit BUTNN
        $(function() {
            //if (isAPIAvailable()) {

            //$('#files').bind('change', handleFileSelect);
            $('body').off('change', '#File1');
            $('body').on('change', '#File1', handleFileSelect);
            //}
        });

        function isAPIAvailable() {
            // Check for the various File API support.
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                // Great success! All the File APIs are supported.
                return true;
            } else {
                // source: File API availability - http://caniuse.com/#feat=fileapi
                // source: <output> availability - http://html5doctor.com/the-output-element/
                document.writeln(
                    'The HTML5 APIs used in this form are only available in the following browsers:<br />');
                // 6.0 File API & 13.0 <output>
                document.writeln(' - Google Chrome: 13.0 or later<br />');
                // 3.6 File API & 6.0 <output>
                document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
                // 10.0 File API & 10.0 <output>
                document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
                // ? File API & 5.1 <output>
                document.writeln(' - Safari: Not supported<br />');
                // ? File API & 9.2 <output>
                document.writeln(' - Opera: Not supported');
                return false;
            }
        }

        function handleFileSelect(evt) {

            var files = evt.target.files; // FileList object
            var file = files[0];

            // read the file metadata
            // read the file contents
            printTable(file);

            // post the results

        }

        function printTable(file) {

            var flg = false;
            var r = '';
            $('.rd-blk').each(function(i, j) {
                if ($(this).is(':checked')) {
                    flg = true;
                    r = $(this).attr('r');
                }
            });
            if (flg) {
                var reader = new FileReader();
                reader.readAsText(file);
                reader.onload = function(event) {
                    var csv = event.target.result;
                    var data = $.csv.toArrays(csv);
                    var html = '';


                    for (var row in data) {

                        var date1 = data[row][5];
                        if (date1 == undefined)
                            date1 = '';
                        var date2 = data[row][6];
                        if (date2 == undefined)
                            date2 = '';
                        html += '<tr r="' +
                            r +
                            '" bid="0" isnew="0">\r\n; \
                <td><input type="text" class="blk form-control dtDate" value="' +
                            data[row][0] +
                            '" readonly="" ></td>\r\n; \
                <td><input type="text" class="blk form-control clsNoOfDays" predays="' +
                            data[row][1] +
                            '" value="' +
                            data[row][1] +
                            '"></td>\r\n; \
                <td><input type="text" class="blk form-control clsAddComa" value="' +
                            data[row][2] +
                            '"></td>\r\n; \
                <td><input type="text" class="blk form-control clsAddComa clsInterestRate" prevalue="' +
                            data[row][3] +
                            '" value="' +
                            data[row][3] +
                            '" tabindex="111"></td>\r\n; \
                <td><input type="text" class="blk form-control clsClaim" value="' +
                            data[row][4] +
                            '" r="' +
                            r +
                            '"></td>\r\n; \
                <td><input type="text" class="blk form-control dtcfromDate" value="' +
                            date1 +
                            '" readonly=""></td>\r\n; \
                <td><input type="text" class="blk form-control dtEndDate" value="' +
                            date2 +
                            '" readonly></td>\r\n; \
                <td style="padding-right:8px;"><i class="ti-trash btn-detail-delete btn-block" title="Delete" style="text-align: center;line-height: 2;color: black;background: #c6c6c6; color:red;" r="' +
                            r +
                            '"> </i></td></tr>';
                    }
                    $('#tblComp tbody').append(html);
                    ValidateTbl();
                };
                reader.onerror = function() { alert('Unable to read ' + file.fileName); };
            } else {
                swal({
                    title: "Error",
                    text: "Please select at least one parent invoice...!",
                    type: "warning"
                });

                try {
                    if ($.browser.msie) {
                        $('#File1').replaceWith($('#File1').clone());
                    } else {
                        $('#File1').val('');
                    }
                    $('#File1').val('');
                    $('#File1').html('');
                } catch (e) {
                    $('#File1').val('');
                    $('#File1').html('');
                    return false;
                }
                return false;
            }
        } //End of Print

        function ValidateTbl() {
            removeComma();
            var ret = true;
            $('#tblComp > tbody > tr').each(function(i, j) {
                var $tr = $(this);
                var $v0 = $($($tr.find('td')[0]).find('input')[0]).val();
                if (ValidateDate($v0) == false) {
                    $($($tr.find('td')[0]).find('input')[0]).css('background', '#ff00002e');
                    ret = false;
                } else {
                    $($($tr.find('td')[0]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                }

                var $v1 = $($($tr.find('td')[1]).find('input')[0]).val();
                if (parseInt($v1) >= 0 && parseInt($v1) <= 10000) {
                    $($($tr.find('td')[1]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                } else {
                    $($($tr.find('td')[1]).find('input')[0]).css('background', '#ff00002e');
                    ret = false;
                }


                var $v2 = $($($tr.find('td')[2]).find('input')[0]).val();
                if ($.isNumeric($v2)) {
                    $($($tr.find('td')[2]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                } else {
                    $($($tr.find('td')[2]).find('input')[0]).css('background', '#ff00002e');
                    ret = false;
                }

                var $v3 = $($($tr.find('td')[3]).find('input')[0]).val();
                if (parseInt($v3) >= 0 && parseInt($v3) <= 100) {
                    $($($tr.find('td')[3]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                } else {
                    $($($tr.find('td')[3]).find('input')[0]).css('background', '#ff00002e');
                    ret = false;
                }

                var $v4 = $($($tr.find('td')[4]).find('input')[0]).val();
                if ($.isNumeric($v4)) {
                    $($($tr.find('td')[4]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                } else {
                    $($($tr.find('td')[4]).find('input')[0]).css('background', '#ff00002e');
                    ret = false;
                }
                $($($tr.find('td')[5]).find('input')[0]).css('background', '#ffffff');
                $($($tr.find('td')[6]).find('input')[0]).css('background', '#ffffff');

                //done by tanavush
                /*var $v5 = $($($tr.find('td')[5]).find('input')[0]).val();
                if (ValidateDate($v5) == false) {
                    $($($tr.find('td')[5]).find('input')[0]).css('background', '#ff00002e');
                    ret = false;
                } else {
                    $($($tr.find('td')[5]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                }
                var $v6 = $($($tr.find('td')[6]).find('input')[0]).val();
                if (ValidateDate($v6) == false) {
                    ret = false;
                    $($($tr.find('td')[6]).find('input')[0]).css('background', '#ff00002e');
                } else {
                    $($($tr.find('td')[6]).find('input')[0]).css('background', 'rgb(251, 255, 193)');
                }*/
            });
            if (ret) {
                $('.defClaim').each(function(a, b) {
                    var $r = $(this).attr('r');
                    var totalofattach = 0.0;
                    $('.clsClaim[r="' + $r + '"]').each(function(index, element) {
                        totalofattach = +(totalofattach + parseFloat($(this).val())).toFixed(4);
                        //totalofattach += parseFloat($(this).val());
                    });
                    $(this).val(totalofattach);
                });
            }
            $($('.clsClaim')[0]).change();
            addComma();
            return ret;
        } //END OF FUNC

        function ValidateDate(dtValue) {
            var dtRegex =
                new RegExp(
                    "^([0]?[1-9]|[1-2]\\d|3[0-1])-(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)-[1-2]\\d{3}$",
                    'i');
            return dtRegex.test(dtValue);
        }



        //Alina Start

        if (currentUserType == 2 || currentUserType == 3 || currentUserType == 4 || currentUserType == 1 || currentUserType == 16) {
            $("#DownAll").show();
        }
        else {
            $("#DownAll").hide();
        }
        $('body').off('click', '#DownAll');
        $('body').on('click', '#DownAll', function (e) {
            debugger;

            var ajax = new XMLHttpRequest();
            ajax.open("Get", "/Invoice/DownloadMultipleFiles?DataId=" + tempDHI, true);
            ajax.responseType = "blob";
            ajax.onreadystatechange = function () {
                if (this.readyState == 4) {
                    debugger;
                    var blob = new Blob([this.response], { type: "application/zip" });
                    var fileName = "AllFiles.zip";
                    saveAs(blob, fileName);
                    $.unblockUI();
                }
            };
            $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
            ajax.send(null);



        }); //end of button event
        //Alina Ends
    }); //end of doc ready

        String.prototype.FormatRow = function () {
            try {
                var content = this;
                for (var i = 0; i < arguments.length; i++) {
                    var replacement = '{' + i + '}';
                    content = content.replace(replacement, arguments[i]);
                }
                return content;
            }
            catch (e) {
                console.log("Error occurred in FormatRow " + e.message);
            }
        }

    </script>
</div>