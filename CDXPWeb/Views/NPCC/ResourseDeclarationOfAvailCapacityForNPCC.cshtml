
@{
    ViewBag.Title = "Declaration of Available Capacity";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="pcontent">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding: 0px;">
            <div class="panel panel-default card-view panel-refresh">
                <div class="refresh-container">
                    <div class="la-anim-1"></div>
                </div>
                <div class="panel-heading">
                    <div class="pull-left" style="display: inline-flex;">
                        <i class="fa fa-wpforms" style="padding-top: 4px;margin-right: 5px;color:#fff;"></i>
                        <h6 class="panel-title txt-light" style="text-transform: none;">@ViewBag.Title</h6>
                    </div>
                    <div class="pull-right">
                        <a class="pull-left inline-block mr-15" data-toggle="collapse" href="#collapse_1" aria-expanded="true">
                            <i class="zmdi zmdi-chevron-down"></i>
                            <i class="zmdi zmdi-chevron-up"></i>
                        </a>


                        <a href="#" class="pull-left inline-block full-screen mr-15">
                            <i class="zmdi zmdi-fullscreen"></i>
                        </a>

                    </div>
                    <div class="clearfix"></div>
                </div>
                <div id="collapse_1" class="panel-wrapper collapse in">
                    <div class="panel-body">

                        <div class="tab0">
                            &nbsp;<div class="tab1">&nbsp;Header</div>
                            <div class="tab2">&nbsp;</div>
                        </div>



                        <div style="margin-bottom: 20px;">
                            <table class="tblFrm">
                                <tr>

                                    <td style="width: 25%;">
                                        <label for="Disconame">Declaration Type</label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input type="text" id="txtHOURLY_DATA_TYPE" value="DAC" readonly class="form-control frm" />
                                    </td>

                                    <td style="width: 25%;">
                                        <label for="Disconame">Status</label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtStatus" type="text" value="Draft" readonly class="form-control">
                                    </td>

                                </tr>

                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td><label>Submit Date</label></td>
                                    <td><input id="txtSubmitDate" type="text" disabled class="form-control" /></td>
                                </tr>
                                <tr>


                                    <td style="width: 25%;">
                                        <label for="Disconame">Power Producer <span style="color:rgb(0, 149, 235);font-size: 20px;">*</span></label>
                                    </td>
                                    <td style="width: 25%;">
                                        <select id="ddlIPP" class="form-control"> @Html.Raw(@ViewBag.IPP)</select>
                                    </td>

                                    <td style="width: 25%;">
                                        <label for="Disconame">Producer Site <span style="color:rgb(0, 149, 235);font-size: 20px;">*</span></label>
                                    </td>
                                    <td style="width: 25%;">
                                        <select id="ddlSite" class="form-control frm">
                                            <option>Select</option>
                                        </select>
                                    </td>

                                </tr>






                                <tr>
                                    <td style="width: 25%;">
                                        <label for="Disconame" style="display: none;">	Block / Complex <span style="color:rgb(0, 149, 235);font-size: 20px;">*</span></label>
                                    </td>
                                    <td style="width: 25%;">
                                        <select id="ddlBlock" class="form-control" style="display: none;">
                                            <option>Select</option>
                                        </select>
                                    </td>


                                    <td style="width: 25%;">
                                        <label for="Disconame" style="display: none;">Fuel</label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtFuel" type="text" style="display: none;" readonly value="GAS" class="form-control" />
                                    </td>
                                </tr>


                                <tr>
                                    <td style="width: 25%;">
                                        <label for="Disconame" style="display: none;">Installed Capacity</label>
                                    </td>
                                    <td style="width: 25%;">

                                        <input id="txtCapacity" style="display: none;" ="text" readonly value="" class="form-control">
                                    </td>
                                    <td style="width: 25%;">
                                        <label for="Disconame" style="display: none;">Dependable Capacity</label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtDependableCapacity" style="display: none;" readonly type="text" value="" class="form-control" />
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 25%;"><label for="Disconame" style="display: none;">Power Policy</label></td>
                                    <td style="width: 25%;"><input id="txtPowerPolicy" readonly type="text" value="" style="display: none;" class="form-control frm" /></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                @*<tr>
                                        <td style="width: 25%;"><label for="Disconame">Current Availability</label></td>
                                        <td style="width: 25%;"><input id="txtCurrentAvailablity" type="text" value="" class="form-control" /></td>
                                        <td style="width: 25%;"><label for="Disconame">Revised Availability</label></td>
                                        <td style="width: 25%;"><input id="txtRevisedAvailablity" type="text" value="" class="form-control" /></td>
                                    </tr>*@

                                <tr>
                                    <td style="width: 25%;">
                                        <label for="Disconame">Declaration for <span style="color:rgb(0, 149, 235);font-size: 20px;">*</span></label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtTargetDate" type="text" value="@(ViewBag.NextEDate ?? String.Empty)" class="form-control dtDateX" readonly style="background-color:white" />
                                    </td>
                                    <td style="width: 25%;">
                                        <label for="txtINTIMATION_DATE_TIME">Intimation Date & Time<span style="color:rgb(0, 149, 235);font-size: 20px;">*</span></label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtINTIMATION_DATE_TIME" readonly value="@(ViewBag.DateTime ?? String.Empty)" type="text" class="form-control frm" />
                                    </td>
                                </tr>







                            </table>


                        </div>@*End Of Table*@

                        <div class="tab0 pp_1994">
                            &nbsp;<div class="tab1">&nbsp;Detail</div>
                            <div class="tab2">&nbsp;</div>
                        </div>

                        <div class="pp_1994" style="margin-bottom: 20px;">
                            <style type="text/css">
                                #tblHourlyData > tbody > tr > td:nth-child(2) > input, #tblHourlyData > tbody > tr > td:nth-child(3) > input, #tblHourlyData > tbody > tr > td:nth-child(4) > input {
                                    background-color: rgb(251, 255, 193);
                                    text-align: right;
                                }
                            </style>
                            <button class="btn btn-info btnImprtPre" title="Click to load all Last Declaration of Available Capacity" type="button" style="float:right;">Import Last</button>
                            <table class="tablesaw table-bordered table-hover table" data-tablesaw-mode="swipe" id="tblHourlyData">

                                <thead>
                                    <tr>
                                        <th style="width:50px;text-align:Center;" rowspan="2">Relevant Hour</th>

                                        @*<th style="width:100px;text-align:Center;" rowspan="2" class="hydel">Hourly Cap</th>*@
                                        <th style="width:100px;text-align:Center;" rowspan="2" class="hydel">Head</th>
                                        <th style="width:100px;text-align:center;" rowspan="2" class="hydel">Inflow</th>
                                        <th style="width:100px;text-align:Center;" rowspan="2" class="otherThanHydel">Ambient Temperature (°C) <input id="chkAmbiant" checked="checked" type="checkbox" style="height: 20px;width: 19px;float: right;margin-top: 0px;" /></th>
                                        <th style="width:100px;text-align:Center;" rowspan="2" class="otherThanHydel">Estimated Availability (MW)</th>
                                        <th style="width:100px;text-align:center;" rowspan="2" class="common">Availability (MW)</th>
                                        <th style="width:100px;text-align:center;" class="hydel" rowspan="2">Availability At Reference Conditions (MW)<input id="chkAvailRef" checked="checked" type="checkbox" style="height: 20px;width: 19px;float: right;margin-top: 0px;" /></th>
                                        <th style="width:100px;text-align:center;" rowspan="2" class="otherThanHydel">Fuel</th>
                                        <th style="width:100px;text-align:Center; " rowspan="2" class="common">Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>




                                    <tr>
                                        <td style="text-align:right;">00:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>

                                    <tr>
                                        <td style="text-align:right;">01:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>

                                    <tr>
                                        <td style="text-align:right;">02:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">03:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">04:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">05:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">06:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">07:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">08:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">09:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">10:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">11:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">12:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">13:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">14:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">15:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">16:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">17:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">18:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">19:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">20:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">21:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">22:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                    <tr>
                                        <td style="text-align:right;">23:00</td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td><input type="text" class="form-control clsFloat" value="" /></td>
                                        <td style="display:none;"><input type="text" class="form-control" /></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>


                        <div class="tab0">
                            &nbsp;<div class="tab1">&nbsp;Power Producer Remarks</div>
                            <div class="tab2">&nbsp;</div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <table class="tblFrm" style="width:100%;">
                                <tr style="display:none;">
                                    <td style="width: 19%;">
                                        <label for="Disconame">Sender Name</label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtSENDER_NAME" type="text" value="@(ViewBag.userinfo.DISPLAY_NAME)" class="form-control frm">
                                    </td>
                                    <td style="width: 25%;">
                                        <label for="Disconame">Sender Designation</label>
                                    </td>
                                    <td style="width: 25%;">
                                        <input id="txtSENDER_DESIGNATION" type="text" value="@(ViewBag.userinfo.DISPLAY_DESIGNATION)" class="form-control frm">
                                    </td>
                                </tr>
                                <tr>
                                    <td style="vertical-align:top;">
                                        <label>Additional Note</label>
                                    </td>
                                    <td colspan="3">
                                        <textarea cols="70" rows="6" maxlength="2000" id="txtSENDER_REMARKS" class="frm" style="width: 100%;"></textarea>
                                    </td>
                                </tr>
                            </table>

                            <div class="form-actions" id="uperClose">
                                <div class="row">
                                    <div class="col-md-12" style="text-align:right;">

                                        <button id="btnSubmit" tag=@ViewBag.WP_GC_HOURLY_DATA_HEADER_ID_PK title="Submitt to NPCC" typ="Submitted" class="btn btn-info" type="button" style="margin-right:20px;">Submit</button>
                                        <button id="btnSave" tag=@ViewBag.WP_GC_HOURLY_DATA_HEADER_ID_PK typ="Draft" title="Save as draft" class="btn  btn-success" type="button" style="margin-right:20px;">Save</button>
                                        <button class="btn btn-default btnClose" type="button" title="Close Form" tag=@ViewBag.WP_GC_HOURLY_DATA_HEADER_ID_PK>Close</button>

                                    </div>
                                </div>
                            </div>

                        </div>


                        @if (ViewBag.userinfo.WP_SETUP_USER_TYPES_ID == 777 || ViewBag.sts == "Acknowledged")
                        {
                            <div class="tab0">
                                &nbsp;<div class="tab1">&nbsp;NPCC Remarks</div>
                                <div class="tab2">&nbsp;</div>
                            </div>

                            <div style="margin-bottom: 20px;">

                                <table class="tblFrm" style="width:100%;">
                                    <tr>
                                        <td style="width: 19%;">
                                            <label for="Disconame">Receiver Name</label>
                                        </td>
                                        <td style="width: 25%;">
                                            <input id="txtRECEIVER_NAME" type="text" value="@(ViewBag.userinfo.DISPLAY_NAME)" class="form-control frm">
                                        </td>
                                        <td style="width: 25%;">
                                            <label for="Disconame">Receiver Designation</label>
                                        </td>
                                        <td style="width: 25%;">
                                            <input id="txtRECEIVER_DESIGNATION" type="text" value="@(ViewBag.userinfo.DISPLAY_DESIGNATION)" class="form-control frm">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:top;">
                                            <label>Additional Note</label>
                                        </td>
                                        <td colspan="3">
                                            <textarea id="txtRECEIVER_REMARKS" cols="70" rows="6" maxlength="2000" class="frm" style="width: 100%;"></textarea>
                                        </td>
                                    </tr>
                                </table>






                                <div class="form-actions">
                                    <div class="row">
                                        <div class="col-md-12" style="text-align:right;">

                                            <button id="btnAcknowledge" class="btn btn-success" type="button" style="margin-right:20px;">Acknowledge</button>
                                            <button class="btn btn-default btnClose" type="button" tag=@ViewBag.WP_GC_HOURLY_DATA_HEADER_ID_PK>Close</button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        }





                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            debugger;
            var ippCat;
            var fDrp, fDrp_1994;
            $(".hydel").css("display", "none");

            document.addEventListener("keydown", function (evt) {
                debugger;
                "use strict";
                var e = event || evt;
                var charCode = e.which || e.keyCode;
                if (charCode === 9) {//tab key
                    $(this).next('.inputs').focus();
                }
            });

            $('body').off('click', '.btnImprtPre');
            $('body').on('click', '.btnImprtPre', function (e) {
                e.preventDefault();
                debugger;

                if (ippCat == "10") //Hydel
                {
                    var $data = '28½' + 'DAC½' + $('#ddlSite').val();
                    var fromdata = new FormData();
                    fromdata.append("vls", $data);
                    $.ajax({
                        type: "POST",
                        url: "/NPCC/AjaxCall" + $(location).attr("search"),
                        data: fromdata,
                        contentType: false,
                        processData: false,
                        success: function (response) {

                            if (response == "[]") {
                                swal({
                                    title: "Error",
                                    text: "No Last Declaration of Available Capacity Exists !",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonClass: "btn btn-danger",
                                    confirmButtonText: "OK"
                                });
                                return false;
                            }
                            response = $.parseJSON(response);
                            try {
                                var $bdy = "";
                                var tmp = "";
                                $.each(response, function (indexInArray, valueOfElement) {

                                    tmp = valueOfElement.WITH_REF_AVAIL;
                                    $bdy += '<tr>\
                                    <td style="text-align:right;">'+ valueOfElement.TARGET_HOUR + '</td>\
                                    <td style="text-align:right;"><input type="text" class="form-control clsFloat head" value="'+ valueOfElement.HEAD + '"></td>\
                                    <td><input type="text" class="form-control clsFloat inflow" value="'+ valueOfElement.INFLOW + '"></td>\
                                    <td style="text-align:right;"><input type="text" class="form-control clsFloat abttt" style="background-color: rgb(251, 255, 193)" value = "' + valueOfElement.AVAILABILITY + '"></td>\
                                    <td><input type="text" class="form-control clsFloat availRef" value="'+ valueOfElement.AVAILABILITY_AT_REF + '"></td>\
                                        <td ><input type="text" class="form-control" value="'+ valueOfElement.REMARKS + '" ></td>\
                                    </tr>';

                                    $('#tblHourlyData > tbody').html($bdy);

                                });

                                $('#chkAvailRef').prop('checked', tmp);
                                // $('#chkAvailRef').prop('disabled', true);
                                $('#chkAvailRef').change();
                            } catch (e) {
                                swal({
                                    title: "Error",
                                    text: "No last Data Found..!",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonClass: "btn btn-danger",
                                    confirmButtonText: "OK"
                                });
                                return false;
                            }

                        }
                    });
                } //NON - HYDEL
                else {
                    if ($('#ddlBlock').val() == null || $('#ddlBlock').val() == undefined || $('#ddlBlock').val() == "") {
                        swal({
                            title: "Error",
                            text: "Select valid Block / Complex..!",
                            type: "warning",
                            showCancelButton: false,
                            confirmButtonClass: "btn btn-danger",
                            confirmButtonText: "OK",
                            onAfterClose: () => {
                                setTimeout(() => $('#ddlBlock').focus(), 100);
                            }
                        });
                        return false;
                    }
                    var $data = '13½' + 'DAC ½' + $('#ddlBlock').val();
                    var fromdata = new FormData();
                    fromdata.append("vls", $data);
                    $.ajax({
                        type: "POST",
                        url: "/NPCC/AjaxCall" + $(location).attr("search"),
                        data: fromdata,
                        contentType: false,
                        processData: false,
                        success: function (response) {

                            if (response == "[]") {
                                swal({
                                    title: "Error",
                                    text: "No Last Declaration of Available Capacity Exists !",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonClass: "btn btn-danger",
                                    confirmButtonText: "OK"
                                });
                                return false;
                            }
                            response = $.parseJSON(response);
                            try {
                                var $bdy = "";
                                var AmbientTemp = 0;
                                $.each(response, function (indexInArray, valueOfElement) {
                                    if ($('#txtPowerPolicy').val() == '1994') {
                                        // AmbientTemp = "";
                                        $('#chkAmbiant').prop('checked', false);
                                        $bdy += '<tr>\
                                         <td style="text-align:right;">'+ valueOfElement.TARGET_HOUR + '</td>\
                                         <td><input type="text" class="form-control clsFloat abt" value="" disabled style="background-color:rgb(238, 238, 238)"></td>\
                                         <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" disabled style="background:#eee;" value=""></td>\
                                        <td><input type="text" class="form-control clsFloat abttt" value="'+ valueOfElement.AVAILABILITY + '"></td>\
                                        <td><select class="form-control" id="txtFuel"><option value="'+ valueOfElement.SCH_10_ID + '">' + valueOfElement.FUEL_TYPE + '</option></td>\<td> <input type="text" class="form-control" value="' + valueOfElement.REMARKS + '"></td>\</tr > ';
                                        $('#tblHourlyData > tbody').html($bdy);
                                        //     $('.abt').val('');
                                        // $('.abtt').val('0');
                                        $('.abtt').prop('disabled', true);
                                        $('.abt').css('background', 'rgb(238, 238, 238');

                                    }
                                    else if (valueOfElement.AMBIENT_TEMPERATURE == null) {
                                        // AmbientTemp = "";
                                        $('#chkAmbiant').prop('checked', false);
                                        $bdy += '<tr>\
                                    <td style="text-align:right;">'+ valueOfElement.TARGET_HOUR + '</td>\
                                    <td><input type="text" class="form-control abt " value=""></td>\
                                    <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="'+ valueOfElement.AMBIENT_AVAILABILITY + '"></td>\
                                    <td><input type="text" class="form-control clsFloat abttt" value="'+ valueOfElement.AVAILABILITY + '"></td>\
                                    <td><select class="form-control" id="txtFuel" disabled style="background-color: rgb(238, 238, 238);"></td>\
                                    <td ><input type="text" class="form-control" value = "' + valueOfElement.REMARKS + '"></td>\
                                    </tr>';
                                        $('#tblHourlyData > tbody').html($bdy);
                                        //     $('.abt').val('');
                                        // $('.abtt').val('0');
                                        $('.abt').prop('disabled', true);
                                        $('.abt').css('background', 'rgb(238, 238, 238');
                                    }
                                    else {
                                        // AmbientTemp = valueOfElement.AMBIENT_TEMPERATURE;
                                        $bdy += '<tr>\
                                    <td style="text-align:right;">'+ valueOfElement.TARGET_HOUR + '</td>\
                                    <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="'+ Math.round(valueOfElement.AMBIENT_TEMPERATURE) + '"></td>\
                                    <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="'+ valueOfElement.AMBIENT_AVAILABILITY + '"></td>\
                                    <td><input type="text" class="form-control clsFloat abttt" value="'+ valueOfElement.AVAILABILITY + '"></td>\
                                    <td><select class="form-control" id="txtFuel"><option value="'+ valueOfElement.SCH_10_ID + '">' + valueOfElement.FUEL_TYPE + '</option></td>\
                                    <td ><input type="text" class="form-control" value="'+ valueOfElement.REMARKS + '" ></td>\
                                    </tr>';
                                        $('#tblHourlyData > tbody').html($bdy);
                                        $('.abtt').prop('readonly', true);
                                        $('.abtt').css('background', 'rgb(238, 238, 238');
                                    }

                                });

                            } catch (e) {
                                swal({
                                    title: "Error",
                                    text: "No last Data Found..!",
                                    type: "warning",
                                    showCancelButton: false,
                                    confirmButtonClass: "btn btn-danger",
                                    confirmButtonText: "OK"
                                });
                                return false;
                            }

                        }
                    });

                }
            });


            $('body').off('change', '#chkAmbiant');
            $('body').on('change', '#chkAmbiant', function () {

                var flg = $(this).prop('checked');
                if ($(this).prop('checked')) {
                    $('.abt').prop('disabled', false);
                    $('.abt').css('background', 'rgb(251, 255, 193)');
                    $("select#txtFuel").html(fDrp);
                    $("select#txtFuel").prop('disabled', false);
                    $("select#txtFuel").css('background', 'rgb(251, 255, 193)');

                } else {
                    $('.abt').val('');
                    $('.abtt').val('0');
                    $('.abt').prop('disabled', true);
                    $('.abt').css('background', 'rgb(238, 238, 238');
                    if (!(ippCat == '20' && $('#txtPowerPolicy').val() == '1994')) {
                        $("select#txtFuel").empty();
                        $("select#txtFuel").css('background', 'rgb(238, 238, 238');
                        $("select#txtFuel").prop('disabled', true);
                    }

                }


            });
            $('body').off('click', '#btnAcknowledge');
            $('body').on('click', '#btnAcknowledge', function (e) {
                e.preventDefault();
                var $data = '12½' + $('.btnClose').attr('tag') + '½' + $('#txtRECEIVER_NAME').val() + '½' + $('#txtRECEIVER_DESIGNATION').val() + '½' + $('#txtRECEIVER_REMARKS').val() + '½';
                var fromdata = new FormData();
                fromdata.append("vls", $data);
                $.ajax({
                    type: "POST",
                    url: "/NPCC/AjaxCall" + $(location).attr("search"),
                    data: fromdata,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        alert('Record Saved');
                        $($('.btnClose')[0]).click()
                    }
                });
            });
            $(function () {


                $("#txtTargetDate").datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'dd-M-yy',
                    defaultDate: +1,
                    //minDate: '+1d',
                    //maxDate: '+1d',
                    onSelect: function (dateText, inst) {
                        var date = $(this).val();
                        var time = $('#time').val();
                        // alert('on select triggered');
                        //$("#start").val(date + time.toString(' HH:mm').toString());

                    }
                });


                $('#txtINTIMATION_DATE_TIME').datetimepicker({
                    format: 'DD-MMM-YYYY HH:mm'
                });
            });
            $('body').off('click', '#btnSave, #btnSubmit');
            $('body').on('click', '#btnSave, #btnSubmit', function (e) {
                e.preventDefault();
                var thisCtrl, flg = true, thisCt;
                if ($('#ddlBlock').val() == null || $('#ddlBlock').val() == undefined) {
                    swal({
                        title: "Error",
                        text: "Select valid Block / Complex !",
                        type: "warning",
                        showCancelButton: false,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK",
                        onAfterClose: () => {
                            setTimeout(() => $('#invoiceDate').focus(), 100)
                        }
                    });
                    return false;
                }
                debugger;
                if (ippCat == "10") //Hydel
                {
                    var $data = '33½' + $(this).attr('tag') + '½' + $(this).attr('typ') + '½' + $('#txtHOURLY_DATA_TYPE').val() + '½' + $('#ddlSite').val() + '½' + $('#txtPowerPolicy').val() + '½' + $('#txtTargetDate').val() + '½' + $('#txtINTIMATION_DATE_TIME').val() + '½';

                    $('.frm').each(function (index, element) {
                        $data += $(this).val() + '½';
                    });
                    var chkAvailRefEntry = $('#chkAvailRef').prop('checked') == true ? "1" : "0";

                    //Hydel
                    $data += $('#ddlBlock').val().split('½')[0] + '½' + chkAvailRefEntry;
                    //+ chkbxkHourlyEntry;
                    var bIsAllInputs = true;
                    var $DTL = "";
                    if ($(this).attr('tag') == "0") {
                        $('#tblHourlyData > tbody > tr').each(function (index, element) {

                            $DTL += $($(this).find('td')[0]).html() + '½' + $($($(this).find('td')[1]).find('input')[0]).val() + '½' + $($($(this).find('td')[2]).find('input')[0]).val() + '½' + $($($(this).find('td')[3]).find('input')[0]).val() + '½' + $($($(this).find('td')[4]).find('input')[0]).val() + '½' + $($($(this).find('td')[5]).find('input')[0]).val() + '│';
                            if (($($($(this).find('td')[1]).find('input')[0]).val() == "")) {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[0];
                            }
                            else if ($($($(this).find('td')[2]).find('input')[0]).val() == "") {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[1];
                            }
                            else if ($($($(this).find('td')[3]).find('input')[0]).val() == "") {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[2];
                            }
                            else if ($($($(this).find('td')[4]).find('input')[0]).val() == "" && $('#chkAvailRef').prop('checked')) {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[3];
                            }


                        });
                    }
                    else { //edit case
                        debugger;
                        $('#tblHourlyData > tbody > tr').each(function (index, element) {

                            $DTL += $(this).attr('tag') + '½' + $($(this).find('td')[0]).html() + '½' + $($($(this).find('td')[1]).find('input')[0]).val() + '½' + $($($(this).find('td')[2]).find('input')[0]).val() + '½' + $($($(this).find('td')[3]).find('input')[0]).val() + '½' + $($($(this).find('td')[4]).find('input')[0]).val() + '½' + $($($(this).find('td')[5]).find('input')[0]).val() + '│';
                            if (($($($(this).find('td')[1]).find('input')[0]).val() == "")) {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[0];
                            }
                            else if ($($($(this).find('td')[2]).find('input')[0]).val() == "") {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[1];
                            }
                            else if ($($($(this).find('td')[3]).find('input')[0]).val() == "") {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[2];
                            }
                            else if ($($($(this).find('td')[4]).find('input')[0]).val() == "" && $('#chkAvailRef').prop('checked')) {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[3];
                            }
                        });
                    }
                }
                else //Non Hydel
                {
                    //if ($('#ddlBlock').val() == null || $('#ddlBlock').val() == undefined) {
                    //    swal({
                    //        title: "Error",
                    //        text: "Select valid Block / Complex !",
                    //        type: "warning",
                    //        showCancelButton: false,
                    //        confirmButtonClass: "btn btn-danger",
                    //        confirmButtonText: "OK",
                    //        onAfterClose: () => {
                    //            setTimeout(() => $('#invoiceDate').focus(), 100);
                    //        }
                    //    });
                    //    return false;
                    //}
                    debugger;
                    var $data = '33½' + $(this).attr('tag') + '½' + $(this).attr('typ') + '½' + $('#txtHOURLY_DATA_TYPE').val() + '½' + $('#ddlSite').val() + '½' + $('#txtPowerPolicy').val() + '½' + $('#txtTargetDate').val() + '½' + $('#txtINTIMATION_DATE_TIME').val() + '½';
                    $('.frm').each(function (index, element) {
                        $data += $(this).val() + '½';
                    });
                    var chkbxkHourlyEntry = $('#chkAmbiant').prop('checked') == true ? "1" : "0";

                    $data += $('#ddlBlock').val().split('½')[0];
                    var bIsAllInputs = true;
                    var $DTL = "";
                    if ($(this).attr('tag') == "0") {
                        $('#tblHourlyData > tbody > tr').each(function (index, element) {
                            var vFuel, SCH_10_ID;
                            //var chkFuelType = $('#chkAmbiant').prop('checked') == false ? "No Feul" : "0";
                            if ($('#chkAmbiant').prop('checked') == false && !(ippCat == '20' && $('#txtPowerPolicy').val() == '1994')) {
                                vFuel = " ";
                                SCH_10_ID = " ";
                            }
                            else {
                                vFuel = $(this).find("td:eq(4)").find("select#txtFuel").find("option:selected").text().trim();
                                SCH_10_ID = $(this).find("td:eq(4)").find("select#txtFuel").find("option:selected").val().split('½')[0];

                                //vFuel = s.split('½')[1];
                                // var boolb = String.IsNullOrEmpty(vFuel);
                                //if (!vFuel) {
                                //    vFuel = s; //Last import
                                //}

                            }
                            if (SCH_10_ID == 9981 && $($($(this).find('td')[5]).find('input')[0]).val() == "") {
                                flg = false;
                                thisCt = $($($(this).find('td')[5]).find('input')[0]);
                            }

                            $DTL += $($(this).find('td')[0]).html() + '½' + $($($(this).find('td')[1]).find('input')[0]).val() + '½' + $($($(this).find('td')[2]).find('input')[0]).val() + '½' + $($($(this).find('td')[3]).find('input')[0]).val() + '½' + vFuel + '½' + $($($(this).find('td')[5]).find('input')[0]).val() + '½' + SCH_10_ID + '│';
                            if ($('#chkAmbiant').prop('checked')) {
                                if (($($($(this).find('td')[1]).find('input')[0]).val() == "")
                                    || $($($(this).find('td')[2]).find('input')[0]).val() == "") {
                                    bIsAllInputs = false;
                                    thisCtrl = $(this).find('input')[0];
                                }
                                else if ($($($(this).find('td')[3]).find('input')[0]).val() == "") {
                                    bIsAllInputs = false;
                                    thisCtrl = $(this).find('input')[3];
                                }
                            }
                            else {
                                if (ippCat == '20' && $('#txtPowerPolicy').val() == '1994') {
                                    if ($($($(this).find('td')[3]).find('input')[0]).val() == "") {
                                        bIsAllInputs = false;
                                        thisCtrl = $(this).find('input')[3];
                                    }
                                }
                                else {
                                    if ($($($(this).find('td')[2]).find('input')[0]).val() == "" || $($($(this).find('td')[3]).find('input')[0]).val() == "") {
                                        bIsAllInputs = false;
                                        thisCtrl = $(this).find('input')[2];
                                    }
                                }
                            }


                        });
                    }
                    else { //edit case
                        debugger;
                        $('#tblHourlyData > tbody > tr').each(function (index, element) {
                            var vFuel, SCH_10_ID;

                            if ($('#chkAmbiant').prop('checked') == false && !(ippCat == '20' && $('#txtPowerPolicy').val() == '1994')) {
                                vFuel = " ";
                                SCH_10_ID = " ";
                            }
                            else {
                                vFuel = $(this).find("td:eq(4)").find("select#txtFuel").find("option:selected").text().trim();
                                SCH_10_ID = $(this).find("td:eq(4)").find("select#txtFuel").find("option:selected").val().split('½')[0];
                                //   vFuel = s.split('½')[1];
                                // var boolb = String.IsNullOrEmpty(vFuel);
                                //if (!vFuel) {
                                //    vFuel = s; //Last import
                                //}

                            }
                            if (SCH_10_ID == 9981 && $($($(this).find('td')[5]).find('input')[0]).val() == "") { //KAPCO - MIXED FUEL
                                flg = false;
                                thisCt = $($($(this).find('td')[5]).find('input')[0]);
                            }

                            // var vFuel = $(this).find("td:eq(4)").find("select#txtFuel").val();
                            // var vFuel = s.split('½')[1];
                            $DTL += $(this).attr('tag') + '½' + $($($(this).find('td')[1]).find('input')[0]).val() + '½' + $($($(this).find('td')[2]).find('input')[0]).val() + '½' + $($($(this).find('td')[3]).find('input')[0]).val() + '½' + vFuel + '½' + $($($(this).find('td')[5]).find('input')[0]).val() + '½' + SCH_10_ID + '│';

                            if (ippCat == '20' && $('#txtPowerPolicy').val() != '1994') {
                                if ($($($(this).find('td')[2]).find('input')[0]).val() == "") {
                                    bIsAllInputs = false;
                                    thisCtrl = $(this).find('input')[2];
                                }
                            }
                            if (($($($(this).find('td')[1]).find('input')[0]).val() == "" && $('#chkAmbiant').prop('checked')) || $($($(this).find('td')[3]).find('input')[0]).val() == "") {
                                bIsAllInputs = false;
                                thisCtrl = $(this).find('input')[2];
                            }
                        });
                    }
                }//non Hydel ends

                //var $data = '2½' + $(this).attr('tag') + '½' + $(this).attr('typ') + '½';
                //$('.frm').each(function (index, element) {
                //    $data += $(this).val() +'½';
                //});
                //$data += $('#ddlBlock').val().split('½')[0] + "½" + $('#txtCurrentAvailablity').val() + "½" + $('#txtRevisedAvailablity').val();
                //var bIsAllInputs = true;
                //var $DTL = "";
                //if ($(this).attr('tag')=="0") {
                //    $('#tblHourlyData > tbody > tr').each(function (index, element) {
                //        $DTL += $($(this).find('td')[0]).html() + '½' + $($($(this).find('td')[1]).find('input')[0]).val() + '½' + $($($(this).find('td')[2]).find('input')[0]).val() + '½' + $($($(this).find('td')[3]).find('input')[0]).val() + '½' + $($($(this).find('td')[4]).find('input')[0]).val() + '│';
                //        if ($($($(this).find('td')[1]).find('input')[0]).val() == "" || $($($(this).find('td')[2]).find('input')[0]).val() == "" ||  $($($(this).find('td')[3]).find('input')[0]).val()=="") {
                //            bIsAllInputs = false;
                //        }
                //    });
                //}
                //else {
                //    $('#tblHourlyData > tbody > tr').each(function (index, element) {
                //        $DTL += $(this).attr('tag') + '½' + $($($(this).find('td')[1]).find('input')[0]).val() + '½' + $($($(this).find('td')[2]).find('input')[0]).val() + '½' + $($($(this).find('td')[3]).find('input')[0]).val() + '½' + $($($(this).find('td')[4]).find('input')[0]).val() + '│';
                //        if ($($($(this).find('td')[1]).find('input')[0]).val() == "" || $($($(this).find('td')[2]).find('input')[0]).val() == "" || $($($(this).find('td')[3]).find('input')[0]).val() == "") {
                //            bIsAllInputs = false;
                //        }
                //    });
                //}
                if (flg == false) {
                    swal({
                        title: "WARNING",
                        text: "Remarks are mandatory for Mixed Fuel",
                        type: "warning",
                        showCancelButton: false,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK"
                        //,onAfterClose: () => {
                        //              setTimeout(() => $('#invoiceLetterNumber').focus(), 100);
                        //          }
                    }, function () {
                        setTimeout(() => $(thisCt).focus(), 100);
                    });

                    return false;
                }
                if (bIsAllInputs == false) {
                    swal({
                        title: "Error",
                        text: "Enter all required inputs...!",
                        type: "warning",
                        showCancelButton: false,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK"
                        //onAfterClose: () => {
                        //    setTimeout(() => $(thisCtrl).focus(), 100)
                        //}
                    },
                        function () {
                            setTimeout(() => $(thisCtrl).focus(), 100);

                        });
                    return false;
                }

                if ($DTL != "") {
                    $DTL += '½';
                    $DTL = $DTL.replace('│½', '');
                }

                var fromdata = new FormData();
                fromdata.append("vls", $data);
                fromdata.append("dtl", $DTL);
                fromdata.append("IPPTYPE", ippCat);
                swal({
                    title: "Are you sure?",
                    text: "Do you really want to Save Record?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Yes, Save it!",
                    closeOnConfirm: false
                },
                    function () {
                $.ajax({
                    type: "POST",
                    url: "/NPCC/AjaxCall" + $(location).attr("search"),
                    data: fromdata,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        debugger;
                        if (response == "HOURLY_DATA_HEADER_DUPLICATE") {

                            swal({
                                title: "Error",
                                text: "The Declaration of availability has already been entered on this date against this Block / Complex .",
                                type: "warning",
                                showCancelButton: false,
                                confirmButtonClass: "btn btn-danger",
                                confirmButtonText: "OK"
                                //,onAfterClose: () => {
                                //              setTimeout(() => $('#invoiceLetterNumber').focus(), 100);
                                //          }
                            }, function () {
                                setTimeout(() => $('#ddlBlock').focus(), 100);
                            });
                            //   return false;

                        }
                        else {
                            var resArr = response.split('¼')
                            if (resArr[0] == "1") {
                                // $('.sa-button-container').show();
                                swal("Success!", "Record has been saved Successfully.", "success");
                                $($('.btnClose')[0]).click()
                            }
                            else if (resArr[0] == "2") {
                                $('.sa-button-container').show();
                                swal({
                                    title: "Error Inserting Record",
                                    text: resArr[1],
                                    type: "error"
                                });
                            }
                            else {
                                // Do Nothing
                            }
                        }
                    }
                });
            });
                });
            $('body').off('change', '#chkAvailRef');
            $('body').on('change', '#chkAvailRef', function () {

                if ($(this).prop('checked')) {
                    $('.availRef').prop('disabled', false);
                    $('.availRef').css('background', 'rgb(251, 255, 193)');
                } else {
                    $('.availRef').val('');
                    $('.availRef').prop('disabled', true);
                    $('.availRef').css('background', 'rgb(238, 238, 238');
                }
            });
                $('body').off('focus', '.dtDateTime');
                $('body').on('focus', '.dtDateTime', function () {
                    $(this).datetimepicker({
                        format: 'DD-MMM-YYYY HH:mm'
                    });
                });

                $('body').off('click', '.btnClose');
                $('body').on('click', '.btnClose', function (e) {
                    e.preventDefault();
                    var options = {};
                    $("#pageContainer").hide('slide', options, 300);
                    $.ajax({
                        url: "/NPCC/DeclarationOfAvailCapacityList" + $(location).attr('search'),
                        success: function (result) {
                            var options = {};
                            $('#pageContainer').html($(result).find('#pcontent').html());
                            $("#pageContainer").show('slide', options, 500);
                        }
                    });
                });//End of edit click
                $('body').off('change', '#ddlIPP');
                $('body').on('change', '#ddlIPP', function (e) {
                    debugger;
                    $.blockUI({ css: { backgroundColor: 'rgb(170, 170, 170)', color: '#fff' } });
                    findIPPCat();
                    LoadVendorSites();
                    LoaddllBlockFuel();

                    //Hide and show table columns on basis of IPP Type
                    if (ippCat == "10") {  // Hydel ha


                        $(".otherThanHydel").hide();
                        $(".hydel").show();
                        $(".common").show();

                        $('.abt').removeClass('abt').addClass('clsFloat head'); //work
                        $('.abtt').removeClass('abtt').addClass('inflow');
                        $('select#txtFuel').replaceWith('<input type="text" class="form-control clsFloat availRef" value="" style="background-color:rgb(251, 255, 193)">');


                        //$('.abt').removeClass('abt').addClass('clsFloat hourCap'); //work
                        //$('.abtt').removeClass('abtt').addClass('head');
                        //$('.abttt').removeClass('abttt').addClass('inflow');
                        //$('select#txtFuel').replaceWith('<input type="text" class="form-control clsFloat abttt" value="" style="background-color:rgb(251, 255, 193)">');

                        $('.head').attr('disabled', false).css('background' , 'rgb(251, 255, 193)' );

                    }
                    else { // Not Hydel
                        $(".hydel").hide();
                        $(".otherThanHydel").show();
                        $(".common").show();
                    }
                    $.unblockUI();

                    });// End of change
                $('body').off('change', '#ddlSite');
            $('body').on('change', '#ddlSite', function (e) {
                debugger;
                    LoaddllBlockFuel();
                });// End of change
            $('body').off('change', '#txtFuel');
            $('body').on('change', '#txtFuel', function () {
                debugger;
                if ((ippCat == 20 && $('#txtPowerPolicy').val() != '1994') || (ippCat == 20 && $('#txtPowerPolicy').val() == '1994' && parseInt($temprature) > 0)) {
                    var $control = $(this);
                    var $temprature = $control.parent().prev().prev().prev().find('.abt').val()

                    var FuelID = $control.val();
                    //$control.parent().next().next().next().find('#txtFuel option:selected').val().split('½')[0];

                    var fromdata = new FormData();
                    fromdata.append('vls', '45½' + FuelID + "½" + $temprature);
                    $.ajax({
                        type: "POST",
                        url: "/NPCC/AjaxCallNext" + $(location).attr("search"),
                        data: fromdata,
                        contentType: false,
                        async: false,
                        processData: false,
                        success: function (response) {
                            if (response != "" || response != null) {
                                response = parseFloat(response).toFixed(3);
                                $($control.parent().prev().find('.abttt')[0]).val(response);
                                $($control.parent().prev().prev().find('.abtt')[0]).val(response);
                            }
                        }
                    });
                }

            });//END OF CHANGE
                $('body').off('change', '#ddlBlock');
            $('body').on('change', '#ddlBlock', function (e) {
                debugger;
                    if ($('#ddlBlock').val() != null || $('#ddlBlock').val() != undefined) {
                        $('#txtFuel').val($('#ddlBlock').val().split('½')[1]);
                        $('#txtCapacity , #txtDependableCapacity').val($('#ddlBlock').val().split('½')[2]);
                        $('#txtPowerPolicy').val($('#ddlBlock').val().split('½')[3]);
                        Fn_checkPowerPolicy();
                    }
                    else {
                        $('#txtFuel, #txtCapacity, #txtDependableCapacity, #txtPowerPolicy').val('');
                    }
                });// End

            $(function () {
                $('#txtSENDER_NAME').val($('#txtSENDER_NAME').attr('value'));
                $('#txtSENDER_DESIGNATION').val($('#txtSENDER_DESIGNATION').attr('value'));
                $('#txtRECEIVER_NAME').val($('#txtRECEIVER_NAME').attr('value'));
                $('#txtRECEIVER_DESIGNATION').val($('#txtRECEIVER_DESIGNATION').attr('value'));
                if ($('#btnSubmit').attr('tag')=="0") {
                    LoadVendorSites();
                }
                else {
                    LoadVendorSitesAndDetails();
                }
                @if (ViewBag.userinfo.WP_SETUP_USER_TYPES_ID == 777) {
                @: $($('.btnClose')[0]).parent().parent().parent().remove();
                }
                });//End
            function LoadVendorSites() {
                debugger;
                    var fromdata = new FormData();
                    fromdata.append('vls', '0½' + $('#ddlIPP').val());
                    $.ajax({
                        type: "POST",
                        url: "/NPCC/AjaxCall" + $(location).attr("search"),
                        data: fromdata,
                        contentType: false,
                        async: false,
                        processData: false,
                        success: function (response) {
                            $('#ddlSite').html(response);
                            if ($('#ddlSite').val() == null || $('#ddlSite').val() == undefined || $('#ddlSite').val() == "") {
                                $('#ddlBlock').html('');
                                $('#txtFuel, #txtCapacity, #txtDependableCapacity, #txtPowerPolicy').val('');
                            }
                            else {

                                LoaddllBlockFuel();

                            }
                        }
                    });
            }//END OF LOAD

            var tblContent = "";
            function Fn_checkPowerPolicy() {

                //if ($.trim($('#txtPowerPolicy').val()) == "2002" || $.trim($('#txtPowerPolicy').val()) == "2015") {

                $('#txtCurrentAvailablity').val('0');
                $('#txtRevisedAvailablity').val('0');
                $('.pol1994').hide();
                $('#tblHourlyData > tbody').html('\
<tr> <td style="text-align:right;">00:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">01:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">02:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td>  <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">03:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">04:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">05:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">06:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">07:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">08:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">09:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">10:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">11:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">12:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">13:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">14:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">15:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">16:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">17:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">18:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">19:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">20:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">21:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">22:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr> \
<tr> <td style="text-align:right;">23:00</td> <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="" /></td> <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" value="" /></td> <td><input type="text" class="form-control clsFloat abttt" value="" /></td> <td><select class="form-control" id="txtFuel"><option value="-1">Select Fuel</option></td ><td style="text-align:right;" tg=""><input type="text" class="form-control" value=""></td></tr>');




                if (ippCat != '20') {
                    $('#chkAmbiant').prop('checked', false);
                    $('#chkAmbiant').change();
                }
                else if (ippCat == '20' && $('#txtPowerPolicy').val() == '1994') {
                    $('#chkAmbiant').prop('checked', false);
                    $('#chkAmbiant').change();
                    $('.abt').inputmask("decimal", { min: -180, max: 180, allowMinus: true });
                    $('#tblHourlyData > tbody > tr').each(function (index, element) {
                        $($($(this).find('td')[2]).find('input')[0]).val('').css('background', '#eee').prop('disabled', true);
                        $($($(this).find('td')[4]).find('#txtFuel')).html(fDrp_1994);
                    });
                }
                else {
                    $('.pp_1994').show();

                    //} else {
                    //    $('#txtCurrentAvailablity').val('');
                    //    $('#txtRevisedAvailablity').val('');
                    //    $('.pol1994').show();
                    //    $('.pp_1994').hide();
                    //    $('#tblHourlyData > tbody').html('');
                    //}
                    $('#chkAmbiant').prop('checked', true);
                    $('.abt').inputmask("decimal", { min: -180, max: 180, allowMinus: true });
                    $('#tblHourlyData > tbody > tr').each(function (index, element) {
                        $($($(this).find('td')[2]).find('input')[0]).val('0').css('background', '#eee').prop('disabled', true);
                        $($($(this).find('td')[4]).find('#txtFuel')).html(fDrp);
                        // $('#txtFuel').html(fDrp);
                    });
                }
                if (ippCat == "10") {
                    // $('.btnImprtPre').hide(); //

                    $('.abt').removeClass('abt').addClass('clsFloat head'); //work
                    $('.abtt').removeClass('abtt').addClass('inflow');
                    $('select#txtFuel').replaceWith('<input type="text" class="form-control clsFloat availRef" value="" style="background-color:rgb(251, 255, 193)">');

                    //$('.abt').removeClass('abt').addClass('clsFloat hourCap'); //work
                    //$('.abtt').removeClass('abtt').addClass('head');
                    //$('.abttt').removeClass('abttt').addClass('inflow');
                    //$('select#txtFuel').replaceWith('<input type="text" class="form-control clsFloat abttt" value="" style="background-color:rgb(251, 255, 193)">');

                }

            }

            function findIPPCat()
            {
                debugger;
                var fromdata = new FormData();
                fromdata.append('vls', '32½' + $('#ddlIPP').val());
                $.ajax({
                    type: "POST",
                    url: "/NPCC/AjaxCall" + $(location).attr("search"),
                    data: fromdata,
                    contentType: false,
                    async: false,
                    processData: false,
                    success: function (response) {
                        if (response) {
                            ippCat = response
                        }

                    }
                });

            }

            function LoadVendorSitesAndDetails() {

                var fromdata = new FormData();
                fromdata.append("IPPTYPE", ippCat);
                fromdata.append("vls", '4½' + $($('.btnClose')[0]).attr('tag'));
                $.ajax({
                    type: "POST",
                    url: "/NPCC/AjaxCall" + $(location).attr("search"),
                    data: fromdata,
                    contentType: false,
                    async:false,
                    processData: false,
                    success: function (response) {

                        var $dta = $.parseJSON(response);
                        $('#txtHOURLY_DATA_TYPE').val($dta[0].HOURLY_DATA_TYPE);
                        $('#txtStatus').val($dta[0].STATUS);
                        $('#ddlIPP').html($dta[0].ddlIPP);
                        $('#ddlSite').html($dta[0].ddlSite);
                        $('#ddlBlock').html($dta[0].ddlBlock);
                        //$('#txtFuel').val($dta[0].fuel);
                        FuelTyp = $dta[0].fuel;
                        $('#txtCapacity , #txtDependableCapacity').val($dta[0].capacity);
                        $('#txtPowerPolicy').val($dta[0].policiy);
                        Fn_checkPowerPolicy();
                        $('#txtCurrentAvailablity').val($dta[0].CURRENT_AVAILABILITY);
                        $('#txtRevisedAvailablity').val($dta[0].REVISED_AVAILABILITY);
                        $('#txtTargetDate').val($dta[0].TARGET_DATE);
                        $('#txtINTIMATION_DATE_TIME').val($dta[0].INTIMATION_DATE_TIME);
                        $('#txtSENDER_NAME').val($dta[0].SENDER_NAME);
                        $('#txtSENDER_DESIGNATION').val($dta[0].SENDER_DESIGNATION);
                        $('#txtSENDER_REMARKS').val($dta[0].SENDER_REMARKS);
                        $('#txtSubmitDate').val($dta[0].SUBMIT_DATE_TIME);
                        var isTrueSet = ($dta[0].WITH_AMBIENT_TEMPERATURE == 'true');
                        $('#chkAmbiant').prop('checked', isTrueSet);
                        $('#tblHourlyData tbody').html('');
                        //
                        //LoaddllBlockFuel();
                        var fromdata1 = new FormData();
                        fromdata1.append('vls', '29½' + $('#ddlIPP').val());
                        $.ajax({
                            type: "POST",
                            url: "/NPCC/AjaxCall" + $(location).attr("search"),
                            data: fromdata1,
                            contentType: false,
                            processData: false,
                            async: false,
                            success: function (response) {
                                fDrp = response;
                            }
                        });
                        ////////////
                        var fromdata = new FormData();
                        fromdata.append('vls', '1½' + $('#ddlIPP').val() + "½" + $('#ddlSite').val());
                        $.ajax({
                            type: "POST",
                            url: "/NPCC/AjaxCall" + $(location).attr("search"),
                            data: fromdata,
                            contentType: false,
                            processData: false,
                            async: false,
                            success: function (response) {
                                fDrp_1994 = response;
                            }
                        });
                        if (($('#txtStatus').val() != "Draft" || $('.btnClose').attr('conn') == "V")) {
                            //&& moment(serverTime.split(" ")[0]).isAfter($dta[0].TARGET_DATE) || (($('#txtStatus').val() != "Draft" || $('.btnClose').attr('conn') == "V"))) {
                            $('#chkAmbiant').prop('disabled', true);
                            if ($('.btnClose').attr('conn') != "DAC") {
                                $('#btnSubmit').remove();
                                $('#btnSave').remove();
                            }
                            $('.btnImprtPre').remove();
                            $('#ddlIPP').prop('disabled', true);
                            $('#ddlSite').prop('disabled', true);
                            $('#ddlBlock').prop('disabled', true);
                            $('#txtTargetDate').prop('readonly', true);
                            $('#txtCurrentAvailablity').prop('readonly', true);
                            $('#txtRevisedAvailablity').prop('readonly', true);
                            $('#txtINTIMATION_DATE_TIME').prop('readonly', true);
                            $('#txtSENDER_NAME').prop('readonly', true);
                            $('#txtSENDER_DESIGNATION').prop('readonly', true);
                            $('#txtSENDER_REMARKS').prop('disabled', true);
                            $('.clsstar').hide();
                            $('#txtTargetDate').prop('disabled', true);

                        }
                        if ($('#txtStatus').val() == "Acknowledged") {
                            $('#txtRECEIVER_NAME, #txtRECEIVER_DESIGNATION,#txtRECEIVER_REMARKS').prop('readonly', true);
                            $('#txtRECEIVER_REMARKS').prop('disabled', true);
                           @if (ViewBag.userinfo.WP_SETUP_USER_TYPES_ID == 10){
                           @:     $('#btnAcknowledge, #uperClose, #btnReject').remove();
                            }

                            $('#txtRECEIVER_NAME').val($dta[0].RECEIVER_NAME);
                            $('#txtRECEIVER_DESIGNATION').val($dta[0].RECEIVER_DESIGNATION);
                            $('#txtRECEIVER_REMARKS').val($dta[0].RECEIVER_REMARKS);
                            $('.clsstar').hide();
                        }
                        @if (ViewBag.userinfo.WP_SETUP_USER_TYPES_ID == 7 || ViewBag.userinfo.WP_SETUP_USER_TYPES_ID == 9) {
                        @: else { $('#txtRECEIVER_NAME').val($('#txtRECEIVER_NAME').attr('value')); $('#txtRECEIVER_DESIGNATION').val($('#txtRECEIVER_DESIGNATION').attr('value')); }
                        }

                        if ($dta[0].DTL != null || $dta[0].DTL != undefined) {
                            var $dtl = $.parseJSON($dta[0].DTL);
                            if (ippCat == "10") //Hydel
                            {
                                //if ((($('#txtStatus').val() != "Draft" || $('.btnClose').attr('conn') == "V") && moment(serverTime.split(" ")[0]).isAfter($dta[0].TARGET_DATE)) && $('.btnClose').attr('conn') != "DAC" ) {
                                if ((($('#txtStatus').val() != "Draft" || $('.btnClose').attr('conn') == "V")) && $('.btnClose').attr('conn') != "DAC") {
                                    $.each($dtl, function (i, j) {
                                        $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                <td style="text-align:right;">'+ j.TARGET_HOUR + '</td>\
                                    <td style="text-align:right;">'+ j.HEAD + '</td>\
                                        <td>'+ j.INFLOW + '</td>\
                                        <td>'+ j.AVAILABILITY + '</td>\
                                        <td>'+ j.AVAILABILITY_AT_REF + '</td>\
                                        <td >'+ j.REMARKS + '</td>\</tr>');
                                    });//End of Each
                                } else { //populate data
                                    $('.btnImprtPre').hide();
                                    $.each($dtl, function (i, j) { //11-23
                                        //FOLLOW

                                        $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                         <td style="text-align:right;">'+ j.TARGET_HOUR + '</td>\
                                        <td><input type="text" class="form-control clsFloat head req" value="'+ j.HEAD + '"></td>\
                                        <td><input type="text" class="form-control clsFloat inflow req" value="'+ j.INFLOW + '"></td>\
                                        <td><input type="text" class="form-control clsFloat req" value="'+ j.AVAILABILITY + '"></td>\
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat availRef req"  value="'+ j.AVAILABILITY_AT_REF + '"></td>\
                             <td> <input type="text" class="form-control" value="' + j.REMARKS + '"></td>\</tr > ');
                                        if (j.AVAILABILITY_AT_REF == null || j.AVAILABILITY_AT_REF == "") {
                                            // AmbientTemp = "";
                                            $('#chkAvailRef').prop('checked', false);
                                            $('#chkAvailRef').prop('disabled', true);
                                            $('#chkAvailRef').change();
                                        }
                                    });//End of Each
                                }
                            }   //NON-HYDEL start
                            else {
                                //  if (($('#txtStatus').val() != "Draft" || $('.btnClose').attr('conn') == "V") && moment(serverTime.split(" ")[0]).isAfter($dta[0].TARGET_DATE)) {
                                if ((($('#txtStatus').val() != "Draft" || $('.btnClose').attr('conn') == "V")) && $('.btnClose').attr('conn') != "DAC") {

                                        if (ippCat == '20' && $('#txtPowerPolicy').val() == '1994') {
                                            $.each($dtl, function (i, j) {
                                            $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                                            <td style="text-align:right;" class="abt">'+ j.TARGET_HOUR + '</td>\
                                                            <td style="text-align:right;">'+ j.AMBIENT_TEMPERATURE + '</td>\
                                                            <td style="text-align:right;">'+ j.AMBIENT_AVAILABILITY + '</td>\
                                                            <td style="text-align:right;">'+ j.AVAILABILITY + '</td>\
                                                            <td>'+ j.FUEL_TYPE + '</td>\
                                                            <td >'+ j.REMARKS + '</td>\</tr>');
                                        });//End of Each
                                        }
                                        else
                                        {
                                            $.each($dtl, function (i, j) {

                                                var AMBIENT_TEMPERATURE = j.AMBIENT_TEMPERATURE == "" ? "" : Math.round(j.AMBIENT_TEMPERATURE);

                                            $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                                            <td style="text-align:right;" class="abt">'+ j.TARGET_HOUR + '</td>\
                                                            <td style="text-align:right;">'+ AMBIENT_TEMPERATURE + '</td>\
                                                            <td style="text-align:right;">'+ j.AMBIENT_AVAILABILITY + '</td>\
                                                            <td style="text-align:right;">'+ j.AVAILABILITY + '</td>\
                                                            <td>'+ j.FUEL_TYPE + '</td>\
                                                            <td >'+ j.REMARKS + '</td>\</tr>');
                                        });//End of Each
                                }
                            }
                                else { //populate data

                                    $('.btnImprtPre').hide();
                                    $.each($dtl, function (i, j) { //11-23
                                        //if (($('#txtPowerPolicy').val() == '2002' || $('#txtPowerPolicy').val() == '2015') && $dta.IPP_CATEGORY != 20)
                                        if (j.AMBIENT_TEMPERATURE == null || j.AMBIENT_TEMPERATURE == "" && !(ippCat == '20' && $('#txtPowerPolicy').val() == '1994')) {
                                            // AmbientTemp = "";
                                            $('#chkAmbiant').prop('checked', false);
                                            $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                         <td style="text-align:right;">'+ j.TARGET_HOUR + '</td>\
                                         <td><input type="text" class="form-control clsFloat" value="" disabled style="background-color:rgb(238, 238, 238)"></td>\
                                         <td style="text-align:right;"><input type="text" class="form-control clsFloat" disabled style="background:#eee;" value="'+ j.AMBIENT_AVAILABILITY + '"></td>\
                                        <td><input type="text" class="form-control clsFloat" value="'+ j.AVAILABILITY + '"></td>\
                                        <td><select class="form-control" id="txtFuel" disabled style="background-color: rgb(238, 238, 238);"></td>\<td> <input type="text" class="form-control" value="' + j.REMARKS + '"></td>\</tr > ');
                                            //     $('.abt').val('');
                                            // $('.abtt').val('0');
                                            //$('.abt').prop('disabled', true);
                                            //$('.abt').css('background', 'rgb(238, 238, 238');
                                        }
                                        else if (ippCat == '20' && $('#txtPowerPolicy').val() == '1994') {
                                            $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                        <td style="text-align:right;">'+ j.TARGET_HOUR + '</td>\
                                        <<td><input type="text" class="form-control clsFloat" value="" disabled style="background-color:rgb(238, 238, 238)"></td>\
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat " disabled style="background-color:rgb(238, 238, 238)"></td>\
                                        <td><input type="text" class="form-control clsFloat abttt" value="'+ j.AVAILABILITY + '"></td>\
                                        <td><select class="form-control" id="txtFuel"><option selected disabled value="'+ j.SCH_10_ID + '">' + j.FUEL_TYPE + '</option>' + fDrp_1994 + '</td>\
                                        <td><input type="text" class="form-control" value="'+ j.REMARKS + '"></td>\</tr>');
                                        }
                                        else {
                                            $('#tblHourlyData tbody').append('<tr tag="' + j.WP_GC_HOURLY_DATA_DETAIL_ID_PK + '">\
                                        <td style="text-align:right;">'+ j.TARGET_HOUR + '</td>\
                                        <td><input type="text" class="form-control clsNumberWithNegativeValues abt" value="'+ Math.round(j.AMBIENT_TEMPERATURE) + '"></td>\
                                        <td style="text-align:right;"><input type="text" class="form-control clsFloat abtt" disabled style="background:#eee;" value="'+ j.AMBIENT_AVAILABILITY + '"></td>\
                                        <td><input type="text" class="form-control clsFloat abttt" value="'+ j.AVAILABILITY + '"></td>\
                                        <td><select class="form-control" id="txtFuel"><option selected disabled value="'+ j.SCH_10_ID + '">' + j.FUEL_TYPE + '</option>' + fDrp + '</td>\
                                        <td><input type="text" class="form-control" value="'+ j.REMARKS + '"></td>\</tr>');
                                        }


                                    });//End of Each
                                }
                            } //End of Non Hydel

                        }


                    }
                });
            }
            $('body').off('focusout', '.abt');
            $('body').on('focusout', '.abt', function (event) {

                var thisCtrl = $(this);

                if ($(this).val() > 50 || $(this).val() < 0) {
                    swal({
                        title: "Error",
                        text: "Enter temperature between 0-50!",
                        type: "warning",
                        showCancelButton: false,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK"
                    },
                        function () {
                            thisCtrl.val('');
                            $(thisCtrl.parent().next().find('.abtt')[0]).val('');
                            $(thisCtrl.parent().next().next().find('.abttt')[0]).val('');
                            setTimeout(() => $(thisCtrl).focus(), 100);

                        });
                    return false;
                }

            });
            //23-11-20
            $('body').off('change keypress', '.abt');
            $('body').on('change keypress', '.abt', function () {
                debugger;
                $(this).val($(this).val().replace(/[^\d].+/, ""));
                if ((event.which < 48 || event.which > 57)) {
                    event.preventDefault();
                    return false;
                }

                var thisCtrl = $(this);

                if ($(this).val() > 56 || $(this).val() < 0) {
                    swal({
                        title: "Error",
                        text: "Enter temperature between 0-50!",
                        type: "warning",
                        showCancelButton: false,
                        confirmButtonClass: "btn btn-danger",
                        confirmButtonText: "OK"
                    },
                        function () {
                            thisCtrl.val('');
                            $(thisCtrl.parent().next().find('.abtt')[0]).val('');
                            $(thisCtrl.parent().next().next().find('.abttt')[0]).val('');
                            setTimeout(() => $(thisCtrl).focus(), 100);

                        });

                    return false;
                }

                if (ippCat != "40" || ippCat != "50" || ippCat != "60" || !(ippCat == 20 && $('#txtPowerPolicy').val() == '1994')) {
                    var $control = $(this);
                    var $temprature = $control.val();
                    var FuelID = $control.parent().next().next().next().find('#txtFuel option:selected').val();

                    var fromdata = new FormData();
                    fromdata.append('vls', '45½' + FuelID + "½" + $temprature);
                    $.ajax({
                        type: "POST",
                        url: "/NPCC/AjaxCallNext" + $(location).attr("search"),
                        data: fromdata,
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            if (response != "" || response != null) {
                                response = parseFloat(response).toFixed(3);
                                $($control.parent().next().find('.abtt')[0]).val(response);
                                $($control.parent().next().next().find('.abttt')[0]).val(response);
                            }
                        }
                    });

                }
            });//END OF CHANGE
            function LoaddllBlockFuel() {

                var fromdata1 = new FormData();
                fromdata1.append('vls', '29½' + $('#ddlIPP').val());
                $.ajax({
                    type: "POST",
                    url: "/NPCC/AjaxCall" + $(location).attr("search"),
                    data: fromdata1,
                    async: false,
                    contentType: false,
                    processData: false,
                    async: false,
                    success: function (response) {
                        fDrp = response;
                    }
                });
                ////////////
                var fromdata = new FormData();
                fromdata.append('vls', '1½' + $('#ddlIPP').val() + "½" + $('#ddlSite').val());
                $.ajax({
                    type: "POST",
                    url: "/NPCC/AjaxCall" + $(location).attr("search"),
                    data: fromdata,
                    contentType: false,
                    processData: false,
                    async: false,
                    success: function (response) {
                        fDrp_1994 = response;
                        $('#ddlBlock').html(response);
                        if ($('#ddlBlock').val() != null || $('#ddlBlock').val() != undefined) {
                            //$('#txtFuel').val($('#ddlBlock').val().split('½')[1]);
                            FuelTyp = $('#ddlBlock').val().split('½')[1];
                            $('#txtCapacity , #txtDependableCapacity').val($('#ddlBlock').val().split('½')[2]);
                            $('#txtPowerPolicy').val($('#ddlBlock').val().split('½')[3]);
                            ippCat = $('#ddlBlock').val().split('½')[5];
                            Fn_checkPowerPolicy();
                            //Find the dropdown, populate the fuel in all as option

                            //Dcap = $('#ddlBlock').val().split('½')[2];
                        }
                        else {
                            $('#txtFuel, #txtPowerPolicy, #txtCapacity , #txtDependableCapacity ').val('');
                        }
                    }
                });
                ///////////////////////////////



            }
            });
    </script>
</div>